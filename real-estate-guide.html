<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Pavlo Rospopa Real Estate Strategy Engine</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/format.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <style>
        body { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f9; }
        input, textarea { -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; }

        #real-estate-guide-container {
            margin: 40px auto; padding: 30px; border: 1px solid #e0e0e0; border-radius: 12px;
            background-color: #ffffff; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; z-index: 101;
            max-width: 900px;
        }
        .tree-option-btn {
            padding: 14px 18px; background-color: #f8f9fa; color: #333; border: 2px solid #eef0f2;
            border-radius: 8px; cursor: pointer; font-size: 1rem; text-align: left;
            transition: all 0.2s; font-weight: 500; width: 100%; margin-bottom: 8px; display: block;
        }
        .tree-option-btn:hover { border-color: #4285F4; color: #4285F4; transform: translateX(4px); }
        .result-card { background: #f4f7ff; border-left: 6px solid #4285F4; padding: 25px; border-radius: 8px; color: #334155; line-height: 1.7; margin-bottom: 20px; }

        #contact-form-container { margin: 40px 0; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; background-color: #f9f9f9; }
        #contact-form { display: flex; flex-direction: column; gap: 15px; }
        #contact-form input, #contact-form textarea { padding: 12px; border: 1px solid #ccc; border-radius: 4px; width: 100%; box-sizing: border-box; }
        #contact-form button { padding: 12px 24px; background-color: #333; color: white; border: none; border-radius: 4px; cursor: pointer; align-self: flex-start; font-weight: bold; }
        #contact-form button:hover { background-color: #555; }
        
        .progress-container { width: 100%; height: 8px; background: #eee; border-radius: 4px; margin: 15px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4285F4, #34a853); transition: width 0.3s ease; }
    </style>
</head>
     
<body>

<header class="site-header">
    <div class="wrap" style="text-align: center; padding: 20px 0;">
        <a class="site-title" style="text-decoration: none; font-size: 2rem; color: #333; font-weight: 800;" href="https://rospopa.com">Pavlo Rospopa Strategy Engine</a>
    </div>
</header>

<main>
    <div class="page-content">
        <div class="wrap">
            <div id="real-estate-guide-container">
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <button id="back-btn" style="background:none; border:none; color:#4285F4; cursor:pointer; font-weight:bold; display:none;">‚Üê Back</button>
                    <span id="step-counter" style="color:#888; font-size:0.9rem;">Start</span>
                </div>
                
                <div class="progress-container">
                    <div id="progress-bar-fill" class="progress-fill" style="width: 2%;"></div>
                </div>

                <div id="tree-content">
                    <h2 id="question-text" style="margin-bottom: 25px; font-size: 1.4rem; color: #222; font-weight: 700;">Loading Logic...</h2>
                    <div id="options-container"></div>
                </div>

                <div id="contact-form-container" style="display: none;">
                    <h3 style="margin-top:0;">Request This Strategy</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">Based on your answers, this is the most efficient path forward.</p>
                    <form id="contact-form">
                        <input type="text" name="name" placeholder="Your Name" required />
                        <input type="email" name="email" placeholder="Your Email" required />
                        <input type="tel" name="phone" placeholder="Phone Number (Optional)" />
                        <textarea id="message-field" name="message" rows="5" required></textarea>
                        <div class="g-recaptcha" data-sitekey="6Let_E8sAAAAAP948s5QuqjQ-HKYRuoXxLzILZ9p"></div>
                        <button type="submit" id="submit-btn">Send Request</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tree = {
        // --- ROOT ---
        start: {
            text: "What is your primary Real Estate Goal?",
            options: [
                { label: "Residential: Buying", next: "buy_node_1" },
                { label: "Residential: Selling", next: "sell_node_1" },
                { label: "Refinancing / Mortgage", next: "refi_node_1" }, // NEW BRANCH
                { label: "Wealth: Investing", next: "invest_node_1" },
                { label: "Commercial / Business", next: "comm_node_1" }
            ]
        },

        // ==========================================
        // BRANCH 1: BUYING (Expanded)
        // ==========================================
        buy_node_1: {
            text: "Are you buying locally or relocating?",
            options: [
                { label: "Buying Locally", next: "buy_history_check" },
                { label: "Relocating from Out of State", next: "buy_relo_timeline" }
            ]
        },
        buy_relo_timeline: {
            text: "When do you need to be in the new home?",
            options: [
                { label: "ASAP (Job Starting)", next: "strat_virtual_tour" },
                { label: "3+ Months (Flexible)", next: "buy_history_check" }
            ]
        },
        buy_history_check: {
            text: "Have you owned a home in the last 3 years?",
            options: [
                { label: "No (First-Time Buyer)", next: "buy_fthb_triage" },
                { label: "Yes (Repeat Buyer)", next: "buy_repeat_triage" }
            ]
        },
        buy_fthb_triage: {
            text: "What is your biggest hurdle right now?",
            options: [
                { label: "Down Payment", next: "buy_down_source" },
                { label: "Credit Score", next: "buy_credit_deep" },
                { label: "Income / Debt", next: "buy_income_check" }, // UPDATED
                { label: "Finding a House", next: "buy_inventory_triage" }
            ]
        },
        // --- INCOME & DEBT (NEW DEEP DIVE) ---
        buy_income_check: {
            text: "Do you have significant Student Loan debt?",
            options: [
                { label: "Yes, Student Loans", next: "buy_student_loan_calc" }, // NEW
                { label: "No, other debt/income issues", next: "buy_income_type" }
            ]
        },
        buy_student_loan_calc: {
            text: "Are you on an Income-Based Repayment (IBR) plan?",
            options: [
                { label: "Yes, IBR Plan", next: "strat_fha_ibr" },
                { label: "No, Standard Plan", next: "strat_conventional_1percent" }
            ]
        },
        buy_income_type: {
            text: "How is your income derived?",
            options: [
                { label: "W-2 Salary", next: "buy_co_signer_check" },
                { label: "Self-Employed", next: "buy_self_emp_years" },
                { label: "Commission/Bonus", next: "buy_variable_income" }
            ]
        },
        buy_co_signer_check: {
            text: "is your Debt-to-Income ratio tight? Do you have a Co-Signer?",
            options: [
                { label: "Yes, I have a Co-Signer", next: "strat_cosigner_fha" }, // NEW
                { label: "No, buying solo", next: "buy_career_grant" }
            ]
        },
        buy_career_grant: { // NEW
            text: "Are you a Teacher, Firefighter, or Police Officer?",
            options: [
                { label: "Yes", next: "strat_good_neighbor" },
                { label: "No", next: "res_fha_standard" }
            ]
        },
        buy_variable_income: {
            text: "Do you have a 2-year history of this variable income?",
            options: [
                { label: "Yes, consistent", next: "res_conventional_check" },
                { label: "No, it varies", next: "strat_base_income_only" }
            ]
        },
        buy_self_emp_years: {
            text: "Do your tax returns show strong net income?",
            options: [
                { label: "Yes, I show profit", next: "res_conventional_check" },
                { label: "No, high write-offs", next: "strat_bank_statement" }
            ]
        },
        // --- CREDIT ---
        buy_credit_deep: {
            text: "Approximate Credit Score?",
            options: [
                { label: "Excellent (720+)", next: "res_conventional_check" },
                { label: "Good (620-719)", next: "res_fha_standard" },
                { label: "Fair (580-619)", next: "buy_credit_issues" },
                { label: "Poor (<580)", next: "res_credit_repair" }
            ]
        },
        buy_credit_issues: {
            text: "Any open disputes or collections?",
            options: [
                { label: "Yes, Disputes", next: "strat_remove_disputes" },
                { label: "Bankruptcy <2 years", next: "strat_hard_money_buy" },
                { label: "Just high utilization", next: "res_credit_repair" }
            ]
        },
        // --- DOWN PAYMENT ---
        buy_down_source: {
            text: "Are you a Veteran?",
            options: [ { label: "Yes", next: "strat_va_loan" }, { label: "No", next: "buy_rural_check" } ]
        },
        buy_rural_check: {
            text: "Willing to buy Rural?",
            options: [ { label: "Yes", next: "strat_usda_loan" }, { label: "No", next: "buy_gift_check" } ]
        },
        buy_gift_check: {
            text: "Do you have gift funds?",
            options: [ { label: "Yes", next: "strat_gift_letter" }, { label: "No", next: "res_grant" } ]
        },
        // --- INVENTORY ---
        buy_inventory_triage: {
            text: "Property Type preference?",
            options: [
                { label: "Single Family", next: "buy_sfh_features" },
                { label: "Condo/Townhome", next: "buy_condo_check" },
                { label: "Multi-Unit", next: "strat_house_hack_invest" }
            ]
        },
        buy_sfh_features: {
            text: "Any specific needs?",
            options: [
                { label: "Multi-Generational", next: "strat_multigen_search" },
                { label: "Green/Solar", next: "strat_solar_check" },
                { label: "Standard", next: "strat_school_zone" }
            ]
        },
        buy_condo_check: {
            text: "Is the HOA healthy?",
            options: [ { label: "Yes/Unknown", next: "strat_condo_warrantable" }, { label: "No (Litigation)", next: "strat_non_warrantable" } ] // NEW
        },

        // --- REPEAT BUYER ---
        buy_repeat_triage: {
            text: "Sell current home first?",
            options: [ { label: "Yes", next: "buy_contingency" }, { label: "No", next: "buy_2nd_home" } ]
        },
        buy_contingency: {
            text: "Is it listed?",
            options: [ { label: "Yes", next: "strat_concurrent" }, { label: "No", next: "buy_equity_check" } ]
        },
        buy_equity_check: {
            text: "Equity > 30%?",
            options: [ { label: "Yes", next: "strat_bridge" }, { label: "No", next: "strat_sell_first" } ]
        },
        buy_2nd_home: {
            text: "Primary use?",
            options: [ { label: "Vacation", next: "strat_vacation" }, { label: "Investment", next: "strat_buy_hold" } ]
        },

        // ==========================================
        // BRANCH 2: SELLING
        // ==========================================
        sell_node_1: {
            text: "Have you tried selling recently?",
            options: [ { label: "Yes (Expired/FSBO)", next: "sell_fsbo_check" }, { label: "No", next: "sell_reason_check" } ]
        },
        sell_fsbo_check: {
            text: "Agent or FSBO?",
            options: [ { label: "FSBO", next: "strat_fsbo_conversion" }, { label: "Agent", next: "strat_expired_relist" } ]
        },
        sell_reason_check: {
            text: "Reason for selling?",
            options: [
                { label: "Move/Upgrade", next: "sell_taxes_check" },
                { label: "Distress/Debt", next: "sell_distress" },
                { label: "Divorce", next: "sell_divorce_status" },
                { label: "Probate/Inherited", next: "sell_probate" }
            ]
        },
        sell_taxes_check: {
            text: "Lived there 2 of last 5 years?",
            options: [ { label: "Yes", next: "sell_title_check" }, { label: "No", next: "strat_cap_gains_calc" } ]
        },
        sell_title_check: { // NEW
            text: "Is the home in a Trust?",
            options: [ { label: "Yes", next: "strat_trust_sale" }, { label: "No", next: "sell_financial_status" } ]
        },
        sell_divorce_status: {
            text: "Amicable or Contested?",
            options: [ { label: "Amicable", next: "sell_financial_status" }, { label: "Contested", next: "strat_divorce_neutral" } ]
        },
        sell_financial_status: {
            text: "Equity Status?",
            options: [ { label: "Positive", next: "sell_retail_condition" }, { label: "Negative", next: "sell_distress" } ]
        },
        sell_retail_condition: {
            text: "Condition of property?",
            options: [
                { label: "Major Defects", next: "sell_retail_fix" },
                { label: "Unpermitted Work", next: "strat_retro_permit" },
                { label: "Good Condition", next: "sell_occupancy_check" }
            ]
        },
        sell_retail_fix: {
            text: "Cash to fix?",
            options: [ { label: "Yes", next: "strat_concierge" }, { label: "No", next: "strat_instant" } ]
        },
        sell_occupancy_check: {
            text: "Occupant?",
            options: [
                { label: "Owner", next: "sell_timeline_urgency" },
                { label: "Vacant", next: "sell_luxury_check" },
                { label: "Tenant", next: "sell_tenant_lease" }
            ]
        },
        sell_tenant_lease: {
            text: "Lease Type?",
            options: [ { label: "Month-to-Month", next: "strat_concierge" }, { label: "Long Term", next: "strat_tenant_sale" }, { label: "Eviction needed", next: "strat_eviction_sale" } ]
        },
        sell_timeline_urgency: {
            text: "Next home lined up?",
            options: [ { label: "Yes", next: "strat_concierge" }, { label: "No", next: "strat_leaseback" } ]
        },
        sell_luxury_check: {
            text: "Value > $800k?",
            options: [ { label: "Yes", next: "sell_privacy_check" }, { label: "No", next: "strat_concierge" } ]
        },
        sell_privacy_check: {
            text: "Require privacy?",
            options: [ { label: "Yes", next: "strat_luxury_private" }, { label: "No", next: "strat_luxury_listing" } ]
        },
        // --- DISTRESS ---
        sell_distress: {
            text: "Any Liens?",
            options: [ { label: "Yes", next: "strat_title_clearance" }, { label: "No", next: "sell_mortgage_status" } ]
        },
        sell_mortgage_status: {
            text: "Behind on payments?",
            options: [ { label: "Yes", next: "sell_hardship" }, { label: "No", next: "strat_hold_rent" } ]
        },
        sell_hardship: {
            text: "Reverse Mortgage?",
            options: [ { label: "Yes", next: "strat_reverse_mortgage_sale" }, { label: "No", next: "sell_assets_check" } ]
        },
        sell_assets_check: {
            text: "Other Assets?",
            options: [ { label: "Yes", next: "strat_short_sale" }, { label: "No", next: "strat_deed_lieu" } ]
        },
        sell_probate: {
            text: "Letters of Office?",
            options: [ { label: "Yes", next: "sell_probate_heirs" }, { label: "No", next: "strat_probate_court" }, { label: "Unknown", next: "strat_probate_bond" } ]
        },
        sell_probate_heirs: {
            text: "Heirs agree?",
            options: [ { label: "Yes", next: "strat_probate_easy" }, { label: "No", next: "strat_probate_conflict" } ]
        },

        // ==========================================
        // BRANCH 3: REFINANCE (NEW MAIN BRANCH)
        // ==========================================
        refi_node_1: {
            text: "What is your primary goal for refinancing?",
            options: [
                { label: "Lower Monthly Payment", next: "refi_rate_check" },
                { label: "Pull Cash Out", next: "refi_cash_reason" },
                { label: "Remove Mortgage Insurance", next: "refi_pmi_check" }
            ]
        },
        refi_rate_check: {
            text: "What type of loan do you currently have?",
            options: [
                { label: "FHA or VA", next: "strat_streamline_refi" }, // NEW
                { label: "Conventional", next: "refi_credit_check" }
            ]
        },
        refi_credit_check: {
            text: "Is your credit score above 720?",
            options: [
                { label: "Yes", next: "strat_rate_term_refi" },
                { label: "No", next: "res_credit_repair" }
            ]
        },
        refi_cash_reason: {
            text: "What is the cash for?",
            options: [
                { label: "Debt Consolidation", next: "strat_debt_consolidation" }, // NEW
                { label: "Home Improvement", next: "strat_renovation_heloc" }, // NEW
                { label: "Investment Purchase", next: "strat_cash_out_invest" } // NEW
            ]
        },
        refi_pmi_check: {
            text: "Do you believe you have 20% equity now?",
            options: [
                { label: "Yes", next: "strat_pmi_removal" }, // NEW
                { label: "Not sure", next: "strat_appraisal_gap" }
            ]
        },

        // ==========================================
        // BRANCH 4: INVESTING
        // ==========================================
        invest_node_1: {
            text: "Preferred involvement?",
            options: [ { label: "Active", next: "inv_experience" }, { label: "Passive", next: "inv_passive_check" } ]
        },
        inv_experience: {
            text: "Experience level?",
            options: [ { label: "Experienced", next: "inv_active_risk" }, { label: "Beginner", next: "inv_beginner_path" } ]
        },
        inv_beginner_path: {
            text: "Capital available?",
            options: [ { label: "Under $50k", next: "strat_house_hack_invest" }, { label: "$50k+", next: "strat_turnkey" } ]
        },
        inv_active_risk: {
            text: "Vehicle?",
            options: [
                { label: "Flip", next: "strat_fix_flip" },
                { label: "Long Term Rental", next: "inv_unit_count" },
                { label: "Airbnb", next: "inv_airbnb_check" },
                { label: "Mid Term (Nurses)", next: "strat_mid_term_rental" },
                { label: "Section 8", next: "strat_section_8" },
                { label: "Raw Land", next: "inv_land_check" }
            ]
        },
        inv_airbnb_check: {
            text: "Management style?",
            options: [ { label: "Self-Manage", next: "strat_str_self" }, { label: "Property Manager", next: "strat_str_managed" } ]
        },
        inv_land_check: {
            text: "Improved or Raw?",
            options: [ { label: "Improved", next: "strat_land_build" }, { label: "Raw", next: "inv_land_survey" } ]
        },
        inv_land_survey: {
            text: "Perc Test done?",
            options: [ { label: "Yes", next: "strat_land_hold" }, { label: "No", next: "strat_land_feasibility" } ]
        },
        inv_unit_count: {
            text: "Size?",
            options: [ { label: "2-4 Units", next: "strat_buy_hold" }, { label: "5+ Units", next: "strat_multifamily_commercial" } ]
        },
        inv_passive_check: {
            text: "Accredited?",
            options: [ { label: "Yes", next: "strat_syndication" }, { label: "No", next: "strat_reit" } ]
        },

        // ==========================================
        // BRANCH 5: COMMERCIAL
        // ==========================================
        comm_node_1: {
            text: "Property Type?",
            options: [
                { label: "Retail/Restaurant", next: "comm_retail_node" },
                { label: "Office/Medical", next: "comm_office_node" },
                { label: "Industrial", next: "comm_industrial_node" },
                { label: "Gas Station/Auto", next: "comm_env_check" } // NEW
            ]
        },
        comm_env_check: {
            text: "Are there existing environmental reports (Phase 1)?",
            options: [
                { label: "Yes, clean", next: "strat_sba_504" },
                { label: "No / Unknown", next: "strat_phase_1_env" } // NEW
            ]
        },
        comm_retail_node: {
            text: "Use?",
            options: [ { label: "Restaurant", next: "strat_restaurant_buy" }, { label: "General Retail", next: "comm_lease_own" } ]
        },
        comm_office_node: {
            text: "Use?",
            options: [ { label: "Medical", next: "strat_medical_office" }, { label: "General", next: "comm_lease_own" } ]
        },
        comm_industrial_node: {
            text: "Ceiling Height?",
            options: [ { label: "<14ft", next: "strat_flex_space" }, { label: ">18ft", next: "comm_zoning_check" } ]
        },
        comm_zoning_check: {
            text: "Zoning compliant?",
            options: [ { label: "Yes", next: "comm_power_check" }, { label: "No", next: "strat_zoning_attorney" } ]
        },
        comm_power_check: {
            text: "3-Phase Power needed?",
            options: [ { label: "Yes", next: "strat_heavy_industrial" }, { label: "No", next: "strat_industrial_logistics" } ]
        },
        comm_lease_own: {
            text: "Strategy?",
            options: [ { label: "Buy", next: "strat_sba_504" }, { label: "Lease", next: "strat_lease_audit" }, { label: "Biz Only", next: "strat_biz_opp" } ]
        },

        // ==========================================
        // OUTCOMES
        // ==========================================
        
        // --- REFI OUTCOMES (NEW) ---
        strat_streamline_refi: { text: "Strategy: FHA/VA Streamline Refinance. This is a low-doc loan. No appraisal, no income verification. If you have an FHA/VA loan and want a lower rate, this is the fastest path.", options: [] },
        strat_rate_term_refi: { text: "Strategy: Rate & Term Refinance. We simply replace your current mortgage with a new one at a lower rate. This keeps your equity intact but lowers monthly overhead.", options: [] },
        strat_debt_consolidation: { text: "Strategy: Debt Consolidation Refi. We use your equity to pay off high-interest credit cards (20%+ APR). Your mortgage balance goes up, but your total monthly payments drop significantly.", options: [] },
        strat_renovation_heloc: { text: "Strategy: HELOC for Renovation. Instead of losing your low rate on your primary mortgage, we open a Home Equity Line of Credit (2nd position) to fund the repairs.", options: [] },
        strat_cash_out_invest: { text: "Strategy: Cash-Out for Investment. We pull equity to use as a down payment on a rental property. This leverages your 'lazy equity' to build wealth elsewhere.", options: [] },
        strat_pmi_removal: { text: "Strategy: PMI Removal. We can order a new appraisal. If the value supports 20% equity, we petition the servicer to remove the mortgage insurance without a full refinance.", options: [] },
        strat_appraisal_gap: { text: "Strategy: Appraisal Gap Analysis. Before spending money on a refi, I will run a comparative market analysis (CMA) to ensure your home will appraise high enough to drop the PMI.", options: [] },

        // --- BUYER OUTCOMES ---
        strat_fha_ibr: { text: "Strategy: FHA + IBR. FHA loans allow us to use your actual Income-Based Repayment amount (often $0 or low) for DTI calculations, rather than 1% of the loan balance.", options: [] },
        strat_conventional_1percent: { text: "Strategy: Conventional Student Loan Calc. Conventional loans typically count 1% of the balance or the fully amortized payment. We must ensure your DTI fits this tighter box.", options: [] },
        strat_cosigner_fha: { text: "Strategy: Non-Occupying Co-Borrower. FHA allows a family member who doesn't live with you to co-sign. We blend their income with yours to boost purchasing power.", options: [] },
        strat_good_neighbor: { text: "Strategy: Good Neighbor Next Door / Hero Programs. HUD offers 50% off list price on certain homes for teachers/police. Alternatively, we use local 'Hero' grants for down payment assistance.", options: [] },
        strat_condo_warrantable: { text: "Strategy: Warrantable Condo. The HOA is healthy. We can use standard financing with low rates.", options: [] },
        strat_non_warrantable: { text: "Strategy: Non-Warrantable Financing. The HOA has issues (litigation/too many renters). We must use a portfolio lender who keeps the loan in-house. Rates will be 1-2% higher.", options: [] },
        strat_solar_check: { text: "Strategy: Solar Lease Transfer. We must review the solar contract immediately. If the lease payments are high, they affect your DTI. We need the lessor to approve the transfer before closing.", options: [] },
        strat_multigen_search: { text: "Strategy: Multi-Gen Zoning. We will target homes with first-floor suites. We must verify zoning allows for 'Related Living' to avoid issues with second kitchens.", options: [] },
        strat_rsu_income: { text: "Strategy: RSU Income Qualification. We need a lender who understands Restricted Stock Units. We must show a vesting schedule and 2-year history to count this income.", options: [] },
        strat_asset_depletion: { text: "Strategy: Asset Depletion Loan. High assets, low income. We divide your liquid assets by 360 to create a 'phantom income' for qualification.", options: [] },
        strat_remove_disputes: { text: "Strategy: Credit Dispute Removal. Open disputes block mortgages. We must verify the dispute is removed from the credit report before submitting the application.", options: [] },
        strat_gift_letter: { text: "Strategy: Formal Gift Letter. The donor must sign a specific letter stating the funds are not a loan. We must track the wire trail perfectly.", options: [] },

        // --- SELLER OUTCOMES ---
        strat_trust_sale: { text: "Strategy: Trust Sale. We need the 'Certificate of Trust'. The trustee must sign all listing documents. This bypasses probate but requires strict paperwork adherence.", options: [] },
        strat_retro_permit: { text: "Strategy: Retroactive Permitting. Unpermitted work is a liability. We will ask the municipality for a retroactive inspection or purchase an indemnity policy.", options: [] },
        strat_title_clearance: { text: "Strategy: Title Clearance. We must pull a prelim title report immediately to see if the liens exceed the equity. If so, this becomes a Short Sale.", options: [] },
        strat_reverse_mortgage_sale: { text: "Strategy: HECM Payoff. The loan becomes due immediately upon move-out. We must coordinate with the servicer to ensure the payoff doesn't eat all proceeds.", options: [] },

        // --- COMMERCIAL OUTCOMES ---
        strat_phase_1_env: { text: "Strategy: Phase 1 Environmental. For gas stations or auto shops, banks require a Phase 1 study to check for soil contamination. If it fails, a Phase 2 (drilling) is required.", options: [] },
        strat_heavy_industrial: { text: "Strategy: Heavy Industrial (3-Phase). We will filter for properties with existing heavy power to avoid the $50k+ cost of upgrading transformers.", options: [] },
        strat_mid_term_rental: { text: "Strategy: Mid-Term Rental (MTR). We target traveling nurses near hospitals. Higher rent than long-term, less turnover than Airbnb.", options: [] },
        strat_section_8: { text: "Strategy: Section 8 Guaranteed Rent. We target areas with high voucher payment standards to recession-proof your cash flow.", options: [] },
        strat_land_feasibility: { text: "Strategy: Feasibility Contingency. Offer is contingent on a Perc Test and Soil Survey. We cannot buy raw land without knowing if it perks for a septic system.", options: [] },

        // --- RETAINED OUTCOMES ---
        strat_virtual_tour: { text: "Strategy: Virtual Relocation. Live video tours + Sight Unseen rider with 3-day rescission period.", options: [] },
        strat_jumbo_loan: { text: "Strategy: Jumbo Financing. Portfolio lenders for loans over $766k.", options: [] },
        strat_usda_loan: { text: "Strategy: USDA Rural Development. 0% down in eligible rural areas.", options: [] },
        strat_fsbo_conversion: { text: "Strategy: MLS Exposure Plan. Unlock the 97% of buyers represented by agents.", options: [] },
        strat_expired_relist: { text: "Strategy: Fresh Market Refresh. New photos, new price, new description.", options: [] },
        strat_cap_gains_calc: { text: "Strategy: Tax Deferred Analysis. Calculate 1031 Exchange vs Capital Gains tax.", options: [] },
        strat_private_showings: { text: "Strategy: Appointment-Only. No open houses, strict vetting of buyers.", options: [] },
        strat_str_self: { text: "Strategy: Self-Managed Airbnb. Automate cleaning and messaging to keep revenue high.", options: [] },
        strat_str_managed: { text: "Strategy: Managed STR. Pay 20% for passive income. Underwrite accordingly.", options: [] },
        strat_land_build: { text: "Strategy: Construction-to-Perm Loan. Buy the lot and build with one closing.", options: [] },
        strat_zoning_attorney: { text: "Strategy: Zoning Contingency. Offer contingent on Special Use Permit approval.", options: [] },
        strat_biz_opp: { text: "Strategy: Business Asset Sale. Audit P&L and buy the cash flow, not the real estate.", options: [] },
        strat_bank_statement: { text: "Strategy: Bank Statement Loan. Qualify using 12mo deposits instead of tax returns.", options: [] },
        strat_physician_loan: { text: "Strategy: Physician Loan. Exclude student debt from DTI, low down payment.", options: [] },
        strat_manual_underwriting: { text: "Strategy: Manual Underwriting. Manual review of rent/utility history for credit approval.", options: [] },
        strat_hard_money_buy: { text: "Strategy: Hard Money Bridge. Secure property now, refinance later.", options: [] },
        strat_new_construction: { text: "Strategy: Builder Representation. Negotiate upgrades and pre-drywall inspections.", options: [] },
        strat_divorce_neutral: { text: "Strategy: Neutral Third-Party Sale. Unbiased representation for contested divorce sales.", options: [] },
        strat_senior_transition: { text: "Strategy: Rightsizing. Coordinate estate sales and move to 55+ community.", options: [] },
        strat_luxury_private: { text: "Strategy: Private Placement. Off-market sale to high-net-worth network.", options: [] },
        strat_eviction_sale: { text: "Strategy: Cash-for-Keys. Pay tenant to leave to ensure a clean sale.", options: [] },
        strat_probate_conflict: { text: "Strategy: Mediator Sale. Transparent offer presentation to all heirs.", options: [] },
        strat_house_hack_invest: { text: "Strategy: House Hack. FHA 3.5% down on 2-4 unit property.", options: [] },
        strat_multifamily_commercial: { text: "Strategy: DSCR Loan. Loan based on property income, not personal DTI.", options: [] },
        strat_restaurant_buy: { text: "Strategy: 2nd Gen Restaurant. Buy existing hood/grease trap to save capital.", options: [] },
        strat_medical_office: { text: "Strategy: TI Negotiation. Get landlord to pay for plumbing/buildout.", options: [] },
        strat_flex_space: { text: "Strategy: Flex Space. Rear loading + front office in business park.", options: [] },
        strat_commuter_hub: { text: "Strategy: Transit-Oriented. Buy within walking distance of Train.", options: [] },
        strat_school_zone: { text: "Strategy: District Search. Filter strictly by school rating boundaries.", options: [] },
        strat_va_loan: { text: "Strategy: VA Loan. 0% down, no PMI for veterans.", options: [] },
        strat_203k_rehab: { text: "Strategy: FHA 203k. Purchase + Rehab costs in one loan.", options: [] },
        res_grant: { text: "Strategy: Down Payment Assistance. IHDA grants for cash-to-close.", options: [] },
        res_fha_standard: { text: "Strategy: FHA 3.5%. Low down payment for scores 620+.", options: [] },
        res_credit_repair: { text: "Strategy: Credit Roadmap. Pause search to fix DTI and score.", options: [] },
        strat_concurrent: { text: "Strategy: Concurrent Closing. Sell AM, Buy PM.", options: [] },
        strat_bridge: { text: "Strategy: Bridge Loan. Use current equity to buy next home first.", options: [] },
        strat_sell_first: { text: "Strategy: Home of Choice Contingency. Sell first, but only if you find a home.", options: [] },
        strat_vacation: { text: "Strategy: STR Analysis. Verify ROI and local regulations.", options: [] },
        strat_leaseback: { text: "Strategy: Rent-Back. Stay in home 60 days after selling.", options: [] },
        strat_luxury_listing: { text: "Strategy: Lifestyle Marketing. Global syndication and high-end media.", options: [] },
        strat_tenant_sale: { text: "Strategy: Cap Rate Sale. Market cash flow to investors.", options: [] },
        strat_concierge: { text: "Strategy: Concierge Listing. Staging and prep for max price.", options: [] },
        strat_instant: { text: "Strategy: Instant Offer. Speed over price.", options: [] },
        strat_hold_rent: { text: "Strategy: Rent & Hold. Wait for equity to recover.", options: [] },
        strat_short_sale: { text: "Strategy: Short Sale. Negotiate debt forgiveness with bank.", options: [] },
        strat_deed_lieu: { text: "Strategy: Deed in Lieu. Voluntary foreclosure to save time.", options: [] },
        strat_probate_easy: { text: "Strategy: Independent Admin. Fast probate sale.", options: [] },
        strat_probate_court: { text: "Strategy: Court Approval. 60-day closing for judge sign-off.", options: [] },
        strat_probate_bond: { text: "Strategy: Bond in Lieu. Sell before probate ends.", options: [] },
        strat_turnkey: { text: "Strategy: Turnkey. Buy renovated/tenanted property.", options: [] },
        strat_dst: { text: "Strategy: DST 1031. Passive replacement property.", options: [] },
        strat_fix_flip: { text: "Strategy: 70% Rule. Buy deep discount for rehab.", options: [] },
        strat_brrrr: { text: "Strategy: BRRRR. Refinance to pull capital out.", options: [] },
        strat_buy_hold: { text: "Strategy: Cash Flow. 2-4 units for long term wealth.", options: [] },
        strat_syndication: { text: "Strategy: Syndication LP. Passive commercial investing.", options: [] },
        strat_reit: { text: "Strategy: REIT. Liquid real estate stock.", options: [] },
        strat_hold_refi: { text: "Strategy: Cash-Out Refi. Buy more assets with equity.", options: [] },
        strat_1031: { text: "Strategy: 1031 Exchange. Defer taxes on sale.", options: [] },
        strat_sba_504: { text: "Strategy: SBA 504. 10% down for business owners.", options: [] },
        strat_lease_audit: { text: "Strategy: NNN Audit. Check CAM charges.", options: [] },
        strat_lease_base_year: { text: "Strategy: Base Year Stop. Cap expense increases.", options: [] },
        strat_industrial_logistics: { text: "Strategy: Logistics Focus. 14ft doors and highway access.", options: [] },
        res_conventional_check: { text: "Strategy: Conventional Loan. 3-5% down, PMI drops off.", options: [] }
    };

    let currentNode = 'start';
    let history = []; 
    let pathLabels = []; 

    const elements = {
        question: document.getElementById('question-text'),
        options: document.getElementById('options-container'),
        backBtn: document.getElementById('back-btn'),
        progress: document.getElementById('progress-bar-fill'),
        step: document.getElementById('step-counter'),
        formContainer: document.getElementById('contact-form-container'),
        message: document.getElementById('message-field')
    };

    function renderNode() {
        const node = tree[currentNode];
        if(!node) {
            console.error("Node not found:", currentNode);
            return;
        }

        elements.question.innerText = node.text;
        elements.options.innerHTML = '';
        
        const isResult = node.options.length === 0;
        const stepCount = history.length + 1;
        
        elements.step.innerText = isResult ? 'Recommendation Found' : `Step ${stepCount}`;
        elements.progress.style.width = isResult ? '100%' : Math.min(stepCount * 6, 95) + '%';
        elements.backBtn.style.display = (history.length > 0) ? 'block' : 'none';

        if (isResult) {
            elements.question.classList.add('result-card');
            elements.formContainer.style.display = 'block';
            
            let complianceNote = "\n\n*Local Compliance Note (Villa Park/IL):* \n- Transfer Stamps: $0 (Villa Park), but Inspection Required ($50).\n- Mandatory Disclosures: IL Radon, Lead-Based Paint (Pre-1978).";
            elements.message.value = "Client Path: " + pathLabels.join(" > ") + "\n\nGenerated Strategy: " + node.text + complianceNote;
            
            const restartBtn = document.createElement('button');
            restartBtn.innerText = "Start Over / Try Another Scenario";
            restartBtn.className = "tree-option-btn";
            restartBtn.style.textAlign = "center";
            restartBtn.style.marginTop = "20px";
            restartBtn.style.background = "#fff";
            restartBtn.onclick = () => { 
                history = []; 
                pathLabels = []; 
                currentNode = 'start'; 
                renderNode(); 
            };
            elements.options.appendChild(restartBtn);
        } else {
            elements.question.classList.remove('result-card');
            elements.formContainer.style.display = 'none';
            node.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt.label;
                btn.className = "tree-option-btn";
                btn.onclick = () => {
                    history.push(currentNode);
                    pathLabels.push(opt.label);
                    currentNode = opt.next;
                    renderNode();
                };
                elements.options.appendChild(btn);
            });
        }
    }

    elements.backBtn.onclick = () => {
        if (history.length > 0) {
            currentNode = history.pop();
            pathLabels.pop();
            renderNode();
        }
    };

    renderNode();
});
</script>
</body>
</html>
