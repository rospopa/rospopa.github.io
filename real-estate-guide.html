<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Pavlo Rospopa Universe Strategy Engine</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/format.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <style>
        body { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f9; }
        input, textarea { -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; }

        #real-estate-guide-container {
            margin: 40px auto; padding: 30px; border: 1px solid #e0e0e0; border-radius: 12px;
            background-color: #ffffff; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; z-index: 101;
            max-width: 950px;
        }
        .tree-option-btn {
            padding: 12px 16px; background-color: #f8f9fa; color: #333; border: 2px solid #eef0f2;
            border-radius: 8px; cursor: pointer; font-size: 0.95rem; text-align: left;
            transition: all 0.2s; font-weight: 500; width: 100%; margin-bottom: 6px; display: block;
        }
        .tree-option-btn:hover { border-color: #4285F4; color: #4285F4; transform: translateX(4px); }
        .result-card { background: #f4f7ff; border-left: 6px solid #4285F4; padding: 25px; border-radius: 8px; color: #334155; line-height: 1.7; margin-bottom: 20px; }

        #contact-form-container { margin: 40px 0; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; background-color: #f9f9f9; }
        #contact-form { display: flex; flex-direction: column; gap: 15px; }
        #contact-form input, #contact-form textarea { padding: 12px; border: 1px solid #ccc; border-radius: 4px; width: 100%; box-sizing: border-box; }
        #contact-form button { padding: 12px 24px; background-color: #333; color: white; border: none; border-radius: 4px; cursor: pointer; align-self: flex-start; font-weight: bold; }
        #contact-form button:hover { background-color: #555; }
        
        .progress-container { width: 100%; height: 8px; background: #eee; border-radius: 4px; margin: 15px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4285F4, #34a853); transition: width 0.3s ease; }
    </style>
</head>
     
<body>

<header class="site-header">
    <div class="wrap" style="text-align: center; padding: 20px 0;">
        <a class="site-title" style="text-decoration: none; font-size: 2rem; color: #333; font-weight: 800;" href="https://rospopa.com">Pavlo Rospopa Strategy Engine</a>
    </div>
</header>

<main>
    <div class="page-content">
        <div class="wrap">
            <div id="real-estate-guide-container">
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <button id="back-btn" style="background:none; border:none; color:#4285F4; cursor:pointer; font-weight:bold; display:none;">‚Üê Back</button>
                    <span id="step-counter" style="color:#888; font-size:0.9rem;">Start</span>
                </div>
                
                <div class="progress-container">
                    <div id="progress-bar-fill" class="progress-fill" style="width: 1%;"></div>
                </div>

                <div id="tree-content">
                    <h2 id="question-text" style="margin-bottom: 25px; font-size: 1.4rem; color: #222; font-weight: 700;">Loading Logic...</h2>
                    <div id="options-container"></div>
                </div>

                <div id="contact-form-container" style="display: none;">
                    <h3 style="margin-top:0;">Request This Strategy</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">Based on your answers, this is the most efficient path forward.</p>
                    <form id="contact-form">
                        <input type="text" name="name" placeholder="Your Name" required />
                        <input type="email" name="email" placeholder="Your Email" required />
                        <input type="tel" name="phone" placeholder="Phone Number (Optional)" />
                        <textarea id="message-field" name="message" rows="5" required></textarea>
                        <div class="g-recaptcha" data-sitekey="6Let_E8sAAAAAP948s5QuqjQ-HKYRuoXxLzILZ9p"></div>
                        <button type="submit" id="submit-btn">Send Request</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tree = {
        // --- ROOT ---
        start: {
            text: "What is your primary Real Estate Goal?",
            options: [
                { label: "Residential: Buying", next: "buy_node_1" },
                { label: "Residential: Selling", next: "sell_node_1" },
                { label: "Refinancing / Mortgage", next: "refi_node_1" },
                { label: "Wealth: Investing", next: "invest_node_1" },
                { label: "Commercial / Business", next: "comm_node_1" },
                { label: "Land / Development", next: "land_node_1" }
            ]
        },

        // ==========================================
        // BRANCH 1: BUYING (UNIVERSE EXPANSION)
        // ==========================================
        buy_node_1: {
            text: "Are you a US Citizen or Permanent Resident?",
            options: [
                { label: "Yes", next: "buy_loc_status" },
                { label: "No (Visa/Foreign National)", next: "buy_visa_status" }
            ]
        },
        buy_visa_status: { 
            text: "Do you have a valid Work Visa or ITIN?",
            options: [
                { label: "Work Visa (H1B, etc)", next: "buy_loc_status" },
                { label: "ITIN Number only", next: "strat_itin_loan" },
                { label: "Foreign National (No US Credit)", next: "strat_foreign_national" }
            ]
        },
        buy_loc_status: {
            text: "Buying Locally, Relocating, or Auction?",
            options: [
                { label: "Buying Locally", next: "buy_entity_check" },
                { label: "Relocating", next: "buy_relo_timeline" },
                { label: "Online Auction/Foreclosure", next: "buy_auction_type" }
            ]
        },
        buy_auction_type: {
            text: "Auction Platform?",
            options: [
                { label: "Hubzu / Xome / Auction.com", next: "strat_auction_tech_fee" },
                { label: "Sheriff's Sale (Courthouse)", next: "strat_sheriff_cash" }
            ]
        },
        buy_entity_check: {
            text: "Buying as Individual or Entity?",
            options: [
                { label: "Individual / Couple", next: "buy_co_buy_check" },
                { label: "LLC / Corp", next: "buy_llc_purpose" },
                { label: "Family Trust", next: "strat_trust_purchase" }
            ]
        },
        buy_llc_purpose: {
            text: "Is the LLC for Investment or Privacy?",
            options: [
                { label: "Investment (Rental)", next: "strat_dscr_llc" },
                { label: "Privacy (High Net Worth)", next: "strat_blind_trust" }
            ]
        },
        buy_relo_timeline: {
            text: "Is this a Corporate Move or Self-Move?",
            options: [
                { label: "Corporate Package", next: "strat_corp_relo" },
                { label: "Self-Move / Job Change", next: "buy_job_gap_check" }
            ]
        },
        buy_job_gap_check: {
            text: "Will you have a gap in employment during the move?",
            options: [
                { label: "No, immediate start", next: "strat_virtual_tour" },
                { label: "Yes, >30 days gap", next: "strat_employment_gap_letter" }
            ]
        },
        buy_co_buy_check: {
            text: "Who are you buying with?",
            options: [
                { label: "Just me / Spouse", next: "buy_history_check" },
                { label: "Unmarried Partner / Friend", next: "strat_co_buy_agreement" },
                { label: "Parent / Co-Signer", next: "strat_cosigner_fha" },
                { label: "Buying from Family", next: "strat_identity_interest" }
            ]
        },
        buy_history_check: {
            text: "Have you owned a home in the last 3 years?",
            options: [
                { label: "No (First-Time Buyer)", next: "buy_fthb_triage" },
                { label: "Yes (Repeat Buyer)", next: "buy_repeat_triage" }
            ]
        },
        
        // --- FINANCING TRIAGE ---
        buy_fthb_triage: {
            text: "What is your biggest hurdle right now?",
            options: [
                { label: "Down Payment", next: "buy_down_source" },
                { label: "Credit Score", next: "buy_credit_deep" },
                { label: "Income Type", next: "buy_income_check" },
                { label: "Debt Load", next: "buy_debt_check" },
                { label: "Inventory Strategy", next: "buy_inventory_triage" }
            ]
        },
        // --- DEBT EXPANSION ---
        buy_debt_check: {
            text: "What is causing high Debt-to-Income (DTI)?",
            options: [
                { label: "Car Payments", next: "strat_lease_exclusion" },
                { label: "Student Loans", next: "buy_student_loan_calc" },
                { label: "Credit Cards", next: "strat_debt_paydown" },
                { label: "Alimony/Child Support", next: "buy_support_term" }
            ]
        },
        buy_support_term: {
            text: "How many months of payments remain?",
            options: [
                { label: "Less than 10 months", next: "strat_exclude_support" },
                { label: "More than 10 months", next: "strat_manual_underwriting" }
            ]
        },
        // --- INCOME EXPANSION ---
        buy_income_check: {
            text: "Income Source?",
            options: [
                { label: "W-2 Salary", next: "buy_w2_tenure" },
                { label: "Self-Employed", next: "buy_se_type" },
                { label: "Commission/Bonus", next: "buy_var_income" },
                { label: "Tip Income", next: "buy_tip_income" },
                { label: "Fixed (SS/Pension)", next: "strat_fixed_income_gross_up" },
                { label: "Alimony Received", next: "buy_alimony_receipt" }
            ]
        },
        buy_alimony_receipt: {
            text: "Do you have proof of receipt?",
            options: [
                { label: "Yes, 6+ months", next: "strat_alimony_income" },
                { label: "No, irregular", next: "strat_bank_statement" }
            ]
        },
        buy_w2_tenure: {
            text: "Time at current job?",
            options: [
                { label: "2+ Years", next: "res_fha_standard" },
                { label: "<6 Months (Probation)", next: "strat_probation_letter" }
            ]
        },
        buy_se_type: {
            text: "Tax Filing Type?",
            options: [
                { label: "Sole Prop (Sched C)", next: "buy_se_writeoffs" },
                { label: "S-Corp / K-1", next: "buy_scorp_income" }
            ]
        },
        buy_se_writeoffs: {
            text: "Do you write off most expenses?",
            options: [
                { label: "Yes, low net income", next: "buy_bank_statement_check" },
                { label: "No, high net income", next: "res_conventional_check" }
            ]
        },
        buy_bank_statement_check: {
            text: "12 months business bank statements?",
            options: [
                { label: "Yes, consistent deposits", next: "strat_bank_statement" },
                { label: "No, mostly cash", next: "strat_1099_only_loan" }
            ]
        },
        buy_scorp_income: {
            text: "Years in business?",
            options: [
                { label: "5+ Years", next: "strat_1yr_tax_return" },
                { label: "2-4 Years", next: "res_conventional_check" },
                { label: "<2 Years", next: "strat_manual_underwriting" }
            ]
        },
        buy_student_loan_calc: {
            text: "Are you on an Income-Based Repayment (IBR) plan?",
            options: [
                { label: "Yes, IBR Plan", next: "strat_fha_ibr" },
                { label: "No, Standard Plan", next: "strat_conventional_1percent" }
            ]
        },
        buy_overtime_check: {
            text: "Do you rely on Overtime pay to qualify?",
            options: [
                { label: "Yes, need OT income", next: "strat_ot_avg" },
                { label: "No, Base Salary is enough", next: "res_fha_standard" }
            ]
        },
        buy_variable_income: {
            text: "Do you have a 2-year history of this variable income?",
            options: [
                { label: "Yes, consistent", next: "res_conventional_check" },
                { label: "No, it varies", next: "strat_base_income_only" }
            ]
        },
        buy_tip_income: {
            text: "Do you report all your tips to the IRS?",
            options: [
                { label: "Yes, fully reported", next: "res_fha_standard" },
                { label: "No, mostly cash", next: "strat_bank_statement" }
            ]
        },
        
        // --- CREDIT EXPANSION ---
        buy_credit_deep: {
            text: "Score Range?",
            options: [
                { label: "720+", next: "res_conventional_check" },
                { label: "620-719", next: "res_fha_standard" },
                { label: "580-619", next: "buy_credit_issues" },
                { label: "<580", next: "res_credit_repair" }
            ]
        },
        buy_credit_issues: {
            text: "Specific Issue?",
            options: [
                { label: "Bankruptcy", next: "buy_bk_type" },
                { label: "Foreclosure", next: "buy_foreclosure_date" },
                { label: "Collections", next: "strat_medical_collections" }
            ]
        },
        buy_bk_type: {
            text: "Chapter 7 or 13?",
            options: [
                { label: "Chapter 7", next: "buy_bk7_date" },
                { label: "Chapter 13", next: "strat_bk13_manual" }
            ]
        },
        buy_bk7_date: {
            text: "Discharge Date?",
            options: [
                { label: "<2 Years ago", next: "strat_hard_money_buy" },
                { label: "2-4 Years ago", next: "res_fha_standard" },
                { label: "4+ Years ago", next: "res_conventional_check" }
            ]
        },
        buy_foreclosure_date: {
            text: "Foreclosure Date?",
            options: [
                { label: "<3 Years ago", next: "strat_non_qm_foreclosure" },
                { label: "3-7 Years ago", next: "res_fha_standard" },
                { label: "7+ Years ago", next: "res_conventional_check" }
            ]
        },

        // --- PROPERTY TYPE EXPANSION ---
        buy_inventory_triage: {
            text: "Property Type?",
            options: [
                { label: "Standard SFH", next: "buy_sfh_features" },
                { label: "Condo/Co-Op", next: "buy_condo_type" },
                { label: "Niche/Unique", next: "buy_niche_prop" },
                { label: "Manufactured", next: "buy_manu_type" }
            ]
        },
        buy_condo_type: {
            text: "Condo or Co-Op?",
            options: [
                { label: "Condo", next: "buy_condo_check" },
                { label: "Co-Op", next: "strat_coop_board" }
            ]
        },
        buy_condo_check: {
            text: "Is the HOA healthy?",
            options: [
                { label: "Yes/Unknown", next: "buy_condo_reserves" }, // NEW
                { label: "No (Litigation)", next: "strat_non_warrantable" }
            ]
        },
        buy_condo_reserves: { // NEW
            text: "Does the HOA transfer 10% to reserves?",
            options: [
                { label: "Yes", next: "strat_condo_warrantable" },
                { label: "No", next: "strat_limited_review_condo" }
            ]
        },
        buy_manu_type: {
            text: "Do you own the land?",
            options: [
                { label: "Yes (Real Property)", next: "buy_manu_foundation" },
                { label: "No (Leased Land)", next: "strat_chattel_loan" }
            ]
        },
        buy_manu_foundation: {
            text: "Is it on a permanent foundation?",
            options: [
                { label: "Yes, HUD Tags present", next: "strat_fha_manufactured" },
                { label: "No / Pre-1976", next: "strat_cash_only_manu" }
            ]
        },
        buy_niche_prop: {
            text: "Specific Style?",
            options: [
                { label: "Barndominium", next: "strat_barndominium" },
                { label: "Log Cabin", next: "strat_log_cabin" },
                { label: "Geodesic Dome / Earth", next: "strat_unique_appraisal" },
                { label: "Waterfront", next: "buy_waterfront_check" } // NEW
            ]
        },
        buy_waterfront_check: { // NEW
            text: "Does it have water rights?",
            options: [
                { label: "Riparian (River)", next: "strat_riparian_rights" },
                { label: "Littoral (Lake)", next: "strat_littoral_rights" }
            ]
        },
        buy_sfh_features: {
            text: "Any specific needs?",
            options: [
                { label: "Multi-Generational", next: "strat_multigen_search" },
                { label: "Green/Solar", next: "strat_solar_check" },
                { label: "Pool", next: "strat_pool_inspection" },
                { label: "Basement/Foundation", next: "buy_foundation_check" }
            ]
        },
        buy_foundation_check: {
            text: "Foundation Preference?",
            options: [
                { label: "Full Basement", next: "strat_radon_mitigation" },
                { label: "Crawl Space", next: "strat_crawl_encapsulation" },
                { label: "Slab", next: "strat_plumbing_scope" }
            ]
        },
        buy_offer_market: {
            text: "How competitive is the market?",
            options: [
                { label: "Bidding Wars", next: "buy_aggressive_offer" },
                { label: "Balanced/Slow", next: "buy_inspection_pref" }
            ]
        },
        buy_aggressive_offer: {
            text: "Willing to cover Appraisal Gap?",
            options: [
                { label: "Yes, I have cash", next: "strat_appraisal_gap_guarantee" },
                { label: "No, max budget", next: "strat_escalation_clause" },
                { label: "Love Letter?", next: "strat_fair_housing_risk" }
            ]
        },
        buy_inspection_pref: {
            text: "Inspection preferences?",
            options: [
                { label: "Info Only (Pass/Fail)", next: "strat_info_only_inspection" },
                { label: "Full Negotiation", next: "buy_age_check" }
            ]
        },
        buy_age_check: {
            text: "Homes built before 1978?",
            options: [
                { label: "Yes (Vintage)", next: "buy_vintage_risk" },
                { label: "No (Modern)", next: "buy_system_check" }
            ]
        },
        buy_vintage_risk: {
            text: "Concerned about lead/asbestos?",
            options: [
                { label: "Yes, Safety First", next: "strat_lead_paint" },
                { label: "No, I will rehab", next: "buy_rehab_loan" }
            ]
        },
        buy_rehab_loan: {
            text: "Scope of Rehab?",
            options: [
                { label: "Cosmetic (<$35k)", next: "strat_fha_203k_limited" },
                { label: "Structural (Additions)", next: "strat_fha_203k_standard" }
            ]
        },
        buy_system_check: {
            text: "Water/Sewer Source?",
            options: [
                { label: "Public/City", next: "strat_sewer_scope" },
                { label: "Private Well/Septic", next: "buy_well_type" }
            ]
        },
        buy_well_type: {
            text: "Type of Well?",
            options: [
                { label: "Private on Property", next: "strat_well_water_test" },
                { label: "Shared Well", next: "strat_shared_well_agreement" }
            ]
        },
        
        // --- DOWN PAYMENT ---
        buy_down_source: {
            text: "Are you a Veteran?",
            options: [ { label: "Yes", next: "buy_va_check" }, { label: "No", next: "buy_rural_check" } ]
        },
        buy_va_check: {
            text: "Do you have full entitlement available?",
            options: [ { label: "Yes / First Use", next: "buy_va_disability" }, { label: "No / Subsequent Use", next: "strat_va_bonus_entitlement" } ]
        },
        buy_va_disability: {
            text: "Service-connected disability?",
            options: [ { label: "Yes (10%+)", next: "strat_va_fee_waiver" }, { label: "No", next: "strat_va_loan" } ]
        },
        buy_rural_check: {
            text: "Willing to buy Rural?",
            options: [ { label: "Yes", next: "strat_usda_loan" }, { label: "No", next: "buy_gift_check" } ]
        },
        buy_gift_check: {
            text: "Do you have gift funds?",
            options: [ { label: "Yes", next: "buy_gift_seasoning" }, { label: "No", next: "buy_401k_check" } ]
        },
        buy_401k_check: {
            text: "Do you have a 401k?",
            options: [
                { label: "Yes, I can borrow", next: "strat_401k_loan" },
                { label: "No, I need a grant", next: "res_grant" }
            ]
        },
        buy_gift_seasoning: {
            text: "Funds currently in bank?",
            options: [ { label: "Yes, >60 days", next: "res_conventional_check" }, { label: "No, wiring later", next: "strat_gift_letter" } ]
        },

        // --- REPEAT BUYER ---
        buy_repeat_triage: {
            text: "Sell current home first?",
            options: [ { label: "Yes", next: "buy_contingency" }, { label: "No", next: "buy_2nd_home" } ]
        },
        buy_contingency: {
            text: "Is it listed?",
            options: [ { label: "Yes", next: "strat_concurrent" }, { label: "No", next: "buy_equity_check" } ]
        },
        buy_equity_check: {
            text: "Equity > 30%?",
            options: [ { label: "Yes", next: "strat_bridge" }, { label: "No", next: "strat_sell_first" } ]
        },
        buy_2nd_home: {
            text: "Primary use?",
            options: [ { label: "Vacation", next: "strat_vacation" }, { label: "Investment", next: "strat_buy_hold" } ]
        },

        // ==========================================
        // BRANCH 2: SELLING (MEGA EXPANSION)
        // ==========================================
        sell_node_1: {
            text: "Occupancy Status?",
            options: [
                { label: "Occupied by Me", next: "sell_pets_check" },
                { label: "Occupied by Tenant", next: "sell_tenant_lease" },
                { label: "Vacant", next: "sell_vacant_issues" },
                { label: "Hoarder Situation", next: "strat_hoarder_cleanout" },
                { label: "Squatters", next: "strat_squatter_ejectment" }
            ]
        },
        sell_pets_check: {
            text: "Do you have pets in the home?",
            options: [
                { label: "Yes", next: "strat_pet_showing_plan" },
                { label: "No", next: "sell_reason_check" }
            ]
        },
        sell_vacant_issues: {
            text: "Is the property winterized?",
            options: [
                { label: "Yes, secured", next: "strat_vacant_staging" },
                { label: "No, utilities off", next: "strat_utility_activation" }
            ]
        },
        sell_reason_check: {
            text: "Selling Motivation?",
            options: [
                { label: "Move Up/Down", next: "sell_taxes_check" },
                { label: "Financial Distress", next: "sell_distress" },
                { label: "Divorce", next: "sell_divorce_status" },
                { label: "Inheritance", next: "sell_probate" }
            ]
        },
        sell_taxes_check: {
            text: "Lived in 2 of last 5 years?",
            options: [ { label: "Yes", next: "sell_title_check" }, { label: "No", next: "strat_cap_gains_calc" } ]
        },
        sell_title_check: {
            text: "Is the home in a Trust?",
            options: [ { label: "Yes", next: "strat_trust_sale" }, { label: "No", next: "sell_foreign_check" } ] // NEW
        },
        sell_foreign_check: { // NEW
            text: "Are you a Foreign Person (FIRPTA)?",
            options: [
                { label: "Yes", next: "strat_firpta_withholding" },
                { label: "No", next: "sell_financial_status" }
            ]
        },
        sell_divorce_status: {
            text: "Amicable or Contested?",
            options: [ { label: "Amicable", next: "sell_title_transfer" }, { label: "Contested", next: "strat_divorce_neutral" }, { label: "Restraining Order", next: "strat_high_conflict_listing" } ]
        },
        sell_title_transfer: {
            text: "Selling or Buyout?",
            options: [ { label: "Selling", next: "sell_financial_status" }, { label: "Spouse Keeping", next: "strat_quit_claim" } ]
        },
        sell_financial_status: {
            text: "Equity Status?",
            options: [ { label: "Positive", next: "sell_retail_condition" }, { label: "Negative", next: "sell_distress" } ]
        },
        sell_retail_condition: {
            text: "Any known defects?",
            options: [
                { label: "Structural/Foundation", next: "strat_structural_eng" },
                { label: "Systems (HVAC/Elec)", next: "sell_systems_age" },
                { label: "Unpermitted Work", next: "strat_retro_permit" },
                { label: "Environmental", next: "sell_enviro_defect" }
            ]
        },
        sell_enviro_defect: {
            text: "Specific Issue?",
            options: [
                { label: "Mold", next: "strat_mold_remediation" },
                { label: "Asbestos", next: "strat_asbestos_abatement" },
                { label: "Underground Oil Tank", next: "strat_oil_tank_removal" },
                { label: "Meth Lab History", next: "strat_meth_remediation" }
            ]
        },
        sell_systems_age: {
            text: "Type of Wiring/Plumbing?",
            options: [
                { label: "Knob & Tube / Galv", next: "strat_system_upgrade_credit" },
                { label: "Modern", next: "strat_home_warranty" }
            ]
        },
        sell_solar_check: {
            text: "Do you have Solar Panels?",
            options: [
                { label: "Yes, Leased", next: "strat_solar_lease_transfer" },
                { label: "Yes, Owned", next: "strat_green_marketing" },
                { label: "No", next: "sell_historic_check" }
            ]
        },
        sell_historic_check: {
            text: "Is the home in a Historic District?",
            options: [
                { label: "Yes, Historic", next: "strat_historic_sale" },
                { label: "No", next: "sell_stigma_check" }
            ]
        },
        sell_stigma_check: {
            text: "Any 'Stigmatized' issues?",
            options: [
                { label: "Yes (Death/Crime)", next: "strat_stigma_disclosure" },
                { label: "No", next: "sell_luxury_check" }
            ]
        },
        sell_tenant_lease: {
            text: "Lease Type?",
            options: [ { label: "Month-to-Month", next: "strat_cash_keys_coop" }, { label: "Long Term", next: "strat_tenant_sale" }, { label: "Eviction needed", next: "strat_eviction_sale" } ]
        },
        sell_luxury_check: {
            text: "Value > $800k?",
            options: [ { label: "Yes", next: "sell_privacy_check" }, { label: "No", next: "strat_concierge" } ]
        },
        sell_privacy_check: {
            text: "Require privacy?",
            options: [ { label: "Yes", next: "strat_luxury_private" }, { label: "No", next: "strat_luxury_listing" } ]
        },
        // --- DISTRESS ---
        sell_distress: {
            text: "Any Liens?",
            options: [ { label: "Yes", next: "sell_lien_type" }, { label: "No", next: "sell_mortgage_status" } ]
        },
        sell_lien_type: {
            text: "Type of Lien?",
            options: [
                { label: "Mechanic's Lien", next: "strat_bond_over_lien" },
                { label: "IRS / Tax Lien", next: "strat_title_clearance" }
            ]
        },
        sell_mortgage_status: {
            text: "Behind on payments?",
            options: [ { label: "Yes", next: "sell_hardship" }, { label: "No", next: "strat_hold_rent" } ]
        },
        sell_hardship: {
            text: "Reverse Mortgage?",
            options: [ { label: "Yes", next: "strat_reverse_mortgage_sale" }, { label: "No", next: "sell_assets_check" } ]
        },
        sell_assets_check: {
            text: "Other Assets?",
            options: [ { label: "Yes", next: "strat_short_sale" }, { label: "No", next: "strat_deed_lieu" } ]
        },
        sell_probate: {
            text: "Letters of Office?",
            options: [ { label: "Yes", next: "sell_probate_type" }, { label: "No", next: "strat_probate_court" }, { label: "Unknown", next: "strat_probate_bond" } ]
        },
        sell_probate_type: {
            text: "Is there a Will?",
            options: [ { label: "Yes", next: "strat_probate_easy" }, { label: "No (Intestate)", next: "strat_probate_intestate" } ]
        },

        // ==========================================
        // BRANCH 3: REFINANCE
        // ==========================================
        refi_node_1: {
            text: "Primary Goal?",
            options: [
                { label: "Lower Payment", next: "refi_rate_check" },
                { label: "Cash Out", next: "refi_cash_reason" },
                { label: "Remove PMI", next: "refi_pmi_check" },
                { label: "Divorce Buyout", next: "strat_divorce_refi" }
            ]
        },
        refi_rate_check: {
            text: "Loan Type?",
            options: [ { label: "FHA/VA", next: "strat_streamline_refi" }, { label: "Conventional", next: "refi_credit_check" } ]
        },
        refi_credit_check: {
            text: "Score > 720?",
            options: [ { label: "Yes", next: "strat_rate_term_refi" }, { label: "No", next: "res_credit_repair" } ]
        },
        refi_cash_reason: {
            text: "Use of funds?",
            options: [
                { label: "Debt Consolidation", next: "strat_debt_consolidation" },
                { label: "Home Improvement", next: "refi_renovation_style" },
                { label: "Investment", next: "strat_cash_out_invest" },
                { label: "Buy 2nd Home", next: "strat_reverse_purchase" }
            ]
        },
        refi_renovation_style: {
            text: "Loan Preference?",
            options: [
                { label: "Keep current rate (HELOC)", next: "strat_renovation_heloc" },
                { label: "Refinance all (Cash-Out)", next: "strat_cash_out_refi" }
            ]
        },
        refi_pmi_check: {
            text: "Equity > 20%?",
            options: [ { label: "Yes", next: "strat_pmi_removal" }, { label: "Not sure", next: "strat_appraisal_gap" } ]
        },

        // ==========================================
        // BRANCH 4: INVESTING (MASSIVE EXPANSION)
        // ==========================================
        invest_node_1: {
            text: "Funding Source?",
            options: [
                { label: "Cash / Conventional", next: "inv_creative_check" },
                { label: "Retirement Funds", next: "strat_sdir_custodian" },
                { label: "1031 Exchange", next: "inv_1031_window" },
                { label: "Portfolio Loan", next: "strat_blanket_mortgage" } // NEW
            ]
        },
        inv_creative_check: {
            text: "Interested in Creative Financing?",
            options: [
                { label: "Yes (Sub2 / Seller Fin)", next: "inv_creative_type" },
                { label: "No, Standard Bank Loan", next: "inv_involvement" }
            ]
        },
        inv_creative_type: {
            text: "Preferred Method?",
            options: [
                { label: "Subject-To", next: "strat_subject_to" },
                { label: "Seller Financing", next: "strat_seller_finance" },
                { label: "Lease Option", next: "strat_lease_option" }
            ]
        },
        inv_involvement: {
            text: "Preferred involvement?",
            options: [ { label: "Active", next: "inv_experience" }, { label: "Passive", next: "inv_passive_check" } ]
        },
        inv_experience: {
            text: "Experience level?",
            options: [ { label: "Experienced", next: "inv_active_risk" }, { label: "Beginner", next: "inv_beginner_path" } ]
        },
        inv_beginner_path: {
            text: "Capital available?",
            options: [ { label: "Under $50k", next: "strat_house_hack_invest" }, { label: "$50k+", next: "strat_turnkey" } ]
        },
        inv_active_risk: {
            text: "Vehicle?",
            options: [
                { label: "Flip", next: "strat_fix_flip" },
                { label: "Long Term Rental", next: "inv_unit_count" },
                { label: "Airbnb", next: "inv_airbnb_check" },
                { label: "Niche Assets", next: "inv_niche_check" },
                { label: "Raw Land", next: "inv_land_check" },
                { label: "Notes / Debt", next: "inv_note_type" },
                { label: "Arbitrage", next: "inv_arbitrage_check" }
            ]
        },
        inv_arbitrage_check: {
            text: "Do you own the property?",
            options: [
                { label: "No (Rental Arbitrage)", next: "strat_rental_arbitrage" },
                { label: "Yes", next: "inv_airbnb_check" }
            ]
        },
        inv_note_type: {
            text: "Note Type?",
            options: [
                { label: "Performing", next: "strat_performing_note" },
                { label: "Non-Performing", next: "strat_non_performing_note" }
            ]
        },
        inv_niche_check: {
            text: "Which Niche Asset?",
            options: [
                { label: "Wholesaling", next: "strat_wholesaling" },
                { label: "Mobile Home Parks", next: "inv_mhp_util" },
                { label: "Storage Units", next: "strat_storage_invest" },
                { label: "Laundromat / Car Wash", next: "strat_operational_asset" },
                { label: "Assisted Living", next: "strat_alf_invest" },
                { label: "Billboards / Cell Towers", next: "strat_billboard_lease" },
                { label: "PadSplit / Rooming", next: "strat_padsplit" }
            ]
        },
        inv_mhp_util: {
            text: "Utilities Status?",
            options: [
                { label: "City Water/Sewer", next: "strat_mhp_invest" },
                { label: "Private Lagoon/Well", next: "strat_mhp_lagoon" }
            ]
        },
        inv_airbnb_check: {
            text: "Management style?",
            options: [ { label: "Self-Manage", next: "inv_airbnb_pricing" }, { label: "Property Manager", next: "strat_str_managed" } ]
        },
        inv_airbnb_pricing: {
            text: "Have you analyzed dynamic pricing?",
            options: [ { label: "Yes", next: "strat_str_self" }, { label: "No", next: "strat_airbnb_dynamic_pricing" } ]
        },
        inv_land_check: {
            text: "Improved or Raw?",
            options: [ { label: "Improved", next: "strat_land_build" }, { label: "Raw", next: "inv_land_survey" } ]
        },
        inv_land_survey: {
            text: "Perc Test done?",
            options: [ { label: "Yes", next: "strat_land_hold" }, { label: "No", next: "strat_land_feasibility" } ]
        },
        inv_unit_count: {
            text: "Size?",
            options: [ { label: "2-4 Units", next: "inv_dscr_ratio" }, { label: "5+ Units", next: "strat_multifamily_commercial" } ] // Updated
        },
        inv_dscr_ratio: { // NEW
            text: "Is the projected rent > mortgage?",
            options: [ { label: "Yes (DSCR > 1.0)", next: "strat_buy_hold" }, { label: "No (DSCR < 1.0)", next: "strat_no_ratio_loan" } ]
        },
        inv_passive_check: {
            text: "Accredited?",
            options: [ { label: "Yes", next: "inv_syndication_type" }, { label: "No", next: "strat_reit" } ]
        },
        inv_syndication_type: {
            text: "Strategy Preference?",
            options: [ { label: "Value Add", next: "strat_syndication" }, { label: "Cost Segregation Focus", next: "strat_cost_seg" }, { label: "Opportunity Zone", next: "strat_opportunity_zone" } ]
        },
        inv_1031_window: {
            text: "Sold <45 days ago?",
            options: [ { label: "Yes", next: "inv_1031_boot" }, { label: "No", next: "strat_1031_reverse" } ] // Updated
        },
        inv_1031_boot: {
            text: "Are you taking any cash out (Boot)?",
            options: [ { label: "Yes", next: "strat_1031_boot_tax" }, { label: "No, full reinvestment", next: "strat_dst" } ]
        },

        // ==========================================
        // BRANCH 5: COMMERCIAL
        // ==========================================
        comm_node_1: {
            text: "Asset Class?",
            options: [
                { label: "Retail", next: "comm_retail_node" },
                { label: "Office", next: "comm_office_node" },
                { label: "Industrial", next: "comm_industrial_node" },
                { label: "Special Purpose", next: "comm_special_purpose" }
            ]
        },
        comm_special_purpose: {
            text: "Specific Use?",
            options: [
                { label: "Gas Station", next: "comm_env_check" },
                { label: "Car Wash", next: "strat_operational_asset" },
                { label: "Church / Religious", next: "strat_religious_zoning" },
                { label: "Data Center", next: "strat_data_center" },
                { label: "Daycare / School", next: "comm_daycare_check" },
                { label: "Gym / Fitness", next: "strat_gym_noise" }
            ]
        },
        comm_daycare_check: {
            text: "Outdoor Space?",
            options: [
                { label: "Fenced Playground", next: "strat_daycare_licensing" },
                { label: "None", next: "strat_daycare_variance" }
            ]
        },
        comm_env_check: {
            text: "Phase 1 Report?",
            options: [
                { label: "Clean", next: "strat_sba_504" },
                { label: "Dirty/Unknown", next: "strat_phase_2_env" }
            ]
        },
        comm_retail_node: {
            text: "Use?",
            options: [
                { label: "Restaurant", next: "strat_restaurant_buy" },
                { label: "Liquor Store", next: "strat_liquor_license" },
                { label: "General", next: "comm_retail_traffic" } // Updated
            ]
        },
        comm_retail_traffic: { // NEW
            text: "Traffic Count needed?",
            options: [ { label: "High (>20k cars)", next: "comm_retail_signage" }, { label: "Destination (Low)", next: "comm_lease_own" } ]
        },
        comm_retail_signage: {
            text: "Is visibility critical?",
            options: [ { label: "Yes, need Pylon Sign", next: "strat_pylon_signage" }, { label: "No", next: "comm_lease_own" } ]
        },
        comm_office_node: {
            text: "Use?",
            options: [ { label: "Medical/Vet", next: "comm_medical_type" }, { label: "General", next: "comm_lease_own" } ]
        },
        comm_medical_type: {
            text: "Specialty?",
            options: [
                { label: "Veterinary", next: "strat_vet_zoning" },
                { label: "Dental/Doctor", next: "comm_parking_check" }
            ]
        },
        comm_parking_check: {
            text: "Does it meet 5:1000 Parking Ratio?",
            options: [ { label: "Yes", next: "strat_medical_office" }, { label: "No", next: "strat_parking_variance" } ]
        },
        comm_industrial_node: {
            text: "Requirement?",
            options: [ { label: "High Ceilings", next: "comm_crane_check" }, { label: "Loading Docks", next: "comm_loading_check" } ]
        },
        comm_loading_check: {
            text: "Dock Height or Drive-In?",
            options: [ { label: "Dock Height", next: "strat_industrial_logistics" }, { label: "Drive-In", next: "strat_flex_space" } ]
        },
        comm_crane_check: {
            text: "Need Overhead Cranes?",
            options: [ { label: "Yes", next: "strat_heavy_manufacturing" }, { label: "No", next: "strat_flex_space" } ]
        },
        comm_lease_own: {
            text: "Strategy?",
            options: [ { label: "Buy", next: "strat_sba_504" }, { label: "Lease", next: "comm_lease_type" }, { label: "Biz Only", next: "strat_biz_opp" } ] // Updated
        },
        comm_lease_type: { // NEW
            text: "Lease Structure?",
            options: [
                { label: "Triple Net (NNN)", next: "comm_lease_guarantee" },
                { label: "Full Service Gross", next: "strat_base_year_audit" }
            ]
        },
        comm_lease_guarantee: {
            text: "Will you sign a Personal Guarantee?",
            options: [ { label: "Yes", next: "strat_burn_off_clause" }, { label: "No", next: "strat_lease_audit" } ]
        },

        // ==========================================
        // BRANCH 6: LAND / DEVELOPMENT
        // ==========================================
        land_node_1: {
            text: "What is the current zoning?",
            options: [
                { label: "Residential", next: "land_infill_check" },
                { label: "Agricultural", next: "land_rights_check" },
                { label: "Commercial", next: "strat_land_hold" },
                { label: "Disaster/Flood", next: "land_disaster_check" }
            ]
        },
        land_rights_check: {
            text: "Rights to convey?",
            options: [
                { label: "Mineral Rights", next: "strat_mineral_rights" },
                { label: "Water Rights", next: "strat_water_rights" },
                { label: "Timber", next: "strat_timber_cruise" },
                { label: "Standard Surface", next: "strat_ag_zoning" }
            ]
        },
        land_infill_check: {
            text: "Is this an infill lot (between existing homes)?",
            options: [
                { label: "Yes", next: "strat_infill_development" },
                { label: "No, large tract", next: "strat_subdivision" }
            ]
        },
        land_disaster_check: {
            text: "Specific Risk?",
            options: [
                { label: "Flood Zone AE/VE", next: "strat_flood_elevation" },
                { label: "Wildfire Zone", next: "strat_fair_plan_ins" },
                { label: "Wetlands", next: "strat_wetland_mitigation" },
                { label: "Mine Subsidence", next: "strat_mine_subsidence" }
            ]
        },

        // ==========================================
        // OUTCOMES
        // ==========================================
        
        // --- NEW OUTCOMES (Total >290) ---
        strat_riparian_rights: { text: "Strategy: Riparian Rights. For flowing water (Rivers), you typically own to the center of the stream. We must verify this deed right so you can legally build a dock or withdraw water.", options: [] },
        strat_littoral_rights: { text: "Strategy: Littoral Rights. For static water (Lakes), you own to the high-water mark. We need a survey to ensure the existing dock isn't encroaching on your neighbor's water frontage.", options: [] },
        strat_limited_review_condo: { text: "Strategy: Limited Review Condo Loan. If the HOA has low reserves, we can do a 'Limited Review' loan if you put 25% down (owner-occupied) or 30% (investment). This bypasses the full questionnaire.", options: [] },
        strat_no_ratio_loan: { text: "Strategy: No-Ratio DSCR. The rent doesn't cover the mortgage (<1.0 DSCR). We can still lend, but you need 30-35% down and 12 months of cash reserves in the bank.", options: [] },
        strat_1031_reverse: { text: "Strategy: Reverse 1031 Exchange. You found the new property *before* selling the old one. We need an Exchange Accommodation Titleholder (EAT) to hold the new title until your old property sells.", options: [] },
        strat_base_year_audit: { text: "Strategy: Base Year Audit. In a Full Service lease, you pay increases over a 'Base Year'. We must audit the landlord's current year expenses to ensure the Base Year isn't artificially low, which would spike your future rent.", options: [] },
        strat_firpta_withholding: { text: "Strategy: FIRPTA Withholding. As a foreign seller, the IRS requires the buyer to withhold 15% of the sale price at closing. We need a CPA to file for a Withholding Certificate to reduce this amount if you owe less tax.", options: [] },
        strat_blanket_mortgage: { text: "Strategy: Blanket Mortgage. If you are buying multiple properties, we use one loan to cover all of them. This reduces closing costs but requires a 'Partial Release Clause' so you can sell one house without paying off the whole loan.", options: [] },
        
        // --- RETAINED OUTCOMES ---
        strat_construction_loan: { text: "Strategy: Construction-to-Perm Loan. One closing for lot+build.", options: [] },
        strat_pool_inspection: { text: "Strategy: Pool Inspect. Pressure test lines.", options: [] },
        strat_stigma_disclosure: { text: "Strategy: Stigma Disclosure. Transparency prevents lawsuits.", options: [] },
        strat_operational_asset: { text: "Strategy: Operational Asset. EBITDA value.", options: [] },
        strat_mixed_use: { text: "Strategy: Mixed Use. Commercial loan.", options: [] },
        strat_ag_zoning: { text: "Strategy: Ag Zoning. Future use check.", options: [] },
        strat_infill_development: { text: "Strategy: Infill Dev. Buildability check.", options: [] },
        strat_subdivision: { text: "Strategy: Subdivision. Entitlement profit.", options: [] },
        strat_employment_gap_letter: { text: "Strategy: Gap Letter. Explain employment gap.", options: [] },
        strat_offer_letter_loan: { text: "Strategy: Offer Letter Loan. Close before start.", options: [] },
        strat_pool_marketing: { text: "Strategy: Pool Marketing. Lifestyle photos.", options: [] },
        strat_unique_appraisal: { text: "Strategy: Complex Appraisal. Specialist required.", options: [] },
        strat_data_center: { text: "Strategy: Data Center. Power focus.", options: [] },
        strat_str_glamping: { text: "Strategy: Glamping. Land use permit.", options: [] },
        strat_religious_zoning: { text: "Strategy: Religious Zoning. Tax impact.", options: [] },
        strat_remote_worker_letter: { text: "Strategy: Remote Letter. HR verification.", options: [] },
        strat_transfer_letter: { text: "Strategy: Transfer Letter. Moving date.", options: [] },
        strat_fixed_income_gross_up: { text: "Strategy: Income Gross Up. Non-taxable credit.", options: [] },
        strat_cold_storage: { text: "Strategy: Cold Storage. Equipment value.", options: [] },
        strat_drive_thru: { text: "Strategy: Drive Thru. Special use permit.", options: [] },
        strat_office_conversion: { text: "Strategy: Office Convert. Plumbing check.", options: [] },
        strat_coop_board: { text: "Strategy: Co-Op Board. Interview prep.", options: [] },
        strat_barndominium: { text: "Strategy: Barndo Loan. Local bank.", options: [] },
        strat_fha_manufactured: { text: "Strategy: FHA Manufactured. Perm foundation.", options: [] },
        strat_chattel_loan: { text: "Strategy: Chattel Loan. Personal property.", options: [] },
        strat_bk13_manual: { text: "Strategy: BK13 Buy. Court approval.", options: [] },
        strat_identity_interest: { text: "Strategy: Identity Interest. Family buy.", options: [] },
        strat_1099_only_loan: { text: "Strategy: 1099 Only. No tax returns.", options: [] },
        strat_1yr_tax_return: { text: "Strategy: 1 Yr Tax Return. Strong year.", options: [] },
        strat_va_fee_waiver: { text: "Strategy: VA Fee Waiver. Disability exemption.", options: [] },
        strat_va_bonus_entitlement: { text: "Strategy: VA Bonus. Second entitlement.", options: [] },
        strat_subject_to: { text: "Strategy: Subject-To. Take over payments.", options: [] },
        strat_seller_finance: { text: "Strategy: Seller Finance. Direct payments.", options: [] },
        strat_lease_option: { text: "Strategy: Lease Option. Rent to own.", options: [] },
        strat_airbnb_dynamic_pricing: { text: "Strategy: Dynamic Pricing. Automated rates.", options: [] },
        strat_cost_seg: { text: "Strategy: Cost Segregation. Tax write-offs.", options: [] },
        strat_1031_boot_tax: { text: "Strategy: Partial Exchange. Tax on boot.", options: [] },
        strat_pylon_signage: { text: "Strategy: Pylon Signage. Negotiate visibility.", options: [] },
        strat_burn_off_clause: { text: "Strategy: Burn-Off Clause. Limit guarantee.", options: [] },
        strat_cash_keys_coop: { text: "Strategy: Cash for Keys. Tenant buyout.", options: [] },
        strat_probate_intestate: { text: "Strategy: Intestate. State law heirs.", options: [] },
        strat_quit_claim: { text: "Strategy: Quit Claim. Transfer title.", options: [] },
        strat_info_only_inspection: { text: "Strategy: Info-Only. Pass/Fail inspection.", options: [] },
        strat_appraisal_gap_guarantee: { text: "Strategy: Appraisal Gap. Cash cover.", options: [] },
        strat_escalation_clause: { text: "Strategy: Escalation Clause. Beat offers.", options: [] },
        strat_lead_paint: { text: "Strategy: Lead Paint. Disclosure.", options: [] },
        strat_sewer_scope: { text: "Strategy: Sewer Scope. Pipe check.", options: [] },
        strat_septic_inspection: { text: "Strategy: Septic Load. Tank test.", options: [] },
        strat_pet_showing_plan: { text: "Strategy: Pet Plan. Logistics.", options: [] },
        strat_green_mortgage: { text: "Strategy: Energy Mortgage. Finance upgrades.", options: [] },
        strat_itin_loan: { text: "Strategy: ITIN Loan. Non-SSN financing.", options: [] },
        strat_foreign_national: { text: "Strategy: Foreign National. DSCR loan.", options: [] },
        strat_co_buy_agreement: { text: "Strategy: Co-Buy. Tenants in Common.", options: [] },
        strat_corp_relo: { text: "Strategy: Corp Relo. Benefit protection.", options: [] },
        strat_tiny_home: { text: "Strategy: Tiny Home. Zoning check.", options: [] },
        strat_hoarder_cleanout: { text: "Strategy: Cleanout. Compassionate removal.", options: [] },
        strat_vacant_staging: { text: "Strategy: Virtual Staging. Digital furniture.", options: [] },
        strat_utility_activation: { text: "Strategy: Utility On. Inspection prep.", options: [] },
        strat_structural_eng: { text: "Strategy: Structural Engineer. Foundation check.", options: [] },
        strat_home_warranty: { text: "Strategy: Warranty. System protection.", options: [] },
        strat_solar_lease_transfer: { text: "Strategy: Solar Transfer. Lease assumption.", options: [] },
        strat_historic_sale: { text: "Strategy: Historic Tax Freeze. Tax incentive.", options: [] },
        strat_divorce_refi: { text: "Strategy: Owelty Lien. Equity buyout.", options: [] },
        strat_reverse_purchase: { text: "Strategy: HECM Purchase. 50% down.", options: [] },
        strat_sdir_custodian: { text: "Strategy: SDIRA. Custodian purchase.", options: [] },
        strat_wholesaling: { text: "Strategy: Wholesaling. Assignment fee.", options: [] },
        strat_mhp_invest: { text: "Strategy: MHP. Pad rent.", options: [] },
        strat_student_housing: { text: "Strategy: Student Housing. Per bed rent.", options: [] },
        strat_storage_invest: { text: "Strategy: Storage. Climate control.", options: [] },
        strat_phase_2_env: { text: "Strategy: Phase 2. Soil drill.", options: [] },
        strat_liquor_license: { text: "Strategy: Liquor License. Transfer check.", options: [] },
        strat_parking_variance: { text: "Strategy: Parking Variance. Zoning relief.", options: [] },
        strat_heavy_manufacturing: { text: "Strategy: Heavy Mfg. Floor load.", options: [] },
        strat_ot_avg: { text: "Strategy: OT Averaging. 2 year history.", options: [] },
        strat_medical_collections: { text: "Strategy: Medical Debt. Ignore.", options: [] },
        strat_green_marketing: { text: "Strategy: Green Premium. Solar value.", options: [] },
        strat_virtual_tour: { text: "Strategy: Virtual Tour. Remote buying.", options: [] },
        strat_jumbo_loan: { text: "Strategy: Jumbo. Portfolio loan.", options: [] },
        strat_usda_loan: { text: "Strategy: USDA. Rural 0% down.", options: [] },
        strat_fsbo_conversion: { text: "Strategy: MLS Exposure. Agent reach.", options: [] },
        strat_expired_relist: { text: "Strategy: Refresh. New look.", options: [] },
        strat_cap_gains_calc: { text: "Strategy: Tax Calc. Capital gains.", options: [] },
        strat_private_showings: { text: "Strategy: Private Showings. Vetted buyers.", options: [] },
        strat_str_self: { text: "Strategy: Self-Manage. High effort.", options: [] },
        strat_str_managed: { text: "Strategy: Managed STR. Passive.", options: [] },
        strat_land_build: { text: "Strategy: Const Loan. Build.", options: [] },
        strat_zoning_attorney: { text: "Strategy: Zoning Attorney. Variance.", options: [] },
        strat_biz_opp: { text: "Strategy: Biz Opp. Asset sale.", options: [] },
        strat_bank_statement: { text: "Strategy: Bank Stmt. 12mo deps.", options: [] },
        strat_physician_loan: { text: "Strategy: Physician Loan. Student loan ignore.", options: [] },
        strat_manual_underwriting: { text: "Strategy: Manual UW. Non-traditional.", options: [] },
        strat_hard_money_buy: { text: "Strategy: Hard Money. Bridge.", options: [] },
        strat_new_construction: { text: "Strategy: Builder Rep. Upgrades.", options: [] },
        strat_builder_reg: { text: "Strategy: Builder Reg. Protect.", options: [] },
        strat_divorce_neutral: { text: "Strategy: Neutral Sale. Unbiased.", options: [] },
        strat_senior_transition: { text: "Strategy: Rightsizing. Estate sale.", options: [] },
        strat_luxury_private: { text: "Strategy: Private Placement. Off market.", options: [] },
        strat_eviction_sale: { text: "Strategy: Cash for Keys. Vacate.", options: [] },
        strat_probate_conflict: { text: "Strategy: Mediator. Transparency.", options: [] },
        strat_house_hack_invest: { text: "Strategy: House Hack. FHA MF.", options: [] },
        strat_multifamily_commercial: { text: "Strategy: DSCR. Income loan.", options: [] },
        strat_restaurant_buy: { text: "Strategy: 2nd Gen. Equipment.", options: [] },
        strat_medical_office: { text: "Strategy: TI $. Buildout.", options: [] },
        strat_flex_space: { text: "Strategy: Flex. Office/Warehouse.", options: [] },
        strat_commuter_hub: { text: "Strategy: Transit. Train.", options: [] },
        strat_school_zone: { text: "Strategy: District. Schools.", options: [] },
        strat_va_loan: { text: "Strategy: VA Loan. 0% down.", options: [] },
        strat_203k_rehab: { text: "Strategy: 203k. Reno.", options: [] },
        res_grant: { text: "Strategy: DPA. Grants.", options: [] },
        res_fha_standard: { text: "Strategy: FHA. 3.5% down.", options: [] },
        res_credit_repair: { text: "Strategy: Credit Repair. Fix score.", options: [] },
        strat_concurrent: { text: "Strategy: Concurrent. Same day.", options: [] },
        strat_bridge: { text: "Strategy: Bridge. Buy first.", options: [] },
        strat_sell_first: { text: "Strategy: Sell First. Contingency.", options: [] },
        strat_vacation: { text: "Strategy: Vacation. ROI.", options: [] },
        strat_leaseback: { text: "Strategy: Rent Back. Stay.", options: [] },
        strat_luxury_listing: { text: "Strategy: Luxury. Global.", options: [] },
        strat_tenant_sale: { text: "Strategy: Investor Sale. Tenant stays.", options: [] },
        strat_concierge: { text: "Strategy: Concierge. Prep.", options: [] },
        strat_instant: { text: "Strategy: Instant. Speed.", options: [] },
        strat_hold_rent: { text: "Strategy: Hold. Rent.", options: [] },
        strat_short_sale: { text: "Strategy: Short Sale. Forgive.", options: [] },
        strat_deed_lieu: { text: "Strategy: Deed Lieu. Surrender.", options: [] },
        strat_probate_easy: { text: "Strategy: Probate. Easy.", options: [] },
        strat_probate_court: { text: "Strategy: Court Probate. Slow.", options: [] },
        strat_probate_bond: { text: "Strategy: Bond. Fast.", options: [] },
        strat_turnkey: { text: "Strategy: Turnkey. Done.", options: [] },
        strat_dst: { text: "Strategy: DST. Passive.", options: [] },
        strat_fix_flip: { text: "Strategy: Flip. 70%.", options: [] },
        strat_brrrr: { text: "Strategy: BRRRR. Refi.", options: [] },
        strat_buy_hold: { text: "Strategy: Hold. Cash flow.", options: [] },
        strat_syndication: { text: "Strategy: Syndication. Group.", options: [] },
        strat_reit: { text: "Strategy: REIT. Stocks.", options: [] },
        strat_hold_refi: { text: "Strategy: Cash Out. Equity.", options: [] },
        strat_1031: { text: "Strategy: 1031. Defer.", options: [] },
        strat_sba_504: { text: "Strategy: SBA. 10%.", options: [] },
        strat_lease_audit: { text: "Strategy: Audit. CAM.", options: [] },
        strat_lease_base_year: { text: "Strategy: Base Year. Cap.", options: [] },
        strat_industrial_logistics: { text: "Strategy: Logistics. Doors.", options: [] },
        res_conventional_check: { text: "Strategy: Conventional. Standard.", options: [] },
        strat_streamline_refi: { text: "Strategy: Streamline. No appraisal.", options: [] },
        strat_rate_term_refi: { text: "Strategy: Rate Term. Lower rate.", options: [] },
        strat_debt_consolidation: { text: "Strategy: Debt Consolidation. Payoff.", options: [] },
        strat_renovation_heloc: { text: "Strategy: HELOC. Reno.", options: [] },
        strat_cash_out_invest: { text: "Strategy: Invest. Cash out.", options: [] },
        strat_pmi_removal: { text: "Strategy: PMI. Remove.", options: [] },
        strat_appraisal_gap: { text: "Strategy: Appraisal. Value.", options: [] },
        strat_fha_ibr: { text: "Strategy: FHA IBR. Student loans.", options: [] },
        strat_conventional_1percent: { text: "Strategy: Conv Student. 1%.", options: [] },
        strat_cosigner_fha: { text: "Strategy: Co-Signer. Blend.", options: [] },
        strat_condo_warrantable: { text: "Strategy: Warrantable. Healthy.", options: [] },
        strat_non_warrantable: { text: "Strategy: Non-Warrantable. Litigation.", options: [] },
        strat_multigen_search: { text: "Strategy: Multi-Gen. In-law.", options: [] },
        strat_remove_disputes: { text: "Strategy: Disputes. Remove.", options: [] },
        strat_gift_letter: { text: "Strategy: Gift Letter. Funds.", options: [] },
        strat_trust_sale: { text: "Strategy: Trust. Certificate.", options: [] },
        strat_retro_permit: { text: "Strategy: Retro Permit. Fix.", options: [] },
        strat_title_clearance: { text: "Strategy: Title. Clear.", options: [] },
        strat_reverse_mortgage_sale: { text: "Strategy: HECM. Payoff.", options: [] },
        strat_land_feasibility: { text: "Strategy: Land. Perc.", options: [] },
        strat_cash_out_refi: { text: "Strategy: Cash Out. Full.", options: [] },
        strat_land_hold: { text: "Strategy: Land. Banking.", options: [] },
        strat_gap_employment: { text: "Strategy: Gap Explanation. Explain gap.", options: [] },
        strat_cash_only_manu: { text: "Strategy: Cash Sale. No financing available.", options: [] },
        strat_log_cabin: { text: "Strategy: Log Home Finance. Unique comp requirements.", options: [] },
        strat_str_urban_reg: { text: "Strategy: Urban STR. Check city ban list.", options: [] },
        strat_str_vacation: { text: "Strategy: Vacation Rental. High season revenue.", options: [] },
        strat_401k_loan: { text: "Strategy: 401k Loan. Self-loan.", options: [] },
        strat_2_1_buydown: { text: "Strategy: 2-1 Buydown. Lower rate start.", options: [] },
        strat_lease_exclusion: { text: "Strategy: Lease Exclusion. <10 payments.", options: [] },
        strat_exclude_support: { text: "Strategy: Support Exclusion. <10 payments.", options: [] },
        strat_alimony_income: { text: "Strategy: Alimony Income. 6mo proof.", options: [] },
        strat_gift_of_equity: { text: "Strategy: Gift of Equity. Family sale.", options: [] },
        strat_radon_mitigation: { text: "Strategy: Radon System. Seller pays.", options: [] },
        strat_crawl_encapsulation: { text: "Strategy: Crawl Space. Vapor barrier.", options: [] },
        strat_plumbing_scope: { text: "Strategy: Plumbing Scope. Slab leaks.", options: [] },
        strat_debt_paydown: { text: "Strategy: Closing Paydown. Fix DTI.", options: [] },
        strat_termite_inspection: { text: "Strategy: WDI. Termite check.", options: [] },
        strat_pre_show_security: { text: "Strategy: Pre-Show. Secure valuables.", options: [] },
        strat_restricted_hours: { text: "Strategy: Blocked Showings. Manage schedule.", options: [] },
        strat_loi_commercial: { text: "Strategy: LOI. Non-binding offer.", options: [] },
        strat_high_conflict_listing: { text: "Strategy: High-Conflict Listing. Neutral showing management.", options: [] },
        strat_squatter_ejectment: { text: "Strategy: Ejectment. Civil removal.", options: [] },
        strat_meth_remediation: { text: "Strategy: Meth Remediation. Certified cleaning.", options: [] },
        strat_sheriff_cash: { text: "Strategy: Sheriff Sale. 100% cash.", options: [] },
        strat_auction_tech_fee: { text: "Strategy: Auction Fee. Buyer premium.", options: [] },
        strat_rental_arbitrage: { text: "Strategy: Arbitrage. Rent to rent.", options: [] },
        strat_vet_zoning: { text: "Strategy: Vet Zoning. Noise permit.", options: [] },
        strat_daycare_licensing: { text: "Strategy: DCFS License. Playground reg.", options: [] },
        strat_daycare_variance: { text: "Strategy: Daycare Variance. Park use.", options: [] },
        strat_gym_noise: { text: "Strategy: Gym Noise. Impact mitigation.", options: [] },
        strat_timber_cruise: { text: "Strategy: Timber Cruise. Tree value.", options: [] },
        strat_mineral_rights: { text: "Strategy: Mineral Rights. Subsurface.", options: [] },
        strat_water_rights: { text: "Strategy: Water Rights. Adjudication.", options: [] },
        strat_mine_subsidence: { text: "Strategy: Mine Insurance. Subsidence cover.", options: [] },
        strat_padsplit: { text: "Strategy: PadSplit. Per room rent.", options: [] },
        strat_bond_over_lien: { text: "Strategy: Bond Lien. Escrow holdback.", options: [] },
        strat_probation_letter: { text: "Strategy: Probation Letter. Verify income.", options: [] },
        strat_fair_housing_risk: { text: "Strategy: Love Letter Risk. Avoid bias.", options: [] },
        strat_mhp_lagoon: { text: "Strategy: MHP Lagoon. Enviro check.", options: [] },
        strat_flood_elevation: { text: "Strategy: Elevation Cert. Lower insurance.", options: [] },
        strat_fair_plan_ins: { text: "Strategy: FAIR Plan. Wildfire ins.", options: [] },
        strat_wetland_mitigation: { text: "Strategy: Wetland Credits. Army Corps.", options: [] },
        strat_mold_remediation: { text: "Strategy: Mold Remediate. Air test.", options: [] },
        strat_asbestos_abatement: { text: "Strategy: Asbestos. Encapsulate.", options: [] },
        strat_oil_tank_removal: { text: "Strategy: Tank Pull. EPA letter.", options: [] },
        strat_shared_well_agreement: { text: "Strategy: Shared Well. Recorded easement.", options: [] },
        strat_well_water_test: { text: "Strategy: Well Test. Bacteria/Nitrate.", options: [] },
        strat_fha_203k_limited: { text: "Strategy: 203k Limited. <$35k.", options: [] },
        strat_fha_203k_standard: { text: "Strategy: 203k Standard. Structural.", options: [] },
        strat_tax_lien_invest: { text: "Strategy: Tax Liens. Interest yield.", options: [] },
        strat_non_qm_foreclosure: { text: "Strategy: Recent Foreclosure. High rate.", options: [] },
        strat_alf_invest: { text: "Strategy: ALF. Senior housing.", options: [] },
        strat_billboard_lease: { text: "Strategy: Billboard. Easement buy.", options: [] },
        strat_performing_note: { text: "Strategy: Perf Note. Cash flow.", options: [] },
        strat_non_performing_note: { text: "Strategy: Non-Perf Note. Workout.", options: [] },
        strat_opportunity_zone: { text: "Strategy: Opp Zone. Tax free.", options: [] },
        strat_blind_trust: { text: "Strategy: Blind Trust. Anonymity.", options: [] },
        strat_dscr_llc: { text: "Strategy: DSCR LLC. Biz loan.", options: [] },
        strat_trust_purchase: { text: "Strategy: Trust Buy. Estate plan.", options: [] },
        strat_system_upgrade_credit: { text: "Strategy: System Credit. Update electric.", options: [] },
        strat_riparian_rights: { text: "Strategy: Riparian. River access.", options: [] },
        strat_littoral_rights: { text: "Strategy: Littoral. Lake access.", options: [] },
        strat_limited_review_condo: { text: "Strategy: Ltd Review. 25% down.", options: [] },
        strat_no_ratio_loan: { text: "Strategy: No Ratio. Equity based.", options: [] },
        strat_1031_reverse: { text: "Strategy: Rev 1031. Buy first.", options: [] },
        strat_base_year_audit: { text: "Strategy: Base Year. Lease audit.", options: [] },
        strat_firpta_withholding: { text: "Strategy: FIRPTA. Foreign tax.", options: [] },
        strat_blanket_mortgage: { text: "Strategy: Blanket Loan. Portfolio.", options: [] }
    };

    let currentNode = 'start';
    let history = []; 
    let pathLabels = []; 

    const elements = {
        question: document.getElementById('question-text'),
        options: document.getElementById('options-container'),
        backBtn: document.getElementById('back-btn'),
        progress: document.getElementById('progress-bar-fill'),
        step: document.getElementById('step-counter'),
        formContainer: document.getElementById('contact-form-container'),
        message: document.getElementById('message-field')
    };

    function renderNode() {
        const node = tree[currentNode];
        if(!node) {
            console.error("Node not found:", currentNode);
            return;
        }

        elements.question.innerText = node.text;
        elements.options.innerHTML = '';
        
        const isResult = node.options.length === 0;
        const stepCount = history.length + 1;
        
        elements.step.innerText = isResult ? 'Strategy Found' : `Step ${stepCount}`;
        elements.progress.style.width = isResult ? '100%' : Math.min(stepCount * 2, 95) + '%';
        elements.backBtn.style.display = (history.length > 0) ? 'block' : 'none';

        if (isResult) {
            elements.question.classList.add('result-card');
            elements.formContainer.style.display = 'block';
            
            let complianceNote = "\n\n*Local Compliance Note (Villa Park/IL):* \n- Transfer Stamps: $0 (Villa Park), but Inspection Required ($50).\n- Mandatory Disclosures: IL Radon, Lead-Based Paint (Pre-1978).";
            elements.message.value = "Client Path: " + pathLabels.join(" > ") + "\n\nGenerated Strategy: " + node.text + complianceNote;
            
            const restartBtn = document.createElement('button');
            restartBtn.innerText = "Start Over / Try Another Scenario";
            restartBtn.className = "tree-option-btn";
            restartBtn.style.textAlign = "center";
            restartBtn.style.marginTop = "20px";
            restartBtn.style.background = "#fff";
            restartBtn.onclick = () => { 
                history = []; 
                pathLabels = []; 
                currentNode = 'start'; 
                renderNode(); 
            };
            elements.options.appendChild(restartBtn);
        } else {
            elements.question.classList.remove('result-card');
            elements.formContainer.style.display = 'none';
            node.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt.label;
                btn.className = "tree-option-btn";
                btn.onclick = () => {
                    history.push(currentNode);
                    pathLabels.push(opt.label);
                    currentNode = opt.next;
                    renderNode();
                };
                elements.options.appendChild(btn);
            });
        }
    }

    elements.backBtn.onclick = () => {
        if (history.length > 0) {
            currentNode = history.pop();
            pathLabels.pop();
            renderNode();
        }
    };

    renderNode();
});
</script>
</body>
</html>
