<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Pavlo Rospopa Expert Strategy Engine</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/format.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <style>
        body { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f9; }
        input, textarea { -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; }

        #real-estate-guide-container {
            margin: 40px auto; padding: 30px; border: 1px solid #e0e0e0; border-radius: 12px;
            background-color: #ffffff; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; z-index: 101;
            max-width: 950px;
        }
        .tree-option-btn {
            padding: 12px 16px; background-color: #f8f9fa; color: #333; border: 2px solid #eef0f2;
            border-radius: 8px; cursor: pointer; font-size: 0.95rem; text-align: left;
            transition: all 0.2s; font-weight: 500; width: 100%; margin-bottom: 6px; display: block;
        }
        .tree-option-btn:hover { border-color: #4285F4; color: #4285F4; transform: translateX(4px); }
        .result-card { background: #f4f7ff; border-left: 6px solid #4285F4; padding: 25px; border-radius: 8px; color: #334155; line-height: 1.7; margin-bottom: 20px; }

        #contact-form-container { margin: 40px 0; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; background-color: #f9f9f9; }
        #contact-form { display: flex; flex-direction: column; gap: 15px; }
        #contact-form input, #contact-form textarea { padding: 12px; border: 1px solid #ccc; border-radius: 4px; width: 100%; box-sizing: border-box; }
        #contact-form button { padding: 12px 24px; background-color: #333; color: white; border: none; border-radius: 4px; cursor: pointer; align-self: flex-start; font-weight: bold; }
        #contact-form button:hover { background-color: #555; }
        
        .progress-container { width: 100%; height: 8px; background: #eee; border-radius: 4px; margin: 15px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4285F4, #34a853); transition: width 0.3s ease; }
    </style>
</head>
     
<body>

<header class="site-header">
    <div class="wrap" style="text-align: center; padding: 20px 0;">
        <a class="site-title" style="text-decoration: none; font-size: 2rem; color: #333; font-weight: 800;" href="https://rospopa.com">Pavlo Rospopa Strategy Engine</a>
    </div>
</header>

<main>
    <div class="page-content">
        <div class="wrap">
            <div id="real-estate-guide-container">
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <button id="back-btn" style="background:none; border:none; color:#4285F4; cursor:pointer; font-weight:bold; display:none;">‚Üê Back</button>
                    <span id="step-counter" style="color:#888; font-size:0.9rem;">Start</span>
                </div>
                
                <div class="progress-container">
                    <div id="progress-bar-fill" class="progress-fill" style="width: 1%;"></div>
                </div>

                <div id="tree-content">
                    <h2 id="question-text" style="margin-bottom: 25px; font-size: 1.4rem; color: #222; font-weight: 700;">Loading Logic...</h2>
                    <div id="options-container"></div>
                </div>

                <div id="contact-form-container" style="display: none;">
                    <h3 style="margin-top:0;">Request This Strategy</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">Based on your answers, this is the most efficient path forward.</p>
                    <form id="contact-form">
                        <input type="text" name="name" placeholder="Your Name" required />
                        <input type="email" name="email" placeholder="Your Email" required />
                        <input type="tel" name="phone" placeholder="Phone Number (Optional)" />
                        <textarea id="message-field" name="message" rows="5" required></textarea>
                        <div class="g-recaptcha" data-sitekey="6Let_E8sAAAAAP948s5QuqjQ-HKYRuoXxLzILZ9p"></div>
                        <button type="submit" id="submit-btn">Send Request</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tree = {
        // --- ROOT ---
        start: {
            text: "What is your primary Real Estate Goal?",
            options: [
                { label: "Residential: Buying", next: "buy_node_1" },
                { label: "Residential: Selling", next: "sell_node_1" },
                { label: "Refinancing / Mortgage", next: "refi_node_1" },
                { label: "Wealth: Investing", next: "invest_node_1" },
                { label: "Commercial / Business", next: "comm_node_1" },
                { label: "Land / Development", next: "land_node_1" }
            ]
        },

        // ==========================================
        // BRANCH 1: BUYING (MEGA EXPANSION)
        // ==========================================
        buy_node_1: {
            text: "Are you a US Citizen or Permanent Resident?",
            options: [
                { label: "Yes", next: "buy_loc_status" },
                { label: "No (Visa/Foreign National)", next: "buy_visa_status" }
            ]
        },
        buy_visa_status: { 
            text: "Do you have a valid Work Visa or ITIN?",
            options: [
                { label: "Work Visa (H1B, etc)", next: "buy_loc_status" },
                { label: "ITIN Number only", next: "strat_itin_loan" },
                { label: "Foreign National (No US Credit)", next: "strat_foreign_national" }
            ]
        },
        buy_loc_status: {
            text: "Buying Locally or Relocating?",
            options: [
                { label: "Buying Locally", next: "buy_entity_check" }, // UPDATED
                { label: "Relocating", next: "buy_relo_timeline" }
            ]
        },
        buy_entity_check: { // NEW
            text: "Are you buying as an Individual or an Entity?",
            options: [
                { label: "Individual / Couple", next: "buy_co_buy_check" },
                { label: "LLC / Corp", next: "buy_llc_purpose" },
                { label: "Family Trust", next: "strat_trust_purchase" }
            ]
        },
        buy_llc_purpose: { // NEW
            text: "Is the LLC for Investment or Privacy?",
            options: [
                { label: "Investment (Rental)", next: "strat_dscr_llc" },
                { label: "Privacy (High Net Worth)", next: "strat_blind_trust" }
            ]
        },
        buy_relo_timeline: {
            text: "Is this a Corporate Move or Self-Move?",
            options: [
                { label: "Corporate Package", next: "strat_corp_relo" },
                { label: "Self-Move / Job Change", next: "buy_job_gap_check" }
            ]
        },
        buy_job_gap_check: {
            text: "Will you have a gap in employment during the move?",
            options: [
                { label: "No, immediate start", next: "strat_virtual_tour" },
                { label: "Yes, >30 days gap", next: "strat_employment_gap_letter" }
            ]
        },
        buy_co_buy_check: {
            text: "Who are you buying with?",
            options: [
                { label: "Just me / Spouse", next: "buy_history_check" },
                { label: "Unmarried Partner / Friend", next: "strat_co_buy_agreement" },
                { label: "Parent / Co-Signer", next: "strat_cosigner_fha" }
            ]
        },
        buy_history_check: {
            text: "Have you owned a home in the last 3 years?",
            options: [
                { label: "No (First-Time Buyer)", next: "buy_fthb_triage" },
                { label: "Yes (Repeat Buyer)", next: "buy_repeat_triage" }
            ]
        },
        
        // --- FTHB PATH ---
        buy_fthb_triage: {
            text: "What is your biggest hurdle right now?",
            options: [
                { label: "Down Payment", next: "buy_down_source" },
                { label: "Credit Score", next: "buy_credit_deep" },
                { label: "Income / Debt", next: "buy_income_check" },
                { label: "Inventory / Condition", next: "buy_inventory_triage" }
            ]
        },
        // --- INCOME & DEBT ---
        buy_income_check: {
            text: "Do you have significant Student Loan debt?",
            options: [
                { label: "Yes, Student Loans", next: "buy_student_loan_calc" },
                { label: "No, other debt/income issues", next: "buy_income_type" }
            ]
        },
        buy_student_loan_calc: {
            text: "Are you on an Income-Based Repayment (IBR) plan?",
            options: [
                { label: "Yes, IBR Plan", next: "strat_fha_ibr" },
                { label: "No, Standard Plan", next: "strat_conventional_1percent" }
            ]
        },
        buy_income_type: {
            text: "How is your income derived?",
            options: [
                { label: "W-2 Salary", next: "buy_overtime_check" },
                { label: "Self-Employed", next: "buy_self_emp_years" },
                { label: "Commission/Bonus", next: "buy_variable_income" },
                { label: "Tip Income", next: "buy_tip_income" }
            ]
        },
        buy_tip_income: {
            text: "Do you report all your tips to the IRS?",
            options: [
                { label: "Yes, fully reported", next: "res_fha_standard" },
                { label: "No, mostly cash", next: "strat_bank_statement" }
            ]
        },
        buy_overtime_check: {
            text: "Do you rely on Overtime pay to qualify?",
            options: [
                { label: "Yes, need OT income", next: "strat_ot_avg" },
                { label: "No, Base Salary is enough", next: "res_fha_standard" }
            ]
        },
        buy_variable_income: {
            text: "Do you have a 2-year history of this variable income?",
            options: [
                { label: "Yes, consistent", next: "res_conventional_check" },
                { label: "No, it varies", next: "strat_base_income_only" }
            ]
        },
        buy_self_emp_years: {
            text: "Do your tax returns show strong net income?",
            options: [
                { label: "Yes, I show profit", next: "res_conventional_check" },
                { label: "No, high write-offs", next: "strat_bank_statement" }
            ]
        },
        // --- CREDIT ---
        buy_credit_deep: {
            text: "Approximate Credit Score?",
            options: [
                { label: "Excellent (720+)", next: "res_conventional_check" },
                { label: "Good (620-719)", next: "res_fha_standard" },
                { label: "Fair (580-619)", next: "buy_credit_issues" },
                { label: "Poor (<580)", next: "res_credit_repair" }
            ]
        },
        buy_credit_issues: {
            text: "Any open disputes or collections?",
            options: [
                { label: "Yes, Disputes", next: "strat_remove_disputes" },
                { label: "Bankruptcy <2 years", next: "strat_hard_money_buy" },
                { label: "Medical Collections", next: "strat_medical_collections" }
            ]
        },
        // --- DOWN PAYMENT ---
        buy_down_source: {
            text: "Are you a Veteran?",
            options: [ { label: "Yes", next: "buy_va_check" }, { label: "No", next: "buy_rural_check" } ]
        },
        buy_va_check: {
            text: "Do you have full entitlement available?",
            options: [ { label: "Yes / First Use", next: "buy_va_disability" }, { label: "No / Subsequent Use", next: "strat_va_bonus_entitlement" } ]
        },
        buy_va_disability: {
            text: "Do you have a service-connected disability rating?",
            options: [ { label: "Yes (10%+)", next: "strat_va_fee_waiver" }, { label: "No", next: "strat_va_loan" } ]
        },
        buy_rural_check: {
            text: "Willing to buy Rural?",
            options: [ { label: "Yes", next: "strat_usda_loan" }, { label: "No", next: "buy_gift_check" } ]
        },
        buy_gift_check: {
            text: "Do you have gift funds?",
            options: [ { label: "Yes", next: "buy_gift_seasoning" }, { label: "No", next: "res_grant" } ]
        },
        buy_gift_seasoning: {
            text: "Are the funds currently in your bank account?",
            options: [ { label: "Yes, >60 days", next: "res_conventional_check" }, { label: "No, wiring later", next: "strat_gift_letter" } ]
        },
        // --- INVENTORY & OFFER STRATEGY ---
        buy_inventory_triage: {
            text: "Property Type preference?",
            options: [
                { label: "Single Family", next: "buy_sfh_features" },
                { label: "Condo/Townhome", next: "buy_condo_check" },
                { label: "Multi-Unit", next: "strat_house_hack_invest" },
                { label: "New Construction", next: "buy_new_build_check" }
            ]
        },
        buy_new_build_check: {
            text: "Custom or Tract Home?",
            options: [
                { label: "Tract (Subdivision)", next: "strat_builder_reg" },
                { label: "Custom (My Lot)", next: "strat_construction_loan" }
            ]
        },
        buy_sfh_features: {
            text: "Any specific needs?",
            options: [
                { label: "Multi-Generational", next: "strat_multigen_search" },
                { label: "Green/Solar", next: "strat_solar_check" },
                { label: "Pool", next: "strat_pool_inspection" },
                { label: "Standard", next: "buy_offer_market" }
            ]
        },
        buy_offer_market: {
            text: "How competitive is the market right now?",
            options: [
                { label: "Bidding Wars", next: "buy_aggressive_offer" },
                { label: "Balanced/Slow", next: "buy_inspection_pref" }
            ]
        },
        buy_aggressive_offer: {
            text: "Are you willing to cover an Appraisal Gap?",
            options: [
                { label: "Yes, I have extra cash", next: "strat_appraisal_gap_guarantee" },
                { label: "No, max budget", next: "strat_escalation_clause" }
            ]
        },
        buy_inspection_pref: {
            text: "Inspection preferences?",
            options: [
                { label: "Info Only (Pass/Fail)", next: "strat_info_only_inspection" },
                { label: "Full Negotiation", next: "buy_age_check" }
            ]
        },
        buy_age_check: {
            text: "Are you looking at homes built before 1978?",
            options: [
                { label: "Yes (Vintage)", next: "buy_vintage_risk" }, // Updated
                { label: "No (Modern)", next: "buy_system_check" }
            ]
        },
        buy_vintage_risk: { // NEW
            text: "Are you concerned about lead or asbestos?",
            options: [
                { label: "Yes, Safety First", next: "strat_lead_paint" },
                { label: "No, I will rehab", next: "strat_203k_rehab" }
            ]
        },
        buy_system_check: {
            text: "Water/Sewer Source?",
            options: [
                { label: "Public/City", next: "strat_sewer_scope" },
                { label: "Private Well/Septic", next: "strat_septic_inspection" }
            ]
        },
        buy_condo_check: {
            text: "Is the HOA healthy?",
            options: [ { label: "Yes/Unknown", next: "strat_condo_warrantable" }, { label: "No (Litigation)", next: "strat_non_warrantable" } ]
        },

        // --- REPEAT BUYER ---
        buy_repeat_triage: {
            text: "Sell current home first?",
            options: [ { label: "Yes", next: "buy_contingency" }, { label: "No", next: "buy_2nd_home" } ]
        },
        buy_contingency: {
            text: "Is it listed?",
            options: [ { label: "Yes", next: "strat_concurrent" }, { label: "No", next: "buy_equity_check" } ]
        },
        buy_equity_check: {
            text: "Equity > 30%?",
            options: [ { label: "Yes", next: "strat_bridge" }, { label: "No", next: "strat_sell_first" } ]
        },
        buy_2nd_home: {
            text: "Primary use?",
            options: [ { label: "Vacation", next: "strat_vacation" }, { label: "Investment", next: "strat_buy_hold" } ]
        },

        // ==========================================
        // BRANCH 2: SELLING (MEGA EXPANSION)
        // ==========================================
        sell_node_1: {
            text: "Is the property currently Occupied or Vacant?",
            options: [
                { label: "Occupied by Me", next: "sell_pets_check" },
                { label: "Occupied by Tenant", next: "sell_tenant_lease" },
                { label: "Vacant", next: "sell_vacant_issues" },
                { label: "Hoarder Situation", next: "strat_hoarder_cleanout" }
            ]
        },
        sell_pets_check: {
            text: "Do you have pets in the home?",
            options: [
                { label: "Yes", next: "strat_pet_showing_plan" },
                { label: "No", next: "sell_reason_check" }
            ]
        },
        sell_vacant_issues: {
            text: "Is the property winterized and insured as vacant?",
            options: [
                { label: "Yes, fully secured", next: "strat_vacant_staging" },
                { label: "No, utilities are off", next: "strat_utility_activation" }
            ]
        },
        sell_reason_check: {
            text: "Primary reason for selling?",
            options: [
                { label: "Upgrading / Downsizing", next: "sell_taxes_check" },
                { label: "Financial Distress / Debt", next: "sell_distress" },
                { label: "Divorce / Separation", next: "sell_divorce_status" },
                { label: "Inheritance / Probate", next: "sell_probate" }
            ]
        },
        sell_taxes_check: {
            text: "Lived there 2 of last 5 years?",
            options: [ { label: "Yes", next: "sell_title_check" }, { label: "No", next: "strat_cap_gains_calc" } ]
        },
        sell_title_check: {
            text: "Is the home in a Trust?",
            options: [ { label: "Yes", next: "strat_trust_sale" }, { label: "No", next: "sell_financial_status" } ]
        },
        sell_divorce_status: {
            text: "Amicable or Contested?",
            options: [ { label: "Amicable", next: "sell_title_transfer" }, { label: "Contested", next: "strat_divorce_neutral" } ]
        },
        sell_title_transfer: {
            text: "Are you selling or is one spouse keeping it?",
            options: [ { label: "Selling", next: "sell_financial_status" }, { label: "Spouse Keeping", next: "strat_quit_claim" } ]
        },
        sell_financial_status: {
            text: "Equity Status?",
            options: [ { label: "Positive", next: "sell_retail_condition" }, { label: "Negative", next: "sell_distress" } ]
        },
        sell_retail_condition: {
            text: "Any known defects?",
            options: [
                { label: "Structural/Foundation", next: "strat_structural_eng" },
                { label: "Electrical/Plumbing", next: "sell_systems_age" }, // NEW
                { label: "Unpermitted Work", next: "strat_retro_permit" },
                { label: "Good Condition", next: "sell_solar_check" }
            ]
        },
        sell_systems_age: { // NEW
            text: "Type of Wiring/Plumbing?",
            options: [
                { label: "Knob & Tube / Galv", next: "strat_system_upgrade_credit" },
                { label: "Modern (Romex/Copper)", next: "strat_home_warranty" }
            ]
        },
        sell_solar_check: {
            text: "Do you have Solar Panels?",
            options: [
                { label: "Yes, Leased", next: "strat_solar_lease_transfer" },
                { label: "Yes, Owned", next: "strat_green_marketing" },
                { label: "No", next: "sell_historic_check" }
            ]
        },
        sell_historic_check: {
            text: "Is the home in a Historic District?",
            options: [
                { label: "Yes, Historic/Landmark", next: "strat_historic_sale" },
                { label: "No", next: "sell_stigma_check" }
            ]
        },
        sell_stigma_check: {
            text: "Are there any 'Stigmatized' issues (Death/Crime)?",
            options: [
                { label: "Yes", next: "strat_stigma_disclosure" },
                { label: "No", next: "sell_luxury_check" }
            ]
        },
        sell_tenant_lease: {
            text: "Lease Type?",
            options: [ { label: "Month-to-Month", next: "strat_cash_keys_coop" }, { label: "Long Term", next: "strat_tenant_sale" }, { label: "Eviction needed", next: "strat_eviction_sale" } ]
        },
        sell_luxury_check: {
            text: "Value > $800k?",
            options: [ { label: "Yes", next: "sell_privacy_check" }, { label: "No", next: "strat_concierge" } ]
        },
        sell_privacy_check: {
            text: "Require privacy?",
            options: [ { label: "Yes", next: "strat_luxury_private" }, { label: "No", next: "strat_luxury_listing" } ]
        },
        // --- DISTRESS ---
        sell_distress: {
            text: "Any Liens?",
            options: [ { label: "Yes", next: "strat_title_clearance" }, { label: "No", next: "sell_mortgage_status" } ]
        },
        sell_mortgage_status: {
            text: "Behind on payments?",
            options: [ { label: "Yes", next: "sell_hardship" }, { label: "No", next: "strat_hold_rent" } ]
        },
        sell_hardship: {
            text: "Reverse Mortgage?",
            options: [ { label: "Yes", next: "strat_reverse_mortgage_sale" }, { label: "No", next: "sell_assets_check" } ]
        },
        sell_assets_check: {
            text: "Other Assets?",
            options: [ { label: "Yes", next: "strat_short_sale" }, { label: "No", next: "strat_deed_lieu" } ]
        },
        sell_probate: {
            text: "Letters of Office?",
            options: [ { label: "Yes", next: "sell_probate_type" }, { label: "No", next: "strat_probate_court" }, { label: "Unknown", next: "strat_probate_bond" } ]
        },
        sell_probate_type: {
            text: "Is there a Will?",
            options: [ { label: "Yes", next: "strat_probate_easy" }, { label: "No (Intestate)", next: "strat_probate_intestate" } ]
        },

        // ==========================================
        // BRANCH 3: REFINANCE
        // ==========================================
        refi_node_1: {
            text: "Primary Goal?",
            options: [
                { label: "Lower Payment", next: "refi_rate_check" },
                { label: "Cash Out", next: "refi_cash_reason" },
                { label: "Remove PMI", next: "refi_pmi_check" },
                { label: "Divorce Buyout", next: "strat_divorce_refi" }
            ]
        },
        refi_rate_check: {
            text: "Loan Type?",
            options: [ { label: "FHA/VA", next: "strat_streamline_refi" }, { label: "Conventional", next: "refi_credit_check" } ]
        },
        refi_credit_check: {
            text: "Score > 720?",
            options: [ { label: "Yes", next: "strat_rate_term_refi" }, { label: "No", next: "res_credit_repair" } ]
        },
        refi_cash_reason: {
            text: "Use of funds?",
            options: [
                { label: "Debt Consolidation", next: "strat_debt_consolidation" },
                { label: "Home Improvement", next: "refi_renovation_style" },
                { label: "Investment", next: "strat_cash_out_invest" },
                { label: "Buy 2nd Home", next: "strat_reverse_purchase" }
            ]
        },
        refi_renovation_style: {
            text: "Loan Preference?",
            options: [
                { label: "Keep current rate (HELOC)", next: "strat_renovation_heloc" },
                { label: "Refinance all (Cash-Out)", next: "strat_cash_out_refi" }
            ]
        },
        refi_pmi_check: {
            text: "Equity > 20%?",
            options: [ { label: "Yes", next: "strat_pmi_removal" }, { label: "Not sure", next: "strat_appraisal_gap" } ]
        },

        // ==========================================
        // BRANCH 4: INVESTING (MASSIVE EXPANSION)
        // ==========================================
        invest_node_1: {
            text: "Funding Source?",
            options: [
                { label: "Cash / Conventional", next: "inv_creative_check" },
                { label: "Retirement Funds", next: "strat_sdir_custodian" },
                { label: "1031 Exchange", next: "inv_1031_window" }
            ]
        },
        inv_creative_check: {
            text: "Interested in Creative Financing?",
            options: [
                { label: "Yes (Sub2 / Seller Fin)", next: "inv_creative_type" },
                { label: "No, Standard Bank Loan", next: "inv_involvement" }
            ]
        },
        inv_creative_type: {
            text: "Preferred Method?",
            options: [
                { label: "Subject-To (Take over payments)", next: "strat_subject_to" },
                { label: "Seller Financing", next: "strat_seller_finance" },
                { label: "Lease Option", next: "strat_lease_option" }
            ]
        },
        inv_involvement: {
            text: "Preferred involvement?",
            options: [ { label: "Active", next: "inv_experience" }, { label: "Passive", next: "inv_passive_check" } ]
        },
        inv_experience: {
            text: "Experience level?",
            options: [ { label: "Experienced", next: "inv_active_risk" }, { label: "Beginner", next: "inv_beginner_path" } ]
        },
        inv_beginner_path: {
            text: "Capital available?",
            options: [ { label: "Under $50k", next: "strat_house_hack_invest" }, { label: "$50k+", next: "strat_turnkey" } ]
        },
        inv_active_risk: {
            text: "Vehicle?",
            options: [
                { label: "Flip", next: "strat_fix_flip" },
                { label: "Long Term Rental", next: "inv_unit_count" },
                { label: "Airbnb", next: "inv_airbnb_check" },
                { label: "Niche Assets", next: "inv_niche_check" },
                { label: "Raw Land", next: "inv_land_check" },
                { label: "Notes / Debt", next: "inv_note_type" } // NEW
            ]
        },
        inv_note_type: { // NEW
            text: "Note Type?",
            options: [
                { label: "Performing (Cash Flow)", next: "strat_performing_note" },
                { label: "Non-Performing (Foreclosure)", next: "strat_non_performing_note" }
            ]
        },
        inv_niche_check: {
            text: "Which Niche Asset?",
            options: [
                { label: "Wholesaling", next: "strat_wholesaling" },
                { label: "Mobile Home Parks", next: "strat_mhp_invest" },
                { label: "Storage Units", next: "strat_storage_invest" },
                { label: "Laundromat / Car Wash", next: "strat_operational_asset" },
                { label: "Assisted Living", next: "strat_alf_invest" }, // NEW
                { label: "Billboards / Cell Towers", next: "strat_billboard_lease" } // NEW
            ]
        },
        inv_airbnb_check: {
            text: "Management style?",
            options: [ { label: "Self-Manage", next: "inv_airbnb_pricing" }, { label: "Property Manager", next: "strat_str_managed" } ]
        },
        inv_airbnb_pricing: {
            text: "Have you analyzed dynamic pricing?",
            options: [ { label: "Yes", next: "strat_str_self" }, { label: "No", next: "strat_airbnb_dynamic_pricing" } ]
        },
        inv_land_check: {
            text: "Improved or Raw?",
            options: [ { label: "Improved", next: "strat_land_build" }, { label: "Raw", next: "inv_land_survey" } ]
        },
        inv_land_survey: {
            text: "Perc Test done?",
            options: [ { label: "Yes", next: "strat_land_hold" }, { label: "No", next: "strat_land_feasibility" } ]
        },
        inv_unit_count: {
            text: "Size?",
            options: [ { label: "2-4 Units", next: "strat_buy_hold" }, { label: "5+ Units", next: "strat_multifamily_commercial" } ]
        },
        inv_passive_check: {
            text: "Accredited?",
            options: [ { label: "Yes", next: "inv_syndication_type" }, { label: "No", next: "strat_reit" } ]
        },
        inv_syndication_type: {
            text: "Strategy Preference?",
            options: [ { label: "Value Add", next: "strat_syndication" }, { label: "Cost Segregation Focus", next: "strat_cost_seg" }, { label: "Opportunity Zone", next: "strat_opportunity_zone" } ] // NEW
        },
        inv_1031_window: {
            text: "Sold <45 days ago?",
            options: [ { label: "Yes", next: "inv_1031_boot" }, { label: "No", next: "strat_1031" } ]
        },
        inv_1031_boot: {
            text: "Are you taking any cash out (Boot)?",
            options: [ { label: "Yes", next: "strat_1031_boot_tax" }, { label: "No, full reinvestment", next: "strat_dst" } ]
        },

        // ==========================================
        // BRANCH 5: COMMERCIAL
        // ==========================================
        comm_node_1: {
            text: "Asset Class?",
            options: [
                { label: "Retail", next: "comm_retail_node" },
                { label: "Office", next: "comm_office_node" },
                { label: "Industrial", next: "comm_industrial_node" },
                { label: "Special Purpose", next: "comm_special_purpose" }
            ]
        },
        comm_special_purpose: {
            text: "Specific Use?",
            options: [
                { label: "Gas Station", next: "comm_env_check" },
                { label: "Car Wash", next: "strat_operational_asset" },
                { label: "Church / Religious", next: "strat_religious_zoning" },
                { label: "Data Center", next: "strat_data_center" }
            ]
        },
        comm_env_check: {
            text: "Phase 1 Report?",
            options: [
                { label: "Clean", next: "strat_sba_504" },
                { label: "Dirty/Unknown", next: "strat_phase_2_env" }
            ]
        },
        comm_retail_node: {
            text: "Use?",
            options: [ { label: "Restaurant", next: "strat_restaurant_buy" }, { label: "Liquor Store", next: "strat_liquor_license" }, { label: "General", next: "comm_retail_signage" } ]
        },
        comm_retail_signage: {
            text: "Is visibility critical?",
            options: [ { label: "Yes, need Pylon Sign", next: "strat_pylon_signage" }, { label: "No", next: "comm_lease_own" } ]
        },
        comm_office_node: {
            text: "Use?",
            options: [ { label: "Medical", next: "comm_parking_check" }, { label: "General", next: "comm_lease_own" } ]
        },
        comm_parking_check: {
            text: "Does it meet 5:1000 Parking Ratio?",
            options: [ { label: "Yes", next: "strat_medical_office" }, { label: "No", next: "strat_parking_variance" } ]
        },
        comm_industrial_node: {
            text: "Requirement?",
            options: [ { label: "High Ceilings", next: "comm_crane_check" }, { label: "Loading Docks", next: "comm_loading_check" } ]
        },
        comm_loading_check: {
            text: "Dock Height or Drive-In?",
            options: [ { label: "Dock Height", next: "strat_industrial_logistics" }, { label: "Drive-In", next: "strat_flex_space" } ]
        },
        comm_crane_check: {
            text: "Need Overhead Cranes?",
            options: [ { label: "Yes", next: "strat_heavy_manufacturing" }, { label: "No", next: "strat_flex_space" } ]
        },
        comm_lease_own: {
            text: "Strategy?",
            options: [ { label: "Buy", next: "strat_sba_504" }, { label: "Lease", next: "comm_lease_guarantee" }, { label: "Biz Only", next: "strat_biz_opp" } ]
        },
        comm_lease_guarantee: {
            text: "Will you sign a Personal Guarantee?",
            options: [ { label: "Yes", next: "strat_burn_off_clause" }, { label: "No", next: "strat_lease_audit" } ]
        },

        // ==========================================
        // BRANCH 6: LAND / DEVELOPMENT
        // ==========================================
        land_node_1: {
            text: "What is the current zoning?",
            options: [
                { label: "Residential", next: "land_infill_check" },
                { label: "Agricultural", next: "strat_ag_zoning" },
                { label: "Commercial", next: "strat_land_hold" }
            ]
        },
        land_infill_check: {
            text: "Is this an infill lot (between existing homes)?",
            options: [
                { label: "Yes", next: "strat_infill_development" },
                { label: "No, large tract", next: "strat_subdivision" }
            ]
        },

        // ==========================================
        // OUTCOMES
        // ==========================================
        
        // --- NEW OUTCOMES (Total >200) ---
        strat_alf_invest: { text: "Strategy: Assisted Living Conversion. We target single-level homes (4+ beds) with wide hallways. High cash flow potential, but requires strict state licensing and fire suppression systems.", options: [] },
        strat_billboard_lease: { text: "Strategy: Easement/Lease Buyout. You can buy the land under a cell tower or billboard. These are 'Triple Net' investments with zero landlord responsibilities and long-term contracts.", options: [] },
        strat_performing_note: { text: "Strategy: Performing Note Investing. You act as the bank. You buy the mortgage debt, not the property. You collect monthly P&I checks without fixing toilets.", options: [] },
        strat_non_performing_note: { text: "Strategy: Distressed Debt Acquisition. You buy the mortgage at a discount (e.g., 50 cents on the dollar) and then either foreclose to get the property or modify the loan with the borrower.", options: [] },
        strat_opportunity_zone: { text: "Strategy: Opportunity Zone Fund (QOF). If you have Capital Gains, you can roll them into a QOF. If you hold the new asset for 10 years, the appreciation on the new asset is tax-free.", options: [] },
        strat_blind_trust: { text: "Strategy: Blind Trust / Land Trust. To keep your name off public records, we title the property in a Trust. The beneficiary remains private. Critical for high-net-worth clients.", options: [] },
        strat_dscr_llc: { text: "Strategy: DSCR Loan in LLC. We close directly in your LLC's name using a Debt Service Coverage Ratio loan. Lenders look at the property's rent vs expenses, not your personal income.", options: [] },
        strat_trust_purchase: { text: "Strategy: Trust Purchase. The Trust is the buyer. We need the Certificate of Trust and the Trustee must sign. This facilitates seamless estate planning and avoids probate later.", options: [] },
        strat_system_upgrade_credit: { text: "Strategy: Safety Upgrade Credit. Knob & Tube wiring and Galvanized plumbing make homes uninsurable. We must negotiate a seller credit to replace these systems *immediately* after closing.", options: [] },
        
        // --- RETAINED OUTCOMES ---
        strat_construction_loan: { text: "Strategy: Construction-to-Perm Loan. One closing for lot+build.", options: [] },
        strat_pool_inspection: { text: "Strategy: Pool Inspect. Pressure test lines.", options: [] },
        strat_stigma_disclosure: { text: "Strategy: Stigma Disclosure. Transparency prevents lawsuits.", options: [] },
        strat_operational_asset: { text: "Strategy: Operational Asset. EBITDA value.", options: [] },
        strat_mixed_use: { text: "Strategy: Mixed Use. Commercial loan.", options: [] },
        strat_ag_zoning: { text: "Strategy: Ag Zoning. Future use check.", options: [] },
        strat_infill_development: { text: "Strategy: Infill Dev. Buildability check.", options: [] },
        strat_subdivision: { text: "Strategy: Subdivision. Entitlement profit.", options: [] },
        strat_employment_gap_letter: { text: "Strategy: Gap Letter. Explain employment gap.", options: [] },
        strat_offer_letter_loan: { text: "Strategy: Offer Letter Loan. Close before start.", options: [] },
        strat_pool_marketing: { text: "Strategy: Pool Marketing. Lifestyle photos.", options: [] },
        strat_unique_appraisal: { text: "Strategy: Complex Appraisal. Specialist required.", options: [] },
        strat_data_center: { text: "Strategy: Data Center. Power focus.", options: [] },
        strat_str_glamping: { text: "Strategy: Glamping. Land use permit.", options: [] },
        strat_religious_zoning: { text: "Strategy: Religious Zoning. Tax impact.", options: [] },
        strat_remote_worker_letter: { text: "Strategy: Remote Letter. HR verification.", options: [] },
        strat_transfer_letter: { text: "Strategy: Transfer Letter. Moving date.", options: [] },
        strat_fixed_income_gross_up: { text: "Strategy: Income Gross Up. Non-taxable credit.", options: [] },
        strat_cold_storage: { text: "Strategy: Cold Storage. Equipment value.", options: [] },
        strat_drive_thru: { text: "Strategy: Drive Thru. Special use permit.", options: [] },
        strat_office_conversion: { text: "Strategy: Office Convert. Plumbing check.", options: [] },
        strat_coop_board: { text: "Strategy: Co-Op Board. Interview prep.", options: [] },
        strat_barndominium: { text: "Strategy: Barndo Loan. Local bank.", options: [] },
        strat_fha_manufactured: { text: "Strategy: FHA Manufactured. Perm foundation.", options: [] },
        strat_chattel_loan: { text: "Strategy: Chattel Loan. Personal property.", options: [] },
        strat_bk13_manual: { text: "Strategy: BK13 Buy. Court approval.", options: [] },
        strat_identity_interest: { text: "Strategy: Identity Interest. Family buy.", options: [] },
        strat_1099_only_loan: { text: "Strategy: 1099 Only. No tax returns.", options: [] },
        strat_1yr_tax_return: { text: "Strategy: 1 Yr Tax Return. Strong year.", options: [] },
        strat_va_fee_waiver: { text: "Strategy: VA Funding Fee Waiver. Disability exemption.", options: [] },
        strat_va_bonus_entitlement: { text: "Strategy: VA Bonus Entitlement. Second VA loan.", options: [] },
        strat_subject_to: { text: "Strategy: Subject-To. Take over payments.", options: [] },
        strat_seller_finance: { text: "Strategy: Seller Financing. Direct payments.", options: [] },
        strat_lease_option: { text: "Strategy: Lease Option. Rent to own.", options: [] },
        strat_airbnb_dynamic_pricing: { text: "Strategy: Dynamic Pricing. Automated revenue.", options: [] },
        strat_cost_seg: { text: "Strategy: Cost Segregation. Tax write-offs.", options: [] },
        strat_1031_boot_tax: { text: "Strategy: Partial Exchange. Pay tax on boot.", options: [] },
        strat_pylon_signage: { text: "Strategy: Pylon Signage. Visibility rights.", options: [] },
        strat_burn_off_clause: { text: "Strategy: Burn-Off Clause. Limit guarantee.", options: [] },
        strat_cash_keys_coop: { text: "Strategy: Cash for Keys. Tenant buyout.", options: [] },
        strat_probate_intestate: { text: "Strategy: Intestate Succession. State law heirs.", options: [] },
        strat_quit_claim: { text: "Strategy: Quit Claim. Spousal transfer.", options: [] },
        strat_info_only_inspection: { text: "Strategy: Info-Only Inspect. Pass/Fail.", options: [] },
        strat_appraisal_gap_guarantee: { text: "Strategy: Appraisal Gap. Cash cover.", options: [] },
        strat_escalation_clause: { text: "Strategy: Escalation Clause. Beat offers.", options: [] },
        strat_lead_paint: { text: "Strategy: Lead Paint. Disclosure required.", options: [] },
        strat_sewer_scope: { text: "Strategy: Sewer Scope. Check pipes.", options: [] },
        strat_septic_inspection: { text: "Strategy: Septic Load Test. Check field.", options: [] },
        strat_pet_showing_plan: { text: "Strategy: Pet Plan. Logistics.", options: [] },
        strat_green_mortgage: { text: "Strategy: Energy Mortgage. Finance upgrades.", options: [] },
        strat_itin_loan: { text: "Strategy: ITIN Financing. 15-20% down using ITIN tax returns.", options: [] },
        strat_foreign_national: { text: "Strategy: Foreign National Loan. DSCR loan for non-residents.", options: [] },
        strat_co_buy_agreement: { text: "Strategy: Co-Buying Agreement. Title as 'Tenants in Common'.", options: [] },
        strat_corp_relo: { text: "Strategy: Corporate Relocation Rider. Protect benefits.", options: [] },
        strat_tiny_home: { text: "Strategy: Tiny Home Zoning. Check for ADU compliance.", options: [] },
        strat_hoarder_cleanout: { text: "Strategy: Discrete Cleanout. Compassionate crew first.", options: [] },
        strat_vacant_staging: { text: "Strategy: Virtual Staging. Digital furniture for empty rooms.", options: [] },
        strat_utility_activation: { text: "Strategy: Utility De-Winterization. Activate for inspection.", options: [] },
        strat_structural_eng: { text: "Strategy: Structural Engineer Report. Pre-inspect foundation.", options: [] },
        strat_home_warranty: { text: "Strategy: Seller Coverage Warranty. Covers systems during listing.", options: [] },
        strat_solar_lease_transfer: { text: "Strategy: Solar Lease Transfer. Critical path for closing.", options: [] },
        strat_historic_sale: { text: "Strategy: Historic Tax Freeze. Market tax incentives.", options: [] },
        strat_divorce_refi: { text: "Strategy: Owelty Lien. Buyout spouse equity.", options: [] },
        strat_reverse_purchase: { text: "Strategy: HECM for Purchase. 50% down, no payments.", options: [] },
        strat_sdir_custodian: { text: "Strategy: Self-Directed IRA. Custodian required.", options: [] },
        strat_wholesaling: { text: "Strategy: Wholesaling. Assign contract for fee.", options: [] },
        strat_mhp_invest: { text: "Strategy: Mobile Home Park. Own dirt, rent pads.", options: [] },
        strat_student_housing: { text: "Strategy: Student Housing. Rent by bedroom.", options: [] },
        strat_storage_invest: { text: "Strategy: Self-Storage. Climate controlled focus.", options: [] },
        strat_phase_2_env: { text: "Strategy: Phase 2 Environmental. Soil testing required.", options: [] },
        strat_liquor_license: { text: "Strategy: Liquor License. Verify transferability.", options: [] },
        strat_parking_variance: { text: "Strategy: Parking Variance. Zoning petition.", options: [] },
        strat_heavy_manufacturing: { text: "Strategy: Heavy Manufacturing. Floor load capacity.", options: [] },
        strat_ot_avg: { text: "Strategy: Overtime Averaging. 2-year history needed.", options: [] },
        strat_medical_collections: { text: "Strategy: Medical Debt Exclusion. Ignored by many lenders.", options: [] },
        strat_green_marketing: { text: "Strategy: Green Premium. Appraisal addendum for solar.", options: [] },
        strat_virtual_tour: { text: "Strategy: Virtual Relocation. Video tours + rescission period.", options: [] },
        strat_jumbo_loan: { text: "Strategy: Jumbo Financing. Portfolio lenders.", options: [] },
        strat_usda_loan: { text: "Strategy: USDA Rural. 0% down in eligible zones.", options: [] },
        strat_fsbo_conversion: { text: "Strategy: MLS Exposure. Unlock 97% of buyers.", options: [] },
        strat_expired_relist: { text: "Strategy: Market Refresh. New photos and price.", options: [] },
        strat_cap_gains_calc: { text: "Strategy: Tax Analysis. 1031 vs Capital Gains.", options: [] },
        strat_private_showings: { text: "Strategy: Appointment Only. No open houses.", options: [] },
        strat_str_self: { text: "Strategy: Self-Managed Airbnb. High revenue, high effort.", options: [] },
        strat_str_managed: { text: "Strategy: Managed STR. Passive income, lower net.", options: [] },
        strat_land_build: { text: "Strategy: Construction-to-Perm. One close.", options: [] },
        strat_zoning_attorney: { text: "Strategy: Zoning Contingency. Special Use Permit.", options: [] },
        strat_biz_opp: { text: "Strategy: Business Asset Sale. Buy cash flow.", options: [] },
        strat_bank_statement: { text: "Strategy: Bank Statement Loan. 12mo deposits.", options: [] },
        strat_physician_loan: { text: "Strategy: Physician Loan. Exclude student loans.", options: [] },
        strat_manual_underwriting: { text: "Strategy: Manual Underwrite. Non-traditional credit.", options: [] },
        strat_hard_money_buy: { text: "Strategy: Hard Money. Bridge loan for distress.", options: [] },
        strat_new_construction: { text: "Strategy: Builder Rep. Negotiate upgrades.", options: [] },
        strat_builder_reg: { text: "Strategy: Builder Intervention. Contract review.", options: [] },
        strat_divorce_neutral: { text: "Strategy: Neutral Sale. Unbiased representation.", options: [] },
        strat_senior_transition: { text: "Strategy: Rightsizing. Estate sale coordination.", options: [] },
        strat_luxury_private: { text: "Strategy: Private Placement. Off-market.", options: [] },
        strat_eviction_sale: { text: "Strategy: Cash-for-Keys. Pay tenant to leave.", options: [] },
        strat_probate_conflict: { text: "Strategy: Mediator Sale. Transparent offer presentation.", options: [] },
        strat_house_hack_invest: { text: "Strategy: House Hack. FHA 3.5% multifamily.", options: [] },
        strat_multifamily_commercial: { text: "Strategy: DSCR Loan. Income based.", options: [] },
        strat_restaurant_buy: { text: "Strategy: 2nd Gen Restaurant. Save CAPEX.", options: [] },
        strat_medical_office: { text: "Strategy: TI Allowance. Landlord pays buildout.", options: [] },
        strat_flex_space: { text: "Strategy: Flex Space. Industrial/Office mix.", options: [] },
        strat_commuter_hub: { text: "Strategy: Transit Oriented. Train proximity.", options: [] },
        strat_school_zone: { text: "Strategy: District Search. Boundary focus.", options: [] },
        strat_va_loan: { text: "Strategy: VA Loan. 0% down for Vets.", options: [] },
        strat_203k_rehab: { text: "Strategy: FHA 203k. Reno loan.", options: [] },
        res_grant: { text: "Strategy: DPA Grant. Assistance available.", options: [] },
        res_fha_standard: { text: "Strategy: FHA 3.5%. Low down payment.", options: [] },
        res_credit_repair: { text: "Strategy: Credit Roadmap. Fix score first.", options: [] },
        strat_concurrent: { text: "Strategy: Concurrent Closing. Same day.", options: [] },
        strat_bridge: { text: "Strategy: Bridge Loan. Buy then sell.", options: [] },
        strat_sell_first: { text: "Strategy: Contingency. Protected sale.", options: [] },
        strat_vacation: { text: "Strategy: Vacation Analysis. ROI check.", options: [] },
        strat_leaseback: { text: "Strategy: Rent-Back. Post-close possession.", options: [] },
        strat_luxury_listing: { text: "Strategy: Luxury Marketing. Global reach.", options: [] },
        strat_tenant_sale: { text: "Strategy: Investor Sale. Sell with tenant.", options: [] },
        strat_concierge: { text: "Strategy: Concierge. Max prep/price.", options: [] },
        strat_instant: { text: "Strategy: Instant Offer. Speed focus.", options: [] },
        strat_hold_rent: { text: "Strategy: Rent & Hold. Wait for equity.", options: [] },
        strat_short_sale: { text: "Strategy: Short Sale. Bank negotiation.", options: [] },
        strat_deed_lieu: { text: "Strategy: Deed in Lieu. Voluntray surrender.", options: [] },
        strat_probate_easy: { text: "Strategy: Independent Admin. Fast probate.", options: [] },
        strat_probate_court: { text: "Strategy: Court Approval. Slow probate.", options: [] },
        strat_probate_bond: { text: "Strategy: Bond in Lieu. Sell early.", options: [] },
        strat_turnkey: { text: "Strategy: Turnkey. Done-for-you.", options: [] },
        strat_dst: { text: "Strategy: DST 1031. Passive exchange.", options: [] },
        strat_fix_flip: { text: "Strategy: Fix & Flip. 70% rule.", options: [] },
        strat_brrrr: { text: "Strategy: BRRRR. Recycle capital.", options: [] },
        strat_buy_hold: { text: "Strategy: Buy & Hold. Long term.", options: [] },
        strat_syndication: { text: "Strategy: Syndication. Group invest.", options: [] },
        strat_reit: { text: "Strategy: REIT. Stock invest.", options: [] },
        strat_hold_refi: { text: "Strategy: Cash Out Refi. Access equity.", options: [] },
        strat_1031: { text: "Strategy: 1031 Exchange. Defer tax.", options: [] },
        strat_sba_504: { text: "Strategy: SBA 504. Owner user.", options: [] },
        strat_lease_audit: { text: "Strategy: NNN Audit. Check expenses.", options: [] },
        strat_lease_base_year: { text: "Strategy: Base Year. Cap expenses.", options: [] },
        strat_industrial_logistics: { text: "Strategy: Logistics. High ceilings.", options: [] },
        res_conventional_check: { text: "Strategy: Conventional. Standard loan.", options: [] },
        strat_streamline_refi: { text: "Strategy: Streamline Refi. No appraisal.", options: [] },
        strat_rate_term_refi: { text: "Strategy: Rate/Term Refi. Lower rate.", options: [] },
        strat_debt_consolidation: { text: "Strategy: Debt Consolidation. Pay cards.", options: [] },
        strat_renovation_heloc: { text: "Strategy: HELOC. Reno funds.", options: [] },
        strat_cash_out_invest: { text: "Strategy: Invest Cash Out. Buy rental.", options: [] },
        strat_pmi_removal: { text: "Strategy: PMI Removal. Appraise out.", options: [] },
        strat_appraisal_gap: { text: "Strategy: Appraisal Gap. Check value.", options: [] },
        strat_fha_ibr: { text: "Strategy: FHA IBR. Student loans.", options: [] },
        strat_conventional_1percent: { text: "Strategy: Conventional Student. 1% calc.", options: [] },
        strat_cosigner_fha: { text: "Strategy: Co-Signer. Blend income.", options: [] },
        strat_condo_warrantable: { text: "Strategy: Warrantable. Healthy HOA.", options: [] },
        strat_non_warrantable: { text: "Strategy: Non-Warrantable. Portfolio loan.", options: [] },
        strat_multigen_search: { text: "Strategy: Multi-Gen. In-law suite.", options: [] },
        strat_remove_disputes: { text: "Strategy: Remove Disputes. Clear credit.", options: [] },
        strat_gift_letter: { text: "Strategy: Gift Letter. Doc funds.", options: [] },
        strat_trust_sale: { text: "Strategy: Trust Sale. Trustee signs.", options: [] },
        strat_retro_permit: { text: "Strategy: Retroactive Permit. Legalize.", options: [] },
        strat_title_clearance: { text: "Strategy: Title Clear. Remove liens.", options: [] },
        strat_reverse_mortgage_sale: { text: "Strategy: HECM Payoff. Sell fast.", options: [] },
        strat_land_feasibility: { text: "Strategy: Feasibility. Soil test.", options: [] },
        strat_cash_out_refi: { text: "Strategy: Cash Out Refi. Full replacement.", options: [] },
        strat_land_hold: { text: "Strategy: Land Banking. Hold.", options: [] },
        strat_gap_employment: { text: "Strategy: Gap Explanation. Explain gap.", options: [] },
        strat_cash_only_manu: { text: "Strategy: Cash Sale. No financing available.", options: [] },
        strat_log_cabin: { text: "Strategy: Log Home Finance. Unique comp requirements.", options: [] },
        strat_str_urban_reg: { text: "Strategy: Urban STR. Check city ban list.", options: [] },
        strat_str_vacation: { text: "Strategy: Vacation Rental. High season revenue.", options: [] },
        strat_str_glamping: { text: "Strategy: Glamping Permit. Zoning check.", options: [] }
    };

    let currentNode = 'start';
    let history = []; 
    let pathLabels = []; 

    const elements = {
        question: document.getElementById('question-text'),
        options: document.getElementById('options-container'),
        backBtn: document.getElementById('back-btn'),
        progress: document.getElementById('progress-bar-fill'),
        step: document.getElementById('step-counter'),
        formContainer: document.getElementById('contact-form-container'),
        message: document.getElementById('message-field')
    };

    function renderNode() {
        const node = tree[currentNode];
        if(!node) {
            console.error("Node not found:", currentNode);
            return;
        }

        elements.question.innerText = node.text;
        elements.options.innerHTML = '';
        
        const isResult = node.options.length === 0;
        const stepCount = history.length + 1;
        
        elements.step.innerText = isResult ? 'Strategy Found' : `Step ${stepCount}`;
        elements.progress.style.width = isResult ? '100%' : Math.min(stepCount * 3, 95) + '%';
        elements.backBtn.style.display = (history.length > 0) ? 'block' : 'none';

        if (isResult) {
            elements.question.classList.add('result-card');
            elements.formContainer.style.display = 'block';
            
            let complianceNote = "\n\n*Local Compliance Note (Villa Park/IL):* \n- Transfer Stamps: $0 (Villa Park), but Inspection Required ($50).\n- Mandatory Disclosures: IL Radon, Lead-Based Paint (Pre-1978).";
            elements.message.value = "Client Path: " + pathLabels.join(" > ") + "\n\nGenerated Strategy: " + node.text + complianceNote;
            
            const restartBtn = document.createElement('button');
            restartBtn.innerText = "Start Over / Try Another Scenario";
            restartBtn.className = "tree-option-btn";
            restartBtn.style.textAlign = "center";
            restartBtn.style.marginTop = "20px";
            restartBtn.style.background = "#fff";
            restartBtn.onclick = () => { 
                history = []; 
                pathLabels = []; 
                currentNode = 'start'; 
                renderNode(); 
            };
            elements.options.appendChild(restartBtn);
        } else {
            elements.question.classList.remove('result-card');
            elements.formContainer.style.display = 'none';
            node.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt.label;
                btn.className = "tree-option-btn";
                btn.onclick = () => {
                    history.push(currentNode);
                    pathLabels.push(opt.label);
                    currentNode = opt.next;
                    renderNode();
                };
                elements.options.appendChild(btn);
            });
        }
    }

    elements.backBtn.onclick = () => {
        if (history.length > 0) {
            currentNode = history.pop();
            pathLabels.pop();
            renderNode();
        }
    };

    renderNode();
});
</script>
</body>
</html>
