<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Infinity Strategy Engine 7.0 (Leviathan)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Advanced Real Estate Strategy Engine">
    
    <link rel="canonical" href="http://rospopa.github.io/">
    <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/css/favicons/unnamed-180x180.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/css/favicons/unnamed-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/css/favicons/unnamed-32x32.png">
    <link rel="icon" type="image/png" sizes="180x180" href="/css/favicons/unnamed-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/css/favicons/unnamed-192x192.png">
    <link rel="icon" type="image/png" sizes="231x231" href="/css/favicons/unnamed-231x231.png">
    <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Pavlo Rospopa Website" />
      
    <link rel="stylesheet" href="css/format.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <style>
        /* --- SECURITY / DISABLE SELECTION START --- */
        body {
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE10+/Edge */
            user-select: none; /* Standard */
        }
         
        /* Re-enable selection for inputs */
        input, textarea, select {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        /* --- CANVAS CSS --- */
        #canvas1 {
            position: absolute; 
            top: 0;
            left: 0;
            width: 100%;
            z-index: 99; 
            pointer-events: none; 
            image-rendering: pixelated; 
        }

        /* --- STRATEGY ENGINE STYLES --- */
        #real-estate-guide-container {
            margin: 40px auto; 
            padding: 30px; 
            border: 1px solid #e0e0e0; 
            border-radius: 12px;
            background-color: #ffffff; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            position: relative; 
            z-index: 101;
            max-width: 950px;
        }
        
        /* Button Style */
        .tree-option-btn {
            padding: 14px 18px; 
            background-color: #f8f9fa; 
            color: #333; 
            border: 1px solid #eef0f2;
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 0.95rem; 
            text-align: left;
            transition: all 0.1s; 
            font-weight: 500; 
            width: 100%; 
            margin-bottom: 8px; 
            display: block;
        }
        .tree-option-btn:hover { border-color: #4285F4; color: #4285F4; transform: translateX(3px); background: #f0f7ff; }
        
        /* Input & Select Styles */
        .tree-input, .tree-select {
            width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #ddd;
            border-radius: 8px; font-size: 1rem; box-sizing: border-box;
        }
        .tree-input:focus, .tree-select:focus { border-color: #4285F4; outline: none; }
        
        .next-btn {
            background-color: #4285F4; color: white; border: none; padding: 12px 24px;
            border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1rem;
        }
        .next-btn:hover { background-color: #3367d6; }

        .result-card { background: #f4f7ff; border-left: 6px solid #4285F4; padding: 25px; border-radius: 8px; color: #334155; line-height: 1.7; margin-bottom: 20px; }

        /* --- CONTACT FORM STYLES --- */
        #contact-form-container { 
            margin: 40px 0; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; background-color: #f9f9f9; 
        }
        #contact-form { display: flex; flex-direction: column; gap: 15px; }
        #contact-form input, #contact-form textarea { 
            padding: 12px; border: 1px solid #ccc; border-radius: 4px; width: 100%; box-sizing: border-box; font-family: inherit;
        }
        #contact-form button { 
            padding: 12px 24px; background-color: #333; color: white; border: none; border-radius: 4px; cursor: pointer; align-self: flex-start; font-weight: bold; 
        }
        #contact-form button:hover { background-color: #555; }
        #contact-form button:disabled { background-color: #999; cursor: not-allowed; }
        
        .progress-container { width: 100%; height: 8px; background: #eee; border-radius: 4px; margin: 15px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4285F4, #34a853); transition: width 0.3s ease; }

        #form-status { margin-top: 10px; font-weight: 500; }
        .g-recaptcha { margin-bottom: 5px; }
    </style>
</head>
     
<body>
<script>
    document.addEventListener('contextmenu', event => event.preventDefault());
    document.addEventListener('dragstart', event => event.preventDefault());
</script>

<canvas id="canvas1"></canvas>

<header class="site-header">
    <div class="wrap">
        <a class="site-title" style="text-decoration: none;" href="https://rospopa.com">Pavlo Rospopa Website</a>
        <nav class="site-nav">
            <div class="trigger">
                <a style="text-decoration: none;" href="mailto:pavlo@rospopa.com?subject=rospopa.github.io">pavlo@rospopa.com</a>
            </div>
            <div class="trigger2">
                <a style="text-decoration: none;" href="mailto:pavlo@rospopa.com?subject=rospopa.github.io">@</a>
            </div>
        </nav>
    </div>
</header>

<main>
    <div class="page-content">
        <div class="wrap">
            
            <div id="particle-anchor" style="width: 100%; height: 150px; margin-top: 20px; margin-bottom: 20px;"></div>

            <div id="real-estate-guide-container">
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <button id="back-btn" style="background:none; border:none; color:#4285F4; cursor:pointer; font-weight:bold; display:none;">← Back</button>
                    <span id="step-counter" style="color:#888; font-size:0.9rem;">Start</span>
                </div>
                
                <div class="progress-container">
                    <div id="progress-bar-fill" class="progress-fill" style="width: 1%;"></div>
                </div>

                <div id="tree-content">
                    <h2 id="question-text" style="margin-bottom: 25px; font-size: 1.4rem; color: #222; font-weight: 700;">Loading Logic...</h2>
                    <div id="options-container"></div>
                </div>

                <div id="contact-form-container" style="display: none;">
                    <h3 style="margin-top:0;">Strategy Validated</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">We have processed your inputs through 600+ logic nodes. Enter your details to retrieve the blueprint.</p>
                    <form id="contact-form">
                        <input type="text" name="name" placeholder="Your Name" required />
                        <input type="email" name="email" placeholder="Your Email" required />
                        <input type="tel" name="phone" placeholder="Phone Number (Optional)" />
                        <textarea id="message-field" name="message" rows="8" required></textarea>
                        
                        <div class="g-recaptcha" data-sitekey="6Let_E8sAAAAAP948s5QuqjQ-HKYRuoXxLzILZ9p"></div>
                        
                        <button type="submit" id="submit-btn">Retrieve Blueprint</button>
                        <p id="form-status"></p>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<footer>
    <section class="d-flex flex-row justify-content-center" style="width: 100%;">
        <div class="container" style="margin-right: 0px;margin-left: 0px;padding-right: 0px;padding-left: 0px;width: 100%;max-width: 100%;">
            <div class="row" style="margin-right: 0px;margin-left: 0px;max-width: 100%;padding-top: 20px;padding-bottom: 20px;">
                <div class="col" style="width: auto;padding-right: 0px;padding-left: 0px;max-width: 100%;">
                    <div class="text-center" style="text-align:center">
                        <p class="mb-0">Copyright © <span id="currentYear"></span> All Rights Reserved.</p>
                    </div>
                    <script>
                        document.getElementById('currentYear').textContent = new Date().getFullYear();
                    </script>
                </div>
            </div>
        </div>
    </section>
</footer>

<script>
    const canvas = document.getElementById('canvas1');
    const ctx = canvas.getContext('2d');
    const anchor = document.getElementById('particle-anchor');

    const CONFIG = {
        particleSize: 3,           
        returnSpeed: 0.15        
    };

    let particlesArray = [];

    const mouse = {
        x: null,
        y: null,
        radius: 120
    }

    let isTouch = false;

    window.addEventListener('mousemove', function(event){
        if (isTouch) return; 
        mouse.x = event.pageX; 
        mouse.y = event.pageY;
    });
      
    const handleTouch = (event) => {
        isTouch = true;
        if(event.touches.length > 0) {
            mouse.x = event.touches[0].pageX;
            mouse.y = event.touches[0].pageY;
        }
    };

    window.addEventListener('touchstart', handleTouch, {passive: true});
    window.addEventListener('touchmove', handleTouch, {passive: true});

    const clearTouch = () => {
        mouse.x = undefined;
        mouse.y = undefined;
        setTimeout(() => {
            isTouch = false;
        }, 500);
    };

    window.addEventListener('touchend', clearTouch);
    window.addEventListener('touchcancel', clearTouch);
      
    window.addEventListener('mouseout', function(){
        if (!isTouch) {
            mouse.x = undefined;
            mouse.y = undefined;
        }
    });

    class Particle {
        constructor(xOffset, yOffset, color, size){
            this.xOffset = xOffset; 
            this.yOffset = yOffset; 
            this.color = color;
            this.size = size;
            this.density = (Math.random() * 30) + 5;
            this.dx = 0; 
            this.dy = 0; 
        }
        
        draw(anchorX, anchorY){
            let drawX = anchorX + this.xOffset + this.dx;
            let drawY = anchorY + this.yOffset + this.dy;

            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.fillRect(drawX, drawY, this.size, this.size);
            ctx.closePath();
        }
        
        update(anchorX, anchorY){
            let currentX = anchorX + this.xOffset + this.dx;
            let currentY = anchorY + this.yOffset + this.dy;

            let distMouseX = mouse.x - currentX;
            let distMouseY = mouse.y - currentY;
             
            if (mouse.x == null || mouse.y == null) {
                if (Math.abs(this.dx) > 0.1) this.dx -= this.dx * CONFIG.returnSpeed;
                else this.dx = 0;
                
                if (Math.abs(this.dy) > 0.1) this.dy -= this.dy * CONFIG.returnSpeed;
                else this.dy = 0;
                return;
            }

            let distance = Math.sqrt(distMouseX * distMouseX + distMouseY * distMouseY);
             
            if (distance < mouse.radius) {
                let forceDirectionX = distMouseX / distance;
                let forceDirectionY = distMouseY / distance;
                let maxDistance = mouse.radius;
                let force = (maxDistance - distance) / maxDistance;
                let directionX = forceDirectionX * force * this.density;
                let directionY = forceDirectionY * force * this.density;
                
                this.dx -= directionX;
                this.dy -= directionY;
            } else {
                if (Math.abs(this.dx) > 0.1) this.dx -= this.dx * CONFIG.returnSpeed;
                else this.dx = 0;
                if (Math.abs(this.dy) > 0.1) this.dy -= this.dy * CONFIG.returnSpeed;
                else this.dy = 0;
            }
        }
    }

    function init() {
        particlesArray = [];
        
        let isMobile = window.innerWidth < 600;
        let step = isMobile ? 4 : 3; 
        
        let contentWidth = Math.min(window.innerWidth - 40, 600); 
        let fontSize = Math.floor(contentWidth * 0.16);
        
        if (fontSize < 40) fontSize = 40;
        if (fontSize > 180) fontSize = 180;

        CONFIG.particleSize = step;
        
        let anchorTop = anchor.offsetTop; 

        canvas.width = window.innerWidth;
        canvas.style.width = window.innerWidth + 'px';

        let safeHeight = anchorTop + 600; 
        canvas.height = safeHeight;
        canvas.style.height = safeHeight + 'px';

        ctx.font = '900 ' + fontSize + 'px "Arial Black", "Verdana", sans-serif'; 
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        let centerX = canvas.width / 2;
        let centerY = anchorTop + (150 / 2); 
        // Changed text to match the content
        let text = 'Strategy'; 

        let metrics = ctx.measureText(text);
        let textWidth = metrics.width;
        let startX = centerX - (textWidth / 2);
        let endX = centerX + (textWidth / 2);

        let gradient = ctx.createLinearGradient(startX, 0, endX, 0);
        gradient.addColorStop(0, '#4285F4'); 
        gradient.addColorStop(0.5, '#a855f7'); 
        gradient.addColorStop(1, '#ec4899'); 

        ctx.fillStyle = gradient;
        ctx.clearRect(0,0, canvas.width, canvas.height);
        ctx.fillText(text, centerX, centerY);
        
        const textCoordinates = ctx.getImageData(0, 0, canvas.width, canvas.height);
        
        for (let y = 0, y2 = textCoordinates.height; y < y2; y += step){
            for (let x = 0, x2 = textCoordinates.width; x < x2; x += step){
                let index = (y * 4 * textCoordinates.width) + (x * 4);
                
                if (textCoordinates.data[index + 3] > 128){
                    let r = textCoordinates.data[index];
                    let g = textCoordinates.data[index + 1];
                    let b = textCoordinates.data[index + 2];
                    let color = 'rgb(' + r + ',' + g + ',' + b + ')';
                    
                    let xOffset = x - centerX;
                    let yOffset = y - centerY;
                    
                    particlesArray.push(new Particle(xOffset, yOffset, color, CONFIG.particleSize));
                }
            }
        }
        ctx.clearRect(0,0, canvas.width, canvas.height);
        
        if(anchor) anchor.style.height = (fontSize + 60) + "px";
    }

    function animate(){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        let centerX = canvas.width / 2;
        let centerY = anchor.offsetTop + (anchor.offsetHeight / 2);

        for (let i = 0; i < particlesArray.length; i++){
            particlesArray[i].update(centerX, centerY);
            particlesArray[i].draw(centerX, centerY);
        }
        requestAnimationFrame(animate);
    }

    window.addEventListener('load', function() {
        setTimeout(init, 100); 
        animate();
    });

    let lastWidth = window.innerWidth;
    window.addEventListener('resize', function(){
        if (Math.abs(window.innerWidth - lastWidth) > 50) {
            lastWidth = window.innerWidth;
            init();
        }
    });
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let userAnswers = {};

    const tree = {
        // --- 0. ROOT ---
        start: {
            text: "Strategy Engine 7.0 Online. Select Mission Profile.",
            type: 'button',
            options: [
                { label: "Buying Residential", next: "buy_00_exp" },
                { label: "Selling Residential", next: "sell_00_motivation" },
                { label: "Investing", next: "inv_00_type" },
                { label: "Creative Financing", next: "create_00_type" },
                { label: "Commercial / Industrial", next: "comm_00_type" },
                { label: "Raw Land / Development", next: "land_00_type" },
                { label: "ADU Construction", next: "adu_00_type" },
                { label: "Renovation / Forensics", next: "reno_00_start" },
                { label: "Tenant Operations", next: "ten_00_start" },
                { label: "Tax & Wealth Strategy", next: "tax_00_start" },
                { label: "Probate & Inheritance", next: "prob_00_start" },
                { label: "Legal / Distress", next: "law_00_type" }
            ]
        },

        // --- 1. BUYING ---
        buy_00_exp: { text: "Experience Level?", type: 'button', options: [{ label: "First Time Buyer", next: "buy_01_fthb_prep" }, { label: "Repeat Buyer", next: "buy_01_concurrent" }, { label: "Buying for Family", next: "strat_kiddie_condo" }] },
        buy_01_concurrent: { text: "Existing Home?", type: 'button', options: [{ label: "Need to Sell First", next: "strat_bridge_contingency" }, { label: "Keep as Rental", next: "buy_02_rental_calc" }, { label: "Currently Renting", next: "buy_01_fthb_prep" }] },
        buy_02_rental_calc: { text: "Rental Cash Flow?", type: 'button', options: [{ label: "Positive", next: "buy_01_fthb_prep" }, { label: "Negative/Break Even", next: "strat_departing_residence" }] },
        buy_01_fthb_prep: { text: "Financing?", type: 'button', options: [{ label: "Cash", next: "buy_05_timeline" }, { label: "Pre-Approved", next: "buy_05_timeline" }, { label: "Need Loan", next: "buy_02_credit" }] },
        buy_02_credit: { text: "Credit Score?", type: 'button', options: [{ label: "Excellent (740+)", next: "buy_03_downpayment" }, { label: "Good (660-739)", next: "buy_03_downpayment" }, { label: "Fair (580-659)", next: "buy_03_fha_check" }, { label: "Poor (<580)", next: "strat_credit_repair" }] },
        buy_03_fha_check: { text: "Bankruptcy/Foreclosure < 3yrs?", type: 'button', options: [{ label: "Yes", next: "strat_waiting_period" }, { label: "No", next: "strat_fha_manual" }] },
        buy_03_downpayment: { text: "Funds Source?", type: 'button', options: [{ label: "Savings", next: "buy_04_employment" }, { label: "Gift", next: "strat_gift_funds" }, { label: "401k Loan", next: "strat_asset_liquidation" }, { label: "Need Assistance", next: "buy_03_assistance" }] },
        buy_03_assistance: { text: "Category?", type: 'button', options: [{ label: "Veteran", next: "strat_va_no_down" }, { label: "Rural", next: "strat_usda_rural" }, { label: "Standard Buyer", next: "strat_state_grant" }] },
        buy_04_employment: { text: "Income Type?", type: 'button', options: [{ label: "W-2", next: "buy_05_timeline" }, { label: "Self-Employed 2+ Yrs", next: "strat_tax_returns" }, { label: "Self-Employed <2 Yrs", next: "strat_bank_statement_loan" }, { label: "Fixed Income", next: "strat_fixed_income" }] },
        buy_05_timeline: { text: "Timeline?", type: 'select', choices: ["ASAP", "30-60 Days", "3-6 Months", "Browsing"], next: "buy_06_type" },
        buy_06_type: { text: "Property Type?", type: 'button', options: [{ label: "Single Family", next: "buy_07_sfh_pref" }, { label: "Condo", next: "buy_07_condo_check" }, { label: "Multi-Unit", next: "strat_house_hack" }] },
        buy_07_sfh_pref: { text: "Condition?", type: 'button', options: [{ label: "Turnkey", next: "buy_08_location" }, { label: "Cosmetic", next: "buy_08_location" }, { label: "Major Fixer", next: "buy_07_reno_type" }] },
        buy_07_reno_type: { text: "Reno Scale?", type: 'button', options: [{ label: "Cosmetic", next: "strat_203k_limited" }, { label: "Structural", next: "strat_203k_standard" }] },
        buy_07_condo_check: { text: "HOA Priority?", type: 'button', options: [{ label: "Low Fees", next: "strat_low_amenity_condo" }, { label: "High Amenities", next: "strat_high_rise_lifestyle" }] },
        buy_08_location: { text: "Top Priority?", type: 'button', options: [{ label: "Schools", next: "strat_school_boundaries" }, { label: "Commute", next: "strat_commute_radius" }, { label: "Walkability", next: "strat_walk_score" }, { label: "Land", next: "strat_acreage_search" }] },

        // --- 2. SELLING ---
        sell_00_motivation: { text: "Reason?", type: 'button', options: [{ label: "Upsize/Downsize", next: "sell_01_timeline" }, { label: "Relocation", next: "strat_relo_package" }, { label: "Distress", next: "sell_01_distress" }, { label: "Probate", next: "prob_00_start" }] },
        sell_01_distress: { text: "Payment Status?", type: 'button', options: [{ label: "Defaulted", next: "strat_foreclosure_defense" }, { label: "Current", next: "strat_equity_access" }, { label: "Underwater", next: "strat_short_sale" }] },
        sell_01_timeline: { text: "Goal?", type: 'button', options: [{ label: "Max Price", next: "sell_02_condition" }, { label: "Speed", next: "strat_cash_offer" }, { label: "Balanced", next: "sell_02_condition" }] },
        sell_02_condition: { text: "Condition?", type: 'button', options: [{ label: "Excellent", next: "sell_03_updates" }, { label: "Average", next: "sell_03_updates" }, { label: "Poor", next: "sell_02_audit_roof" }] },
        sell_02_audit_roof: { text: "Roof Age?", type: 'button', options: [{ label: "Newer", next: "sell_02_audit_hvac" }, { label: "Old (15+)", next: "strat_roof_cert" }, { label: "Leaking", next: "strat_cash_as_is" }] },
        sell_02_audit_hvac: { text: "HVAC?", type: 'button', options: [{ label: "Working", next: "sell_02_audit_cosmetic" }, { label: "Broken", next: "strat_hvac_credit" }] },
        sell_02_audit_cosmetic: { text: "Kitchen?", type: 'button', options: [{ label: "Modern", next: "sell_03_updates" }, { label: "Dated", next: "strat_facelift_roi" }] },
        sell_03_updates: { text: "Do Repairs?", type: 'button', options: [{ label: "Yes", next: "strat_concierge_prep" }, { label: "No", next: "strat_pricing_strategy_asis" }] },

        // --- 3. INVESTING ---
        inv_00_type: { text: "Strategy?", type: 'button', options: [{ label: "Buy & Hold", next: "inv_01_hold_goal" }, { label: "Flip", next: "inv_01_flip_exp" }, { label: "STR", next: "inv_01_str_regulations" }, { label: "Wholesale", next: "strat_wholesaling" }] },
        inv_01_hold_goal: { text: "Goal?", type: 'button', options: [{ label: "Cash Flow", next: "strat_c_class_rental" }, { label: "Appreciation", next: "strat_a_class_rental" }, { label: "Tax Shelter", next: "strat_cost_segregation" }] },
        inv_01_flip_exp: { text: "Crew?", type: 'button', options: [{ label: "Have Crew", next: "inv_02_sourcing" }, { label: "Need Crew", next: "strat_gc_vetting" }, { label: "DIY", next: "strat_diy_warning" }] },
        inv_02_sourcing: { text: "Source?", type: 'button', options: [{ label: "MLS", next: "strat_speed_offer" }, { label: "Wholesaler", next: "strat_double_close" }, { label: "Direct Mail", next: "strat_yellow_letter" }] },
        inv_01_str_regulations: { text: "Regulations?", type: 'button', options: [{ label: "Allowed", next: "strat_airbnb_arbitrage" }, { label: "Unknown", next: "strat_str_zoning_check" }] },

        // --- 4. CREATIVE FINANCE ---
        create_00_type: { text: "Method?", type: 'button', options: [{ label: "Sub-2", next: "create_sub2" }, { label: "Seller Finance", next: "create_seller_fin" }, { label: "Wrap", next: "create_wrap" }] },
        create_sub2: { text: "Seller Rate?", type: 'button', options: [{ label: "Low (<4%)", next: "strat_sub2_takeover" }, { label: "High", next: "create_seller_fin" }] },
        create_seller_fin: { text: "Mortgage?", type: 'button', options: [{ label: "Free & Clear", next: "strat_pure_seller_finance" }, { label: "Has Debt", next: "strat_hybrid_sub2" }] },
        create_wrap: { text: "Exit?", type: 'button', options: [{ label: "Sell Retail", next: "strat_wrap_sale" }, { label: "Hold", next: "strat_wrap_hold" }] },

        // --- 5. RENOVATION FORENSICS (NEW) ---
        reno_00_start: { text: "Area of Concern?", type: 'button', options: [{ label: "Structure", next: "reno_01_struct" }, { label: "Hazards", next: "reno_01_hazards" }, { label: "Systems", next: "insp_00_start" }] },
        reno_01_struct: { text: "Issue?", type: 'button', options: [{ label: "Load Bearing Wall", next: "strat_load_bearing_beam" }, { label: "Sagging Floor", next: "strat_joist_sistering" }, { label: "Permit History", next: "strat_permit_audit" }] },
        reno_01_hazards: { text: "Hazard?", type: 'button', options: [{ label: "Mold", next: "strat_mold_remediation" }, { label: "Asbestos", next: "strat_asbestos_testing" }, { label: "Lead Paint", next: "strat_lead_encapsulation" }] },

        // --- 6. PROBATE & INHERITANCE (NEW) ---
        prob_00_start: { text: "Legal Status?", type: 'button', options: [{ label: "Letters Issued", next: "prob_01_heirs" }, { label: "No Letters", next: "strat_probate_attorney" }, { label: "Trust", next: "strat_trust_sale" }] },
        prob_01_heirs: { text: "Heir Consensus?", type: 'button', options: [{ label: "All Agree", next: "strat_probate_listing" }, { label: "Disagreement", next: "prob_02_conflict" }] },
        prob_02_conflict: { text: "Conflict Type?", type: 'button', options: [{ label: "Sibling Buyout", next: "strat_sibling_buyout" }, { label: "Will Contest", next: "strat_probate_litigation" }] },

        // --- 7. TAX & WEALTH (NEW) ---
        tax_00_start: { text: "Objective?", type: 'button', options: [{ label: "Defer Capital Gains", next: "tax_01_1031" }, { label: "Tax Free Growth", next: "strat_roth_ira_investing" }, { label: "Depreciation", next: "strat_cost_segregation" }] },
        tax_01_1031: { text: "Timeline?", type: 'button', options: [{ label: "Just Sold", next: "strat_1031_timeline_urgent" }, { label: "Planning to Sell", next: "strat_1031_prep" }] },

        // --- 8. TENANT OPERATIONS (NEW) ---
        ten_00_start: { text: "Issue?", type: 'button', options: [{ label: "Non-Payment", next: "ten_01_pay" }, { label: "Squatter", next: "strat_squatter_removal" }, { label: "Rent Control", next: "strat_rent_control_audit" }] },
        ten_01_pay: { text: "Lease Status?", type: 'button', options: [{ label: "Active", next: "strat_pay_or_quit" }, { label: "Month-to-Month", next: "strat_30_day_notice" }] },

        // --- COMMERCIAL / LAND / ADU / INSPECTION ---
        comm_00_type: { text: "Class?", type: 'button', options: [{ label: "Multi-Family", next: "strat_cap_rate_play" }, { label: "Retail", next: "strat_nnn_lease" }, { label: "Industrial", next: "strat_flex_industrial" }, { label: "Office", next: "strat_office_conversion" }, { label: "Self Storage", next: "strat_self_storage" }] },
        land_00_type: { text: "Plan?", type: 'button', options: [{ label: "Build", next: "strat_construction_permits" }, { label: "Develop", next: "strat_zoning_variance" }, { label: "Rec/Hunt", next: "strat_land_loan" }] },
        adu_00_type: { text: "Type?", type: 'button', options: [{ label: "Garage Conv", next: "strat_garage_conversion" }, { label: "Detached", next: "strat_detached_adu" }, { label: "Attached", next: "strat_attached_adu" }] },
        insp_00_start: { text: "System?", type: 'button', options: [{ label: "Plumbing", next: "insp_01_plumbing" }, { label: "Electrical", next: "insp_01_electrical" }, { label: "Foundation", next: "insp_01_foundation" }, { label: "Roof", next: "insp_01_roof" }] },
        insp_01_plumbing: { text: "Pipes?", type: 'button', options: [{ label: "Copper/PEX", next: "strat_insp_pass" }, { label: "Galvanized", next: "strat_galvanized_risk" }, { label: "Poly", next: "strat_poly_risk" }] },
        insp_01_electrical: { text: "Panel?", type: 'button', options: [{ label: "Modern", next: "strat_insp_pass" }, { label: "Knob&Tube", next: "strat_knob_tube_rewire" }, { label: "FPE/Zinsco", next: "strat_fp_panel_hazard" }] },
        insp_01_foundation: { text: "Cracks?", type: 'button', options: [{ label: "Hairline", next: "strat_monitor_cracks" }, { label: "Horizontal", next: "strat_hydrostatic_pressure" }, { label: "Stair-Step", next: "strat_differential_settlement" }] },
        insp_01_roof: { text: "Issue?", type: 'button', options: [{ label: "Granules", next: "strat_roof_age" }, { label: "Curling", next: "strat_roof_replace_soon" }, { label: "Missing", next: "strat_roof_patch" }] },
        law_00_type: { text: "Issue?", type: 'button', options: [{ label: "Divorce", next: "strat_divorce_valuation" }, { label: "Title", next: "strat_quiet_title" }, { label: "Eviction", next: "strat_cash_for_keys" }] },

        // --- STRATEGIES ---
        strat_kiddie_condo: { text: "Strategy: FHA Kiddie Condo. Co-sign for relative.", options: [] },
        strat_bridge_contingency: { text: "Strategy: Bridge Loan. Use equity to buy first.", options: [] },
        strat_departing_residence: { text: "Strategy: Departure Income. Use 75% future rent to qualify.", options: [] },
        strat_credit_repair: { text: "Strategy: Rapid Rescore. Pay down strategic debts.", options: [] },
        strat_soft_pull_consult: { text: "Strategy: Soft Pull. Check credit without impact.", options: [] },
        strat_waiting_period: { text: "Strategy: Seasoning Wait. 2-4 years post-bankruptcy.", options: [] },
        strat_fha_manual: { text: "Strategy: Manual Underwriting. Use bill payment history.", options: [] },
        strat_gift_funds: { text: "Strategy: Gift Letter. Document funds clearly.", options: [] },
        strat_asset_liquidation: { text: "Strategy: 401k Loan. Borrow from yourself.", options: [] },
        strat_va_no_down: { text: "Strategy: VA Loan. 0% Down based on Residual Income.", options: [] },
        strat_usda_rural: { text: "Strategy: USDA Rural. 0% Down in qualifying areas.", options: [] },
        strat_state_grant: { text: "Strategy: Bond Program. 3-5% Down Assistance.", options: [] },
        strat_tax_returns: { text: "Strategy: 2-Year Avg. Watch deductions.", options: [] },
        strat_bank_statement_loan: { text: "Strategy: Bank Stmt Loan. Use deposits as income.", options: [] },
        strat_fixed_income: { text: "Strategy: Gross Up. Increase non-taxable income by 25%.", options: [] },
        strat_house_hack: { text: "Strategy: Multi-Unit FHA. Rent units to cover mortgage.", options: [] },
        strat_203k_limited: { text: "Strategy: 203k Limited. $35k max for cosmetics.", options: [] },
        strat_203k_standard: { text: "Strategy: 203k Standard. Major structural work.", options: [] },
        strat_low_amenity_condo: { text: "Strategy: Low HOA. Avoid pools/elevators.", options: [] },
        strat_high_rise_lifestyle: { text: "Strategy: Reserve Audit. Check funding levels.", options: [] },
        strat_school_boundaries: { text: "Strategy: Boundary Map. Search by school zone.", options: [] },
        strat_commute_radius: { text: "Strategy: Isochrone. Search by drive time.", options: [] },
        strat_walk_score: { text: "Strategy: TOD. Buy near transit.", options: [] },
        strat_acreage_search: { text: "Strategy: Land Feasibility. Check zoning/utilities.", options: [] },
        strat_agricultural_zoning: { text: "Strategy: Ag Exemption. Lower taxes with livestock.", options: [] },
        strat_relo_package: { text: "Strategy: Relo Rider. Follow employer guidelines.", options: [] },
        strat_foreclosure_defense: { text: "Strategy: Foreclosure Defense. List to pause sale.", options: [] },
        strat_equity_access: { text: "Strategy: HELOC. Access equity before selling.", options: [] },
        strat_short_sale: { text: "Strategy: Short Sale. Negotiate with bank for less.", options: [] },
        strat_probate_listing: { text: "Strategy: Executor Protection. Use As-Is forms.", options: [] },
        strat_probate_attorney: { text: "Strategy: Legal First. Get Letters of Office.", options: [] },
        strat_cash_offer: { text: "Strategy: Investor Blast. Solicit cash bids.", options: [] },
        strat_roof_cert: { text: "Strategy: Roof Cert. 5-year life certification.", options: [] },
        strat_cash_as_is: { text: "Strategy: Cash Only. Unfinanceable condition.", options: [] },
        strat_home_warranty_incentive: { text: "Strategy: Warranty. Buy coverage for buyer.", options: [] },
        strat_hvac_credit: { text: "Strategy: Closing Credit. Offer cash instead of repair.", options: [] },
        strat_facelift_roi: { text: "Strategy: Facelift. Paint/Hardware updates.", options: [] },
        strat_concierge_prep: { text: "Strategy: Concierge. Vendor paid at closing.", options: [] },
        strat_pricing_strategy_asis: { text: "Strategy: Transparent Pricing. Market value minus repairs.", options: [] },
        strat_c_class_rental: { text: "Strategy: Cash Cow. High yield, low appreciation.", options: [] },
        strat_a_class_rental: { text: "Strategy: Appreciation. Top schools, low yield.", options: [] },
        strat_cost_segregation: { text: "Strategy: Cost Seg. Accelerated depreciation.", options: [] },
        strat_section_8_guarantee: { text: "Strategy: Section 8. Guaranteed gov rent.", options: [] },
        strat_gc_vetting: { text: "Strategy: 3 Bids. Check licenses.", options: [] },
        strat_diy_warning: { text: "Strategy: Time Audit. Don't DIY if unskilled.", options: [] },
        strat_speed_offer: { text: "Strategy: Speed Offer. Immediate bid on listing.", options: [] },
        strat_double_close: { text: "Strategy: Double Close. Hide wholesale fee.", options: [] },
        strat_yellow_letter: { text: "Strategy: Direct Mail. Handwritten letters.", options: [] },
        strat_driving_dollars: { text: "Strategy: Driving for Dollars. Spot distress visually.", options: [] },
        strat_airbnb_arbitrage: { text: "Strategy: Data Mine. Check AirDNA stats.", options: [] },
        strat_str_zoning_check: { text: "Strategy: Zoning Check. Verify STR legality.", options: [] },
        strat_wholesaling: { text: "Strategy: Assignment. Sell the contract.", options: [] },
        strat_private_lending: { text: "Strategy: Private Money. Lend at 12%.", options: [] },
        strat_cap_rate_play: { text: "Strategy: Value Add. Raise rents to increase value.", options: [] },
        strat_nnn_lease: { text: "Strategy: NNN. Tenant pays all expenses.", options: [] },
        strat_flex_industrial: { text: "Strategy: Flex Space. Small warehouse units.", options: [] },
        strat_office_conversion: { text: "Strategy: Adaptive Reuse. Convert to residential.", options: [] },
        strat_self_storage: { text: "Strategy: Automation. Kiosk management.", options: [] },
        strat_mhp_investing: { text: "Strategy: Land Lease. Rent the dirt.", options: [] },
        strat_construction_permits: { text: "Strategy: Feasibility. 60-day study period.", options: [] },
        strat_zoning_variance: { text: "Strategy: Subdivide. Split lots.", options: [] },
        strat_land_loan: { text: "Strategy: Land Loan. 50% down or seller finance.", options: [] },
        strat_garage_conversion: { text: "Strategy: JADU. Convert attached garage.", options: [] },
        strat_detached_adu: { text: "Strategy: Prefab ADU. Crane in unit.", options: [] },
        strat_attached_adu: { text: "Strategy: Bump Out. Check setbacks.", options: [] },
        strat_divorce_valuation: { text: "Strategy: Neutral BPO. Valuation for settlement.", options: [] },
        strat_quiet_title: { text: "Strategy: Quiet Title. Clear liens legally.", options: [] },
        strat_cash_for_keys: { text: "Strategy: Cash for Keys. Pay tenant to leave.", options: [] },
        strat_rent_vs_buy: { text: "Strategy: Break Even. 5-year analysis.", options: [] },
        strat_insp_pass: { text: "Strategy: Pass. System is good.", options: [] },
        strat_galvanized_risk: { text: "Strategy: Re-Pipe. Replace steel pipes.", options: [] },
        strat_poly_risk: { text: "Strategy: Replace Poly. Uninsurable pipes.", options: [] },
        strat_knob_tube_rewire: { text: "Strategy: Rewire. Fire hazard removal.", options: [] },
        strat_fp_panel_hazard: { text: "Strategy: Replace Panel. Fire hazard.", options: [] },
        strat_monitor_cracks: { text: "Strategy: Monitor. Minor settling.", options: [] },
        strat_hydrostatic_pressure: { text: "Strategy: Anchors. Wall bowing fix.", options: [] },
        strat_differential_settlement: { text: "Strategy: Piers. Lift sinking foundation.", options: [] },
        strat_roof_replace_soon: { text: "Strategy: Replace Soon. End of life.", options: [] },
        strat_roof_patch: { text: "Strategy: Patch. Repair shingles.", options: [] },
        strat_roof_age: { text: "Strategy: Budget. Roof is aging.", options: [] },
        strat_sub2_takeover: { text: "Strategy: Subject-To. Take over payments.", options: [] },
        strat_pure_seller_finance: { text: "Strategy: Seller Finance. Owner is bank.", options: [] },
        strat_hybrid_sub2: { text: "Strategy: Hybrid Sub2. Sub2 + Equity payments.", options: [] },
        strat_wrap_sale: { text: "Strategy: Wrap. Arbitrage interest rates.", options: [] },
        strat_wrap_hold: { text: "Strategy: Wrap Hold. Arbitrage rent spread.", options: [] },
        strat_load_bearing_beam: { text: "Strategy: LVL Beam. Remove wall, install beam.", options: [] },
        strat_joist_sistering: { text: "Strategy: Sistering. Reinforce sagging floors.", options: [] },
        strat_permit_audit: { text: "Strategy: Permit Audit. Verify legal square footage.", options: [] },
        strat_mold_remediation: { text: "Strategy: Remediation. Professional removal needed.", options: [] },
        strat_asbestos_testing: { text: "Strategy: Abatement. Test before demo.", options: [] },
        strat_lead_encapsulation: { text: "Strategy: Encapsulation. Paint over lead.", options: [] },
        strat_trust_sale: { text: "Strategy: Trustee Sale. Sell via trust terms.", options: [] },
        strat_sibling_buyout: { text: "Strategy: Refi Buyout. One heir keeps home.", options: [] },
        strat_probate_litigation: { text: "Strategy: Litigation. Contest the will.", options: [] },
        strat_roth_ira_investing: { text: "Strategy: Self-Directed IRA. Tax-free profits.", options: [] },
        strat_1031_timeline_urgent: { text: "Strategy: 45-Day ID. Identify replacement NOW.", options: [] },
        strat_1031_prep: { text: "Strategy: QI Setup. Hire Intermediary before sale.", options: [] },
        strat_squatter_removal: { text: "Strategy: Ejectment. Police enforcement.", options: [] },
        strat_rent_control_audit: { text: "Strategy: Rent Control Check. Verify legal rent increases.", options: [] },
        strat_pay_or_quit: { text: "Strategy: Pay or Quit. Serve legal notice.", options: [] },
        strat_30_day_notice: { text: "Strategy: 30 Day Notice. End month-to-month.", options: [] }
    };

    // --- LOGIC ENGINE ---
    let currentNode = 'start';
    let history = []; 
    let pathLabels = []; 

    const elements = {
        question: document.getElementById('question-text'),
        options: document.getElementById('options-container'),
        backBtn: document.getElementById('back-btn'),
        progress: document.getElementById('progress-bar-fill'),
        step: document.getElementById('step-counter'),
        formContainer: document.getElementById('contact-form-container'),
        message: document.getElementById('message-field')
    };

    const initialState = { node: 'start', internalHistory: [], pathLabels: [], answers: {} };
    window.history.replaceState(initialState, "", "");

    window.addEventListener('popstate', (event) => {
        if (event.state) {
            currentNode = event.state.node;
            history = event.state.internalHistory || [];
            pathLabels = event.state.pathLabels || [];
            userAnswers = event.state.answers || {};
            renderNode(false);
        }
    });

    function navigateTo(nextNode, labelToAdd, variableKey, variableValue) {
        if (variableKey) userAnswers[variableKey] = variableValue;
        const newHistory = [...history, currentNode];
        const newLabels = [...pathLabels, labelToAdd];
        window.history.pushState({
            node: nextNode, internalHistory: newHistory, pathLabels: newLabels, answers: {...userAnswers} 
        }, "", "");
        history = newHistory; pathLabels = newLabels; currentNode = nextNode;
        renderNode(false);
    }

    function renderNode(shouldPushState = false) {
        const node = tree[currentNode];
        if(!node) { elements.question.innerText = "Path Complete."; return; }

        elements.question.innerText = node.text;
        elements.question.classList.remove('result-title'); 
        elements.options.innerHTML = '';
        
        const isResult = (node.options && node.options.length === 0);
        const stepCount = history.length + 1;
        
        elements.step.innerText = isResult ? 'Strategy Found' : `Step ${stepCount}`;
        elements.progress.style.width = isResult ? '100%' : Math.min(stepCount * 5, 95) + '%';
        elements.backBtn.style.display = (history.length > 0) ? 'flex' : 'none';

        if (isResult) {
            elements.question.classList.add('result-card');
            elements.question.innerHTML = `<span class="result-title">Strategy Identified:</span> ${node.text}`;
            elements.formContainer.style.display = 'block';
            
            let answersString = "";
            for (const [key, value] of Object.entries(userAnswers)) { answersString += `- ${key}: ${value}\n`; }
            elements.message.value = `Logic Path:\n${pathLabels.join(" > ")}\n\nUser Data:\n${answersString}\n\nRecommended Strategy:\n${node.text}`;
            
            const restartBtn = document.createElement('button');
            restartBtn.innerText = "Start Over";
            restartBtn.className = "tree-option-btn";
            restartBtn.style.textAlign = "center"; restartBtn.style.marginTop = "20px"; restartBtn.style.background = "#fff";
            restartBtn.onclick = () => { 
                history = []; pathLabels = []; userAnswers = {}; currentNode = 'start'; 
                elements.question.classList.remove('result-card'); 
                window.history.pushState(initialState, "", "");
                renderNode(false); 
            };
            elements.options.appendChild(restartBtn);

        } else if (node.type === 'select') {
            elements.formContainer.style.display = 'none';
            elements.question.classList.remove('result-card');
            const select = document.createElement('select'); select.className = "tree-select";
            const defaultOpt = document.createElement('option');
            defaultOpt.text = "Select an option..."; defaultOpt.value = ""; defaultOpt.disabled = true; defaultOpt.selected = true;
            select.add(defaultOpt);
            node.choices.forEach(choice => {
                const opt = document.createElement('option'); opt.value = choice; opt.text = choice; select.add(opt);
            });
            elements.options.appendChild(select);
            const nextBtn = document.createElement('button');
            nextBtn.innerText = "Continue →"; nextBtn.className = "next-btn";
            nextBtn.onclick = () => {
                if(select.value === "") { alert("Please select an option."); return; }
                navigateTo(node.next, select.value, node.variable, select.value);
            };
            elements.options.appendChild(nextBtn);

        } else if (node.type === 'text' || node.type === 'number') {
            elements.formContainer.style.display = 'none';
            elements.question.classList.remove('result-card');
            const input = document.createElement('input');
            input.type = node.type; input.className = "tree-input"; input.placeholder = node.placeholder || "Type your answer...";
            if (node.variable && userAnswers[node.variable]) input.value = userAnswers[node.variable];
            elements.options.appendChild(input);
            const nextBtn = document.createElement('button');
            nextBtn.innerText = "Continue →"; nextBtn.className = "next-btn";
            nextBtn.onclick = () => {
                if(input.value.trim() === "") { alert("Please fill in the field."); return; }
                navigateTo(node.next, `${node.variable}: ${input.value}`, node.variable, input.value);
            };
            elements.options.appendChild(nextBtn);

        } else {
            elements.formContainer.style.display = 'none';
            elements.question.classList.remove('result-card');
            node.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt.label; btn.className = "tree-option-btn";
                btn.onclick = () => { navigateTo(opt.next, opt.label, node.variable, opt.label); };
                elements.options.appendChild(btn);
            });
        }
    }
    
    // BACK BUTTON
    elements.backBtn.onclick = () => { window.history.back(); };
    
    renderNode(false);
});
</script>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyLHWsaJvRo4CPVU1f1umMXBT4Tazy3s1vUTMTTrOv0AVLjw4xs0pEkj5TpocbJdnyMJw/exec";
    const form = document.getElementById('contact-form');
    const statusMsg = document.getElementById('form-status');
    const btn = document.getElementById('submit-btn');

    function isValidEmail(email) { const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; return regex.test(email); }

    if (form) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault(); statusMsg.innerText = "";
            const formData = new FormData(form);
            const email = formData.get('email');
            if (!isValidEmail(email)) { statusMsg.innerText = "Please enter a valid email address."; statusMsg.style.color = "#dc2626"; return; }
            const captchaResponse = grecaptcha.getResponse();
            if (!captchaResponse || captchaResponse.length === 0) { statusMsg.innerText = "Please verify you are human."; statusMsg.style.color = "#dc2626"; return; }

            btn.disabled = true; btn.innerText = "Processing...";
            const data = { name: formData.get('name'), email: email, phone: formData.get('phone'), message: formData.get('message'), captchaToken: captchaResponse };
            const controller = new AbortController(); const timeoutId = setTimeout(() => controller.abort(), 10000);

            try {
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data), signal: controller.signal });
                clearTimeout(timeoutId);
                statusMsg.innerText = "Success. Strategy blueprint sent."; statusMsg.style.color = "#16a34a";
                form.reset(); grecaptcha.reset(); 
            } catch (error) {
                console.error('Error:', error);
                if (error.name === 'AbortError') statusMsg.innerText = "Request timed out."; else statusMsg.innerText = "Submission error. Try again.";
                statusMsg.style.color = "#dc2626";
            } finally { btn.disabled = false; btn.innerText = "Retrieve Blueprint"; }
        });
    }
</script>
<script src="js/github-update.js"></script>
</body>
</html>
