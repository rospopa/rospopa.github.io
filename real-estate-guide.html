<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Infinity Strategy Engine</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Real Estate Strategy Engine">
    
    <link rel="canonical" href="http://rospopa.github.io/">
    <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/css/favicons/unnamed-180x180.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/css/favicons/unnamed-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/css/favicons/unnamed-32x32.png">
    <link rel="icon" type="image/png" sizes="180x180" href="/css/favicons/unnamed-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/css/favicons/unnamed-192x192.png">
    <link rel="icon" type="image/png" sizes="231x231" href="/css/favicons/unnamed-231x231.png">
    
    <link rel="stylesheet" href="css/format.css">
    
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <style>
        /* --- CORE / RESET --- */
        body {
            -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            background-color: #f8f9fa; margin: 0; color: #333;
        }
        input, textarea, select { -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; }

        /* --- VISUALS --- */
        #canvas1 { position: absolute; top: 0; left: 0; width: 100%; z-index: 99; pointer-events: none; image-rendering: pixelated; }

        /* --- CONTAINER --- */
        #real-estate-guide-container {
            margin: 40px auto; padding: 40px; border: 0; border-radius: 16px;
            background-color: #ffffff; box-shadow: 0 10px 40px rgba(0,0,0,0.08); 
            position: relative; z-index: 101; max-width: 800px;
        }
        
        /* --- UI ELEMENTS --- */
        .tree-option-btn {
            padding: 16px 20px; background-color: #fff; color: #2c3e50; border: 1px solid #e2e8f0;
            border-radius: 12px; cursor: pointer; font-size: 1rem; text-align: left;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1); font-weight: 500; width: 100%; margin-bottom: 10px; display: block;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .tree-option-btn:hover { 
            border-color: #4285F4; color: #4285F4; transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.15); 
        }
        
        .tree-input, .tree-select {
            width: 100%; padding: 14px; margin-bottom: 20px; border: 2px solid #e2e8f0;
            border-radius: 10px; font-size: 1rem; box-sizing: border-box; transition: 0.2s;
        }
        .tree-input:focus, .tree-select:focus { border-color: #4285F4; outline: none; box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1); }
        
        .next-btn {
            background: linear-gradient(135deg, #4285F4, #2b6cb0); color: white; border: none; padding: 14px 28px;
            border-radius: 10px; cursor: pointer; font-weight: 600; width: 100%; font-size: 1.05rem; letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3); transition: 0.2s;
        }
        .next-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(66, 133, 244, 0.4); }

        .result-card { 
            background: #eff6ff; border-left: 5px solid #4285F4; padding: 30px; 
            border-radius: 12px; color: #1e3a8a; line-height: 1.6; margin-bottom: 30px; 
        }
        .result-title { font-weight: 700; font-size: 1.2rem; display: block; margin-bottom: 10px; color: #1e40af; }

        /* --- CONTACT FORM --- */
        #contact-form-container { margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
        #contact-form { display: flex; flex-direction: column; gap: 15px; }
        #contact-form input, #contact-form textarea { 
            padding: 14px; border: 1px solid #cbd5e1; border-radius: 8px; width: 100%; box-sizing: border-box; font-family: inherit;
        }
        #contact-form button { 
            padding: 14px 28px; background-color: #1f2937; color: white; border: none; border-radius: 8px; cursor: pointer; align-self: flex-start; font-weight: 600; 
        }
        #contact-form button:hover { background-color: #000; }
        
        .progress-container { width: 100%; height: 6px; background: #f1f5f9; border-radius: 10px; margin: 20px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4285F4, #8b5cf6); transition: width 0.4s ease; }

        #form-status { margin-top: 15px; font-weight: 500; font-size: 0.95rem; }
        .g-recaptcha { margin-bottom: 10px; }
        
        /* Header/Footer Minimal */
        .site-header { background: #fff; padding: 15px 0; border-bottom: 1px solid #f0f0f0; position: relative; z-index: 100; }
        .site-header .wrap { max-width: 1000px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .site-title { font-weight: 800; color: #1a202c; font-size: 1.3rem; letter-spacing: -0.5px; }
        footer { background: #fff; padding: 40px 0; margin-top: 60px; border-top: 1px solid #f0f0f0; position: relative; z-index: 100; color: #64748b; }
    </style>
</head>
     
<body>
<script>
    // Security Prevention
    document.addEventListener('contextmenu', event => event.preventDefault());
    document.addEventListener('dragstart', event => event.preventDefault());
</script>

<canvas id="canvas1"></canvas>

<header class="site-header">
    <div class="wrap">
        <a class="site-title" style="text-decoration: none;" href="https://rospopa.com">Pavlo Rospopa</a>
        <nav class="site-nav">
            <a style="text-decoration: none; font-weight: 600; color: #4285F4;" href="/login">Client Login</a>
        </nav>
    </div>
</header>

<main>
    <div class="page-content">
        <div class="wrap" style="max-width: 1000px; margin: 0 auto; padding: 0 20px;">
            
            <div id="particle-anchor" style="width: 100%; height: 140px; margin-top: 30px; margin-bottom: 10px;"></div>

            <div id="real-estate-guide-container">
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <button id="back-btn" style="background:none; border:none; color:#64748b; cursor:pointer; font-weight:600; font-size: 0.9rem; display:none; padding: 5px 0;">&larr; Previous</button>
                    <span id="step-counter" style="color:#94a3b8; font-size:0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Start</span>
                </div>
                
                <div class="progress-container">
                    <div id="progress-bar-fill" class="progress-fill" style="width: 1%;"></div>
                </div>

                <div id="tree-content">
                    <h2 id="question-text" style="margin-bottom: 30px; font-size: 1.5rem; color: #1e293b; font-weight: 800; line-height: 1.3;">Initializing Engine...</h2>
                    <div id="options-container"></div>
                </div>

                <div id="contact-form-container" style="display: none;">
                    <h3 style="margin-top:0; color: #111;">Execute Strategy</h3>
                    <p style="font-size: 0.95rem; color: #666; margin-bottom: 20px; line-height: 1.5;">We have identified the optimal path based on your inputs. Enter your details to receive the full execution plan.</p>
                    <form id="contact-form">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <input type="text" name="name" placeholder="Full Name" required />
                            <input type="email" name="email" placeholder="Email Address" required />
                        </div>
                        <input type="tel" name="phone" placeholder="Phone Number (Optional - for faster response)" />
                        <textarea id="message-field" name="message" rows="5" required></textarea>
                        
                        <div class="g-recaptcha" data-sitekey="6Let_E8sAAAAAP948s5QuqjQ-HKYRuoXxLzILZ9p"></div>
                        
                        <button type="submit" id="submit-btn">Unlock Strategy</button>
                        <p id="form-status"></p>
                    </form>
                </div>
            </div>
            </div>
    </div>
</main>

<footer>
    <section class="d-flex flex-row justify-content-center" style="width: 100%;">
        <div class="container" style="text-align: center;">
             <p class="mb-0">&copy; <span id="currentYear"></span> Pavlo Rospopa. All Rights Reserved.</p>
        </div>
    </section>
</footer>

<script>
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    const canvas = document.getElementById('canvas1');
    const ctx = canvas.getContext('2d');
    const anchor = document.getElementById('particle-anchor');

    const CONFIG = { particleSize: 3, returnSpeed: 0.12 };
    let particlesArray = [];
    const mouse = { x: null, y: null, radius: 100 }
    let isTouch = false;

    window.addEventListener('mousemove', function(event){
        if (isTouch) return; 
        mouse.x = event.pageX; mouse.y = event.pageY;
    });
      
    const handleTouch = (event) => {
        isTouch = true;
        if(event.touches.length > 0) {
            mouse.x = event.touches[0].pageX; mouse.y = event.touches[0].pageY;
        }
    };
    window.addEventListener('touchstart', handleTouch, {passive: true});
    window.addEventListener('touchmove', handleTouch, {passive: true});
    const clearTouch = () => { mouse.x = undefined; mouse.y = undefined; setTimeout(() => { isTouch = false; }, 500); };
    window.addEventListener('touchend', clearTouch);
    window.addEventListener('touchcancel', clearTouch);
    window.addEventListener('mouseout', function(){ if (!isTouch) { mouse.x = undefined; mouse.y = undefined; } });

    class Particle {
        constructor(xOffset, yOffset, color, size){
            this.xOffset = xOffset; this.yOffset = yOffset; 
            this.color = color; this.size = size;
            this.density = (Math.random() * 30) + 5;
            this.dx = 0; this.dy = 0; 
        }
        draw(anchorX, anchorY){
            let drawX = anchorX + this.xOffset + this.dx;
            let drawY = anchorY + this.yOffset + this.dy;
            ctx.fillStyle = this.color;
            ctx.beginPath(); ctx.fillRect(drawX, drawY, this.size, this.size); ctx.closePath();
        }
        update(anchorX, anchorY){
            let currentX = anchorX + this.xOffset + this.dx;
            let currentY = anchorY + this.yOffset + this.dy;
            let distMouseX = mouse.x - currentX;
            let distMouseY = mouse.y - currentY;
            
            if (mouse.x == null || mouse.y == null) {
                if (Math.abs(this.dx) > 0.1) this.dx -= this.dx * CONFIG.returnSpeed; else this.dx = 0;
                if (Math.abs(this.dy) > 0.1) this.dy -= this.dy * CONFIG.returnSpeed; else this.dy = 0;
                return;
            }
            let distance = Math.sqrt(distMouseX * distMouseX + distMouseY * distMouseY);
            if (distance < mouse.radius) {
                let force = (mouse.radius - distance) / mouse.radius;
                let directionX = (distMouseX / distance) * force * this.density;
                let directionY = (distMouseY / distance) * force * this.density;
                this.dx -= directionX; this.dy -= directionY;
            } else {
                if (Math.abs(this.dx) > 0.1) this.dx -= this.dx * CONFIG.returnSpeed; else this.dx = 0;
                if (Math.abs(this.dy) > 0.1) this.dy -= this.dy * CONFIG.returnSpeed; else this.dy = 0;
            }
        }
    }

    function init() {
        particlesArray = [];
        let isMobile = window.innerWidth < 600;
        let step = isMobile ? 4 : 3; 
        let contentWidth = Math.min(window.innerWidth - 40, 600); 
        let fontSize = Math.floor(contentWidth * 0.16);
        if (fontSize < 40) fontSize = 40; if (fontSize > 160) fontSize = 160;
        CONFIG.particleSize = step;
        
        let anchorTop = anchor.offsetTop; 
        canvas.width = window.innerWidth; canvas.style.width = window.innerWidth + 'px';
        let safeHeight = anchorTop + 400; 
        canvas.height = safeHeight; canvas.style.height = safeHeight + 'px';

        ctx.font = '900 ' + fontSize + 'px "Arial Black", "Verdana", sans-serif'; 
        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
        
        let centerX = canvas.width / 2;
        let centerY = anchorTop + (140 / 2); 
        let text = 'Strategy'; 
        let metrics = ctx.measureText(text);
        let startX = centerX - (metrics.width / 2); let endX = centerX + (metrics.width / 2);
        let gradient = ctx.createLinearGradient(startX, 0, endX, 0);
        gradient.addColorStop(0, '#2563eb'); gradient.addColorStop(0.5, '#7c3aed'); gradient.addColorStop(1, '#db2777'); 

        ctx.fillStyle = gradient; ctx.clearRect(0,0, canvas.width, canvas.height); ctx.fillText(text, centerX, centerY);
        const textCoordinates = ctx.getImageData(0, 0, canvas.width, canvas.height);
        
        for (let y = 0; y < textCoordinates.height; y += step){
            for (let x = 0; x < textCoordinates.width; x += step){
                let index = (y * 4 * textCoordinates.width) + (x * 4);
                if (textCoordinates.data[index + 3] > 128){
                    let r = textCoordinates.data[index]; let g = textCoordinates.data[index + 1]; let b = textCoordinates.data[index + 2];
                    let xOffset = x - centerX; let yOffset = y - centerY;
                    particlesArray.push(new Particle(xOffset, yOffset, 'rgb('+r+','+g+','+b+')', CONFIG.particleSize));
                }
            }
        }
        ctx.clearRect(0,0, canvas.width, canvas.height);
    }

    function animate(){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let centerX = canvas.width / 2;
        let centerY = anchor.offsetTop + (anchor.offsetHeight / 2);
        for (let i = 0; i < particlesArray.length; i++){
            particlesArray[i].update(centerX, centerY); particlesArray[i].draw(centerX, centerY);
        }
        requestAnimationFrame(animate);
    }
    window.addEventListener('load', function() { setTimeout(init, 100); animate(); });
    let lastWidth = window.innerWidth;
    window.addEventListener('resize', function(){ if (Math.abs(window.innerWidth - lastWidth) > 50) { lastWidth = window.innerWidth; init(); } });
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let userAnswers = {};

    const tree = {
        // ==========================================
        // ROOT
        // ==========================================
        start: {
            text: "Welcome to the Strategy Engine. How can we help you today?",
            type: 'button',
            options: [
                { label: "I want to BUY a property", next: "buy_experience_check" },
                { label: "I want to SELL a property", next: "sell_motivation" },
                { label: "I want to INVEST (Build Wealth)", next: "invest_goal" },
                { label: "I'm just exploring / Not sure yet", next: "explore_path" },
                { label: "I have a complex situation (Legal/Divorce)", next: "complex_triage" }
            ]
        },

        // ==========================================
        // BRANCH 1: BUYING (Refined)
        // ==========================================
        buy_experience_check: {
            text: "Have you purchased real estate before?",
            type: 'button',
            options: [
                { label: "No, I'm a First-Time Buyer", next: "buy_finance_check" },
                { label: "Yes, I'm an experienced buyer", next: "buy_contingency_check" }
            ]
        },
        buy_contingency_check: {
            text: "Do you need to sell your current home to buy the new one?",
            type: 'button',
            variable: 'Contingency',
            options: [
                { label: "Yes, I need to sell first", next: "strat_buy_sell_bridge" },
                { label: "No, I can buy without selling", next: "buy_finance_check" },
                { label: "I'm not sure if I qualify for both", next: "strat_lender_analysis" }
            ]
        },
        buy_finance_check: {
            text: "What is your current financing status?",
            type: 'button',
            variable: 'Financing Status',
            options: [
                { label: "Cash Buyer (Proof of Funds ready)", next: "buy_timeline" },
                { label: "Pre-Approved (Letter in hand)", next: "buy_timeline" },
                { label: "Just starting / Haven't spoken to lender", next: "buy_credit_self_assess" },
                { label: "I don't know my budget yet", next: "strat_affordability_calc" }
            ]
        },
        buy_credit_self_assess: {
            text: "How would you rate your credit?",
            type: 'button',
            variable: 'Self-Credit',
            options: [
                { label: "Excellent (720+)", next: "buy_timeline" },
                { label: "Fair (620-719)", next: "buy_timeline" },
                { label: "Challenged (<620)", next: "strat_credit_repair_first" },
                { label: "I honestly don't know", next: "strat_soft_pull_consult" }
            ]
        },
        buy_timeline: {
            text: "When are you hoping to move in?",
            type: 'select',
            variable: 'Timeline',
            choices: ["ASAP (Urgent)", "30-60 Days", "3-6 Months", "6-12 Months", "Just casually looking"],
            next: "buy_property_type"
        },
        buy_property_type: {
            text: "What type of property are you looking for?",
            type: 'button',
            variable: 'Property Type',
            options: [
                { label: "Single Family House", next: "buy_sfh_maintenance" },
                { label: "Condo / Townhome (Low Maintenance)", next: "buy_condo_details" },
                { label: "Multi-Unit (Live in one, rent others)", next: "strat_house_hacking" },
                { label: "I'm undecided / Open to both", next: "buy_lifestyle_check" }
            ]
        },
        // --- SFH Sub-Branch ---
        buy_sfh_maintenance: {
            text: "How do you feel about renovations?",
            type: 'button',
            variable: 'Reno Tolerance',
            options: [
                { label: "Turnkey only (Move-in Ready)", next: "buy_location_input" },
                { label: "Cosmetic work is okay (Paint/Floors)", next: "buy_location_input" },
                { label: "I want a Fixer-Upper (Sweat Equity)", next: "strat_reno_loan" },
                { label: "I don't know / Depends on price", next: "strat_value_vs_condition" }
            ]
        },
        // --- Condo Sub-Branch ---
        buy_condo_details: {
            text: "Are you familiar with HOA fees and rules?",
            type: 'button',
            options: [
                { label: "Yes, I understand them", next: "buy_location_input" },
                { label: "No, explain how they work", next: "strat_hoa_education" }
            ]
        },
        // --- Undecided Sub-Branch ---
        buy_lifestyle_check: {
            text: "What matters more to you right now?",
            type: 'button',
            options: [
                { label: "Privacy and Yard Space", next: "strat_sfh_search" },
                { label: "Convenience and Location", next: "strat_condo_search" },
                { label: "I need to see both to decide", next: "strat_hybrid_tour" }
            ]
        },
        
        buy_location_input: {
            text: "Do you have a specific neighborhood in mind?",
            type: 'text',
            variable: 'Target Area',
            placeholder: "e.g. Downtown, School District 203, Near Work...",
            next: "buy_final_check"
        },
        buy_final_check: {
            text: "Any absolute deal-breakers?",
            type: 'button',
            options: [
                { label: "Must have specific school district", next: "strat_school_zone_targeting" },
                { label: "Commute time is #1 priority", next: "strat_commute_analysis" },
                { label: "Need a bedroom on main floor", next: "strat_accessibility_search" },
                { label: "No major deal breakers", next: "strat_vip_buyer_consult" }
            ]
        },

        // ==========================================
        // BRANCH 2: SELLING (Refined)
        // ==========================================
        sell_motivation: {
            text: "What is driving your decision to sell?",
            type: 'button',
            variable: 'Motivation',
            options: [
                { label: "Upsizing / Downsizing", next: "sell_timeline_vs_price" },
                { label: "Relocating out of area", next: "sell_timeline_vs_price" },
                { label: "Financial Distress / Too expensive", next: "strat_confidential_distress" },
                { label: "Inherited Property / Probate", next: "sell_probate_check" },
                { label: "Just curious about value", next: "strat_cma_valuation" }
            ]
        },
        sell_timeline_vs_price: {
            text: "The Golden Trade-off: Which is more important?",
            type: 'button',
            variable: 'Priority',
            options: [
                { label: "Maximum Price (I can wait)", next: "sell_condition_honest" },
                { label: "Speed / Convenience (Sell fast)", next: "strat_express_sale" },
                { label: "A balance of both", next: "sell_condition_honest" }
            ]
        },
        sell_condition_honest: {
            text: "How would you rate your home's condition?",
            type: 'button',
            variable: 'Condition',
            options: [
                { label: "Showroom Ready (Updates < 5 yrs)", next: "strat_luxury_marketing" },
                { label: "Good, but dated (Liveable)", next: "sell_prep_willingness" },
                { label: "Needs significant repairs", next: "sell_repair_ability" },
                { label: "I have no idea / Need opinion", next: "strat_pre_listing_inspection" }
            ]
        },
        sell_prep_willingness: {
            text: "Are you willing to paint or stage before listing?",
            type: 'button',
            options: [
                { label: "Yes, I'll do what it takes", next: "strat_concierge_prep" },
                { label: "No, sell it 'As-Is'", next: "strat_as_is_pricing" },
                { label: "What would give me the best ROI?", next: "strat_roi_consult" }
            ]
        },
        sell_repair_ability: {
            text: "Do you have funds to fix it up before selling?",
            type: 'button',
            options: [
                { label: "Yes, I can invest in repairs", next: "strat_flip_yourself" },
                { label: "No, I need to sell strictly As-Is", next: "strat_investor_network" }
            ]
        },
        sell_probate_check: {
            text: "Do you have the legal authority (Letters of Office)?",
            type: 'button',
            options: [
                { label: "Yes, I am the Executor", next: "strat_probate_market" },
                { label: "No, process hasn't started", next: "strat_probate_attorney" },
                { label: "I don't know what that is", next: "strat_probate_education" }
            ]
        },

        // ==========================================
        // BRANCH 3: INVESTING (Refined)
        // ==========================================
        invest_goal: {
            text: "What is your primary investment goal?",
            type: 'button',
            variable: 'Invest Goal',
            options: [
                { label: "Monthly Cash Flow (Income)", next: "invest_involvement" },
                { label: "Long Term Appreciation (Growth)", next: "strat_appreciation_play" },
                { label: "Quick Profit (Flip)", next: "strat_fix_flip_analysis" },
                { label: "Tax Benefits / Write-offs", next: "strat_tax_deferral" }
            ]
        },
        invest_involvement: {
            text: "How involved do you want to be?",
            type: 'button',
            variable: 'Involvement',
            options: [
                { label: "Active (I'll manage tenants/repairs)", next: "strat_house_hacking" },
                { label: "Semi-Active (I'll manage manager)", next: "strat_turnkey_rental" },
                { label: "Passive (Hands off)", next: "strat_syndication_referral" },
                { label: "I don't know the difference", next: "strat_investor_education" }
            ]
        },

        // ==========================================
        // BRANCH 4: EXPLORATION / UNKNOWN
        // ==========================================
        explore_path: {
            text: "That's okay! What topic interests you most?",
            type: 'button',
            options: [
                { label: "Can I afford to buy?", next: "strat_affordability_calc" },
                { label: "What is my home worth?", next: "strat_cma_valuation" },
                { label: "Is now a good time to act?", next: "strat_market_report" },
                { label: "Rent vs. Buy Analysis", next: "strat_rent_vs_buy" }
            ]
        },
        complex_triage: {
            text: "What is the nature of the situation?",
            type: 'button',
            options: [
                { label: "Divorce / Separation", next: "strat_divorce_neutral" },
                { label: "Bankruptcy / Foreclosure", next: "strat_short_sale_help" },
                { label: "Estate / Trust Sale", next: "strat_trust_sale" }
            ]
        },

        // ==========================================
        // STRATEGY END POINTS (The "Result" Nodes)
        // ==========================================
        
        // Buyers
        strat_lender_analysis: { text: "Strategy: Dual-Track Analysis. We need to have a lender run two scenarios: one where you sell first, and one where you keep the home. This determines your leverage.", options: [] },
        strat_buy_sell_bridge: { text: "Strategy: The Bridge or Contingency. We will aim for a 'Close-Concurrent' strategy where you close on the sale in the morning and the purchase in the afternoon. Alternatively, we explore Bridge Loans.", options: [] },
        strat_affordability_calc: { text: "Strategy: Purchase Power Audit. Before looking at homes, we will do a reverse-engineering of your finances to find a monthly payment you are comfortable with, then determine the price.", options: [] },
        strat_credit_repair_first: { text: "Strategy: Credit Restoration Plan. Buying now might mean a high rate. We'll connect you with a credit specialist to boost your score for 3-6 months, potentially saving you thousands.", options: [] },
        strat_soft_pull_consult: { text: "Strategy: Soft-Pull Consultation. We can have a lender do a 'Soft Pull' that doesn't hurt your credit, just to give us a baseline of where you stand.", options: [] },
        strat_house_hacking: { text: "Strategy: House Hacking. You buy a 2-4 unit building with an FHA loan (3.5% down), live in one unit, and let the tenants pay your mortgage.", options: [] },
        strat_reno_loan: { text: "Strategy: FHA 203k / Reno Loan. We find a home with 'bones' in a great area, and wrap the renovation costs into your mortgage with a single closing.", options: [] },
        strat_value_vs_condition: { text: "Strategy: The 5-House Test. We will tour 3 turnkey homes and 2 fixer-uppers in the same price range. You will know instantly which trade-off you prefer.", options: [] },
        strat_hoa_education: { text: "Strategy: HOA Deep Dive. We need to review 'Reserves' and 'Bylaws'. A low HOA fee might mean a special assessment is coming. We will audit the condo docs before you buy.", options: [] },
        strat_sfh_search: { text: "Strategy: Single Family Focus. We prioritize lot size and zoning privacy. We'll check for easements and future development plans near the property.", options: [] },
        strat_condo_search: { text: "Strategy: Lifestyle Condo Search. We focus on amenities, reserve funds, and rental restrictions (in case you want to rent it out later).", options: [] },
        strat_hybrid_tour: { text: "Strategy: The Hybrid Tour. We dedicate one afternoon to seeing the best Condo vs. the best House at the same price point to crystallize your decision.", options: [] },
        strat_school_zone_targeting: { text: "Strategy: School Zone Targeting. We search strictly by school district boundaries, not just zip codes, to ensure resale value protection.", options: [] },
        strat_vip_buyer_consult: { text: "Strategy: VIP Buyer Consultation. Since you are flexible, we can hunt for off-market deals and 'Coming Soon' listings that match your broad criteria.", options: [] },
        strat_commute_analysis: { text: "Strategy: Commute Radius Search. We map your drive time during rush hour and only look at homes within that specific time-radius.", options: [] },
        strat_accessibility_search: { text: "Strategy: Universal Design Search. We filter specifically for ranches, elevators, or wide-doorway properties to ensure long-term comfort.", options: [] },

        // Sellers
        strat_confidential_distress: { text: "Strategy: Confidential Solvency Review. We privately analyze if there is equity. If yes, we sell fast. If no, we negotiate with the bank (Short Sale).", options: [] },
        strat_cma_valuation: { text: "Strategy: Comprehensive Market Analysis (CMA). An algorithm isn't enough. I will manually adjust for your specific upgrades and view to give you a real price range.", options: [] },
        strat_express_sale: { text: "Strategy: Investor Express. We solicit cash offers from our investor network. You get speed and no repairs, but sell at a wholesale discount.", options: [] },
        strat_luxury_marketing: { text: "Strategy: Luxury Lifestyle Launch. Professional video, drone footage, twilight photography, and international syndication to attract emotional buyers.", options: [] },
        strat_pre_listing_inspection: { text: "Strategy: Pre-Listing Inspection. We spend a few hundred dollars now to inspect the home ourselves. This prevents buyers from negotiating huge price drops later.", options: [] },
        strat_concierge_prep: { text: "Strategy: Concierge Service. We manage the contractors for paint/staging. The cost is often paid at closing, maximizing your sale price with zero upfront hassle.", options: [] },
        strat_as_is_pricing: { text: "Strategy: Strategic 'As-Is' Pricing. We price slightly below market to create a bidding war, letting the market dictate the final value despite conditions.", options: [] },
        strat_roi_consult: { text: "Strategy: ROI Walkthrough. I walk your home and tell you exactly what NOT to fix. Usually, cleaning and painting return 300%, while full remodels lose money.", options: [] },
        strat_flip_yourself: { text: "Strategy: The 'Flip-Yourself' Sale. You act as the developer. We identify the top 3 upgrades that maximize value, you execute them, and we sell for top dollar.", options: [] },
        strat_investor_network: { text: "Strategy: Off-Market Investor Blast. We send your property details to our private list of cash buyers who buy 'ugly' houses.", options: [] },
        strat_probate_market: { text: "Strategy: Probate Market Sale. We list the home while adhering to court timelines, ensuring the estate gets fair market value.", options: [] },
        strat_probate_attorney: { text: "Strategy: Legal Referral. You cannot sell yet. We connect you with a probate attorney to get 'Letters of Office' so we can legally list the home.", options: [] },
        strat_probate_education: { text: "Strategy: Estate Planning 101. We need to sit down and determine if the property is in a Trust or if it must go through Probate Court.", options: [] },

        // Investors / Other
        strat_appreciation_play: { text: "Strategy: Path of Progress. We buy in 'B' neighborhoods that are becoming 'A' neighborhoods. Cash flow might be low now, but equity explodes in 5-10 years.", options: [] },
        strat_fix_flip_analysis: { text: "Strategy: 70% Rule Analysis. We analyze deals based on After Repair Value (ARV). If the purchase price + repairs > 70% of ARV, we pass.", options: [] },
        strat_tax_deferral: { text: "Strategy: 1031 Exchange. We look for a property to buy so you can roll your profits from a previous sale into this one, deferring all capital gains taxes.", options: [] },
        strat_turnkey_rental: { text: "Strategy: Turnkey Investing. We identify properties that are already renovated and tenanted. You buy the cash flow stream immediately.", options: [] },
        strat_syndication_referral: { text: "Strategy: Real Estate Syndication. You pool your money with others to buy a large apartment complex. You get checks, but make no decisions.", options: [] },
        strat_investor_education: { text: "Strategy: Investor Discovery Session. We need to define your 'Why'. Are you looking to quit your job (Cash Flow) or build retirement wealth (Equity)?", options: [] },
        strat_market_report: { text: "Strategy: Micro-Market Report. Real estate is local. We will pull data specifically for your zip code to see if it's a Buyer's or Seller's market right now.", options: [] },
        strat_rent_vs_buy: { text: "Strategy: Rent vs. Buy Calculator. We compare your current rent with a mortgage payment, factoring in tax benefits and equity buildup over 5 years.", options: [] },
        strat_divorce_neutral: { text: "Strategy: Neutral Valuation. I act as an unbiased third party to determine fair market value, helping both sides agree on a buyout or listing price.", options: [] },
        strat_short_sale_help: { text: "Strategy: Short Sale Negotiation. We list the home and negotiate with your bank to accept less than the mortgage balance, saving you from foreclosure on your record.", options: [] },
        strat_trust_sale: { text: "Strategy: Trustee Sale. We work with the Successor Trustee to sell the asset and distribute funds to beneficiaries according to the trust.", options: [] }
    };

    // --- STATE MANAGEMENT ---
    let currentNode = 'start';
    let history = []; 
    let pathLabels = []; 

    const elements = {
        question: document.getElementById('question-text'),
        options: document.getElementById('options-container'),
        backBtn: document.getElementById('back-btn'),
        progress: document.getElementById('progress-bar-fill'),
        step: document.getElementById('step-counter'),
        formContainer: document.getElementById('contact-form-container'),
        message: document.getElementById('message-field')
    };

    const initialState = { node: 'start', internalHistory: [], pathLabels: [], answers: {} };
    window.history.replaceState(initialState, "", "");

    window.addEventListener('popstate', (event) => {
        if (event.state) {
            currentNode = event.state.node;
            history = event.state.internalHistory || [];
            pathLabels = event.state.pathLabels || [];
            userAnswers = event.state.answers || {};
            renderNode(false);
        }
    });

    function navigateTo(nextNode, labelToAdd, variableKey, variableValue) {
        if (variableKey) userAnswers[variableKey] = variableValue;
        const newHistory = [...history, currentNode];
        const newLabels = [...pathLabels, labelToAdd];
        window.history.pushState({
            node: nextNode, internalHistory: newHistory, pathLabels: newLabels, answers: {...userAnswers} 
        }, "", "");
        history = newHistory; pathLabels = newLabels; currentNode = nextNode;
        renderNode(false);
    }

    function renderNode(shouldPushState = false) {
        const node = tree[currentNode];
        if(!node) { elements.question.innerText = "Error: Logic path end reached."; return; }

        elements.question.innerText = node.text;
        elements.question.classList.remove('result-title'); 
        elements.options.innerHTML = '';
        
        const isResult = (node.options && node.options.length === 0);
        const stepCount = history.length + 1;
        
        elements.step.innerText = isResult ? 'Strategy Identified' : `Step ${stepCount}`;
        elements.progress.style.width = isResult ? '100%' : Math.min(stepCount * 12, 95) + '%';
        elements.backBtn.style.display = (history.length > 0) ? 'block' : 'none';

        if (isResult) {
            elements.question.classList.add('result-card');
            elements.question.innerHTML = `<span class="result-title">Recommendation:</span> ${node.text}`;
            elements.formContainer.style.display = 'block';
            
            let answersString = "";
            for (const [key, value] of Object.entries(userAnswers)) { answersString += `- ${key}: ${value}\n`; }
            elements.message.value = `Client Path:\n${pathLabels.join(" > ")}\n\nSpecific Data:\n${answersString}\n\nGenerated Strategy:\n${node.text}`;
            
            const restartBtn = document.createElement('button');
            restartBtn.innerText = "Start Over / Explore Different Path";
            restartBtn.className = "tree-option-btn";
            restartBtn.style.textAlign = "center"; restartBtn.style.marginTop = "20px"; restartBtn.style.background = "#fff";
            restartBtn.onclick = () => { 
                history = []; pathLabels = []; userAnswers = {}; currentNode = 'start'; 
                elements.question.classList.remove('result-card'); 
                window.history.pushState(initialState, "", "");
                renderNode(false); 
            };
            elements.options.appendChild(restartBtn);

        } else if (node.type === 'select') {
            elements.formContainer.style.display = 'none';
            elements.question.classList.remove('result-card');
            const select = document.createElement('select'); select.className = "tree-select";
            const defaultOpt = document.createElement('option');
            defaultOpt.text = "Please Select..."; defaultOpt.value = ""; defaultOpt.disabled = true; defaultOpt.selected = true;
            select.add(defaultOpt);
            node.choices.forEach(choice => {
                const opt = document.createElement('option'); opt.value = choice; opt.text = choice; select.add(opt);
            });
            elements.options.appendChild(select);
            const nextBtn = document.createElement('button');
            nextBtn.innerText = "Next Step →"; nextBtn.className = "next-btn";
            nextBtn.onclick = () => {
                if(select.value === "") { alert("Please make a selection."); return; }
                navigateTo(node.next, select.value, node.variable, select.value);
            };
            elements.options.appendChild(nextBtn);

        } else if (node.type === 'text' || node.type === 'number') {
            elements.formContainer.style.display = 'none';
            elements.question.classList.remove('result-card');
            const input = document.createElement('input');
            input.type = node.type; input.className = "tree-input"; input.placeholder = node.placeholder || "";
            if (node.variable && userAnswers[node.variable]) input.value = userAnswers[node.variable];
            elements.options.appendChild(input);
            const nextBtn = document.createElement('button');
            nextBtn.innerText = "Next Step →"; nextBtn.className = "next-btn";
            nextBtn.onclick = () => {
                if(input.value.trim() === "") { alert("Please enter a value."); return; }
                navigateTo(node.next, `${node.variable}: ${input.value}`, node.variable, input.value);
            };
            elements.options.appendChild(nextBtn);

        } else {
            elements.formContainer.style.display = 'none';
            elements.question.classList.remove('result-card');
            node.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt.label; btn.className = "tree-option-btn";
                btn.onclick = () => { navigateTo(opt.next, opt.label, node.variable, opt.label); };
                elements.options.appendChild(btn);
            });
        }
    }
    elements.backBtn.onclick = () => { window.history.back(); };
    renderNode(false);
});
</script>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyLHWsaJvRo4CPVU1f1umMXBT4Tazy3s1vUTMTTrOv0AVLjw4xs0pEkj5TpocbJdnyMJw/exec";
    const form = document.getElementById('contact-form');
    const statusMsg = document.getElementById('form-status');
    const btn = document.getElementById('submit-btn');

    function isValidEmail(email) { const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; return regex.test(email); }

    if (form) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault(); statusMsg.innerText = "";
            const formData = new FormData(form);
            const email = formData.get('email');
            if (!isValidEmail(email)) { statusMsg.innerText = "Please enter a valid email address."; statusMsg.style.color = "#ef4444"; return; }
            const captchaResponse = grecaptcha.getResponse();
            if (!captchaResponse || captchaResponse.length === 0) { statusMsg.innerText = "Please check the captcha box."; statusMsg.style.color = "#ef4444"; return; }

            btn.disabled = true; btn.innerText = "Processing...";
            const data = { name: formData.get('name'), email: email, phone: formData.get('phone'), message: formData.get('message'), captchaToken: captchaResponse };
            const controller = new AbortController(); const timeoutId = setTimeout(() => controller.abort(), 10000);

            try {
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data), signal: controller.signal });
                clearTimeout(timeoutId);
                statusMsg.innerText = "Strategy Request Received. We will be in touch shortly."; statusMsg.style.color = "#10b981";
                form.reset(); grecaptcha.reset(); 
            } catch (error) {
                console.error('Error:', error);
                if (error.name === 'AbortError') statusMsg.innerText = "Request timed out."; else statusMsg.innerText = "Transmission error. Please try again.";
                statusMsg.style.color = "#ef4444";
            } finally { btn.disabled = false; btn.innerText = "Unlock Strategy"; }
        });
    }
</script>
</body>
</html>
