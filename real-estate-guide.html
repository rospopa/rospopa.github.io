<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tree = {
        start: {
            text: "What is your primary Real Estate Goal?",
            options: [
                { label: "Buy a Home", next: "buy_node_1" },
                { label: "Sell a Property", next: "sell_node_1" },
                { label: "Invest/Wealth Building", next: "invest_node_1" },
                { label: "Commercial/Business", next: "comm_node_1" }
            ]
        },

        buy_node_1: {
            text: "Have you owned a home in the last 3 years?",
            options: [
                { label: "Yes", next: "buy_repeat_triage" },
                { label: "No (First Time Buyer)", next: "buy_fthb_triage" }
            ]
        },

        buy_fthb_triage: {
            text: "What is your biggest hurdle right now?",
            options: [
                { label: "Down Payment", next: "res_grant" },
                { label: "Credit Score", next: "res_credit" },
                { label: "Income/Monthly Payment", next: "res_househack" }
            ]
        },

        buy_repeat_triage: {
            text: "Do you need to sell your current home to buy the new one?",
            options: [
                { label: "Yes, I need the cash", next: "buy_contingency" },
                { label: "No, I can carry both", next: "buy_2nd_home" }
            ]
        },

        buy_contingency: {
            text: "Is your current home currently on the market?",
            options: [
                { label: "Yes", next: "strat_concurrent" },
                { label: "Not yet", next: "strat_sell_first" }
            ]
        },

        buy_2nd_home: {
            text: "What is the primary use of this new property?",
            options: [
                { label: "Vacation/Second Home", next: "strat_vacation" },
                { label: "Primary Residence", next: "strat_bridge" }
            ]
        },

        sell_node_1: {
            text: "What is the financial status of the property?",
            options: [
                { label: "High Equity (>20%)", next: "sell_retail" },
                { label: "Low or Negative Equity", next: "sell_distress" },
                { label: "Probate / Inherited", next: "sell_probate" }
            ]
        },

        sell_retail: {
            text: "What is your main priority for this sale?",
            options: [
                { label: "Maximum Profit", next: "strat_concierge" },
                { label: "Speed of Sale", next: "strat_instant" }
            ]
        },

        sell_distress: {
            text: "Are you currently behind on mortgage payments?",
            options: [
                { label: "Yes", next: "sell_hardship" },
                { label: "No", next: "strat_hold_rent" }
            ]
        },

        sell_hardship: {
            text: "Do you have other significant assets (stocks, 2nd home)?",
            options: [
                { label: "Yes", next: "strat_short_sale" },
                { label: "No", next: "strat_deed_lieu" }
            ]
        },

        sell_probate: {
            text: "Do you have 'Letters of Office' from the court?",
            options: [
                { label: "Yes, fully authorized", next: "strat_probate_easy" },
                { label: "No, still in process", next: "strat_probate_court" },
                { label: "What is that?", next: "strat_probate_bond" }
            ]
        },

        invest_node_1: {
            text: "What is your preferred involvement level?",
            options: [
                { label: "Active (Hands-on)", next: "inv_active_risk" },
                { label: "Passive (Hands-off)", next: "inv_passive_check" },
                { label: "Analyze Existing Asset", next: "inv_analyze" }
            ]
        },

        inv_active_risk: {
            text: "What is your risk tolerance?",
            options: [
                { label: "High (Flips)", next: "strat_fix_flip" },
                { label: "Moderate (BRRRR)", next: "strat_brrrr" },
                { label: "Low (Rental)", next: "strat_buy_hold" }
            ]
        },

        inv_passive_check: {
            text: "Are you an Accredited Investor ($200k+ income / $1M+ net worth)?",
            options: [
                { label: "Yes", next: "strat_syndication" },
                { label: "No", next: "strat_reit" }
            ]
        },

        inv_analyze: {
            text: "Does the asset's ROE (Return on Equity) exceed 7%?",
            options: [
                { label: "Yes, it's performing", next: "strat_hold_refi" },
                { label: "No, it's lazy equity", next: "strat_1031" }
            ]
        },

        comm_node_1: {
            text: "What is the property type?",
            options: [
                { label: "Retail/Office", next: "comm_retail_node" },
                { label: "Industrial/Flex", next: "strat_industrial" }
            ]
        },

        comm_retail_node: {
            text: "Are you looking to Lease or Own?",
            options: [
                { label: "Own (Owner-User)", next: "strat_sba_504" },
                { label: "Lease", next: "comm_lease_type" }
            ]
        },

        comm_lease_type: {
            text: "What lease structure is proposed?",
            options: [
                { label: "Triple Net (NNN)", next: "strat_lease_audit" },
                { label: "Modified Gross", next: "strat_lease_base_year" }
            ]
        },

        // --- OUTCOME NODES ---
        res_grant: { text: "Strategy: IHDA Grant Pairing. We will leverage Illinois Housing Development Authority programs to secure up to $10,000 in down payment assistance.", options: [] },
        res_credit: { text: "Strategy: Credit Repair Roadmap. You need a 6-month buffer to target 620+ and save thousands in MIP.", options: [] },
        res_househack: { text: "Strategy: House Hacking. Buy a 2-4 unit property using an FHA 3.5% down loan.", options: [] },
        strat_sell_first: { text: "Strategy: Listing Preparation. We will use a 'Home of Choice' contingency clause to protect you.", options: [] },
        strat_concurrent: { text: "Strategy: Concurrent Closing. We will line up the closings for the same day.", options: [] },
        strat_bridge: { text: "Strategy: Bridge Loan / HELOC. Tap into a HELOC on your current home to fund the down payment.", options: [] },
        strat_vacation: { text: "Strategy: Vacation Rental Analysis. We must verify local short-term rental laws.", options: [] },
        strat_concierge: { text: "Strategy: Concierge Listing. Implementation of staging and high-end photography.", options: [] },
        strat_instant: { text: "Strategy: Aggressive Pricing / iBuyer. Price slightly below comps to induce a bidding war.", options: [] },
        strat_hold_rent: { text: "Strategy: Rent & Hold. It is financially better to rent the unit until equity recovers.", options: [] },
        strat_short_sale: { text: "Strategy: Negotiated Short Sale. We must negotiate a 'Waiver of Deficiency'.", options: [] },
        strat_deed_lieu: { text: "Strategy: Deed in Lieu. Avoids the stigma of foreclosure and resolves debt faster.", options: [] },
        strat_probate_easy: { text: "Strategy: Standard Estate Sale. Independent Administration allows you to sell without court approval.", options: [] },
        strat_probate_court: { text: "Strategy: Court-Approved Sale. Expect a 45-60 day closing window.", options: [] },
        strat_probate_bond: { text: "Strategy: Bond in Lieu of Probate. Speed up the process by working with a title company.", options: [] },
        strat_fix_flip: { text: "Strategy: Fix & Flip (70% Rule). Purchase + Repairs < 70% of After Repair Value.", options: [] },
        strat_brrrr: { text: "Strategy: BRRRR Method. Buy, Rehab, Rent, Refinance, Repeat.", options: [] },
        strat_buy_hold: { text: "Strategy: Cash Flow Focus. Target multi-family units where Cap Rate exceeds 6-8%.", options: [] },
        strat_syndication: { text: "Strategy: Syndication LP. Provide capital to a General Partner for a large commercial deal.", options: [] },
        strat_reit: { text: "Strategy: Public REITs. Focus on publicly traded Real Estate Investment Trusts.", options: [] },
        strat_hold_refi: { text: "Strategy: Hold & Refinance. Look at a Cash-Out Refinance to buy another asset.", options: [] },
        strat_1031: { text: "Strategy: 1031 Exchange. Defer capital gains taxes by rolling proceeds into a higher-performing property.", options: [] },
        strat_sba_504: { text: "Strategy: SBA 504 Loan. Buy a building with only 10% down as an owner-user.", options: [] },
        strat_lease_audit: { text: "Strategy: NNN Lease Audit. Audit the landlord's 'CAM' charges to ensure you aren't overpaying.", options: [] },
        strat_lease_base_year: { text: "Strategy: Base Year Stop. Negotiate a 'Gross' lease where you only pay increases above a base year.", options: [] },
        strat_industrial: { text: "Strategy: Logistics/Flex Focus. Focus on 'Last Mile' locations near highways.", options: [] }
    };

    let currentNode = 'start';
    let history = []; 
    let pathLabels = []; 

    const elements = {
        question: document.getElementById('question-text'),
        options: document.getElementById('options-container'),
        backBtn: document.getElementById('back-btn'),
        progress: document.getElementById('progress-bar-fill'),
        step: document.getElementById('step-counter'),
        formContainer: document.getElementById('contact-form-container'),
        message: document.getElementById('message-field')
    };

    function renderNode() {
        const node = tree[currentNode];
        if (!node) return;

        elements.question.innerText = node.text;
        elements.options.innerHTML = '';
        const stepNum = history.length + 1;
        
        elements.step.innerText = (node.options.length === 0)? 'Complete' : `Step ${stepNum}`;
        elements.progress.style.width = (node.options.length === 0)? '100%' : Math.min(stepNum * 15, 95) + '%';
        elements.backBtn.style.display = (history.length > 0)? 'inline' : 'none';

        if (node.options.length === 0) {
            elements.question.classList.add('result-card');
            elements.formContainer.style.display = 'block';
            
            let complianceNote = "\n\n*Local Compliance Note (Villa Park/IL):* \n- Transfer Stamps: $0 (Villa Park), but Inspection Required ($50).\n- Mandatory Disclosures: IL Radon, Lead-Based Paint (Pre-1978).";
            elements.message.value = "User Path: " + pathLabels.join(" > ") + "\n\nProposed Strategy: " + node.text + complianceNote;
            
            const restartBtn = document.createElement('button');
            restartBtn.innerText = "Start Over";
            restartBtn.className = "tree-option-btn";
            restartBtn.style.textAlign = "center";
            restartBtn.style.marginTop = "20px";
            restartBtn.onclick = () => { history = []; pathLabels = []; currentNode = 'start'; renderNode(); };
            elements.options.appendChild(restartBtn);
        } else {
            elements.question.classList.remove('result-card');
            elements.formContainer.style.display = 'none';
            node.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt.label;
                btn.className = "tree-option-btn";
                btn.onclick = () => {
                    history.push(currentNode);
                    pathLabels.push(opt.label);
                    currentNode = opt.next;
                    renderNode();
                };
                elements.options.appendChild(btn);
            });
        }
    }

    elements.backBtn.onclick = () => {
        if (history.length > 0) {
            currentNode = history.pop();
            pathLabels.pop();
            renderNode();
        }
    };

    renderNode();
});
</script>
