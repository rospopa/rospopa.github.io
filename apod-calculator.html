<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Commercial Real Estate APOD Calculator">
    <title>Commercial Real Estate APOD Calculator</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+Inscriptional+Pahlavi&amp;display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css">
    
    <style>
        /* CSS 1:1 from Template 2 */
        .site-header { background-color: #f8f9fa; border-bottom: 1px solid #dee2e6; padding: 1rem 0; }
        .wrap { max-width: 1400px; margin: 0 auto; padding: 0 15px; }
        .site-title { font-size: 1.5rem; font-weight: 600; color: #333; }
        .site-nav { float: right; }
        .site-nav .trigger2 { display: none; }
        footer { background-color: #f8f9fa; border-top: 1px solid #dee2e6; margin-top: 3rem; padding: 2rem 0; }
        .page-content { padding: 2rem 0; }
        .calcheaderbtn { margin-bottom: 20px; display: flex; gap: 10px; }
        .subsection { margin-top: 20px; padding: 20px; border-radius: 0px; }
        .subsection-heading { text-align: center; margin-bottom: 15px; font-weight: 700; text-transform: uppercase; }
        
        /* Matching Template 2's specific borders and colors */
        .section-border { border: 1px dashed #1DA1F2; padding: 15px; margin-bottom: 20px; }
        .expense-bg { background: rgb(240, 128, 128); }
        .income-bg { background: #d4edda; }
        .results-bg { background: #fff3cd; }
        .rent-roll-bg { background: #e3f2fd; }

        .input-group-text { background-color: #e9ecef; font-size: 0.9rem; }
        .form-label { font-weight: 600; font-size: 0.9rem; margin-bottom: 0.2rem; }
        .mtool { color: #1DA1F2; cursor: help; margin-right: 3px; }

        @media (max-width: 768px) {
            .site-nav .trigger { display: none; }
            .site-nav .trigger2 { display: inline-block; }
        }

        /* Rent Roll Specific Table Style */
        .table-rent-roll input { border: none; background: transparent; width: 100%; }
        .table-rent-roll input:focus { outline: 1px solid #1DA1F2; background: #fff; }
    </style>
</head>

<body>
<header class="site-header">
    <div class="wrap">
        <a class="site-title" style="text-decoration: none;" href="https://rospopa.com">Commercial Real Estate APOD</a>
        <nav class="site-nav">
            <div class="trigger">
                <a style="text-decoration: none;" href="mailto:pavlo@rospopa.com?subject=APOD-Calculator">pavlo@rospopa.com</a>
            </div>
            <div class="trigger2">
                <a style="text-decoration: none;" href="mailto:pavlo@rospopa.com?subject=APOD-Calculator">@</a>
            </div>
        </nav>
    </div>
</header>

<main>
    <div class="page-content">
        <div id="topdf" class="wrap">
            <div id="calculator">
                <div class="calcheaderbtn">
                    <div class="modal fade" role="dialog" tabindex="-1" id="confirmModal">
                        <div class="modal-dialog modal-sm" role="document">
                            <div class="modal-content">
                                <div class="modal-header" style="padding-bottom: 10px;">
                                    <button class="btn-close" type="button" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body text-center">
                                    <h2 style="margin-bottom: 0px;margin-top: 5px; font-size: 1.5rem;">Confirm Reset?</h2>
                                </div>
                                <div class="modal-footer justify-content-evenly">
                                    <button class="btn btn-success" type="button" data-bs-dismiss="modal">NO</button>
                                    <button class="btn btn-secondary" id="resetAll" type="button" data-bs-dismiss="modal">YES</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#confirmModal"><span>RESET</span></button>
                    <button class="btn btn-primary btn-sm" id="savepdf"><span>PDF</span></button>
                    <button class="btn btn-success btn-sm" id="sendtoemail"><span>E-MAIL</span></button>
                </div>

                <div class="section-border row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label" for="autocomplete"><sup class="mtool" title="Address"><i class="icon-question"></i></sup>Address*</label>
                        <div class="input-group">
                            <span class="input-group-text">Address</span>
                            <input type="text" id="autocomplete" class="form-control" placeholder="Enter property address" value="75th St Downers Grove">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="B1"><sup class="mtool" title="Purchase Price $"><i class="icon-question"></i></sup>Purchase Price</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input class="form-control" type="number" id="B1" value="5900000" oninput="calculate()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="B4"><sup class="mtool" title="Closing Date"><i class="icon-question"></i></sup>Closing Date</label>
                        <div class="input-group">
                            <input class="form-control" id="B4" type="date">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="A4"><sup class="mtool" title="Days Remain in Year"><i class="icon-question"></i></sup>Remain</label>
                        <div class="input-group">
                            <input class="form-control" type="number" id="A4" value="0" readonly>
                            <span class="input-group-text">days</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="A4_2"><sup class="mtool" title="Days Passed in Year"><i class="icon-question"></i></sup>Passed</label>
                        <div class="input-group">
                            <input class="form-control" type="number" id="A4_2" value="0" oninput="calculate()">
                            <span class="input-group-text">days</span>
                        </div>
                    </div>
                </div>

                <h4 class="text-center">Loan Profile</h4>
                <div class="section-border row">
                    <div class="col-md-3">
                        <label class="form-label" for="B2"><sup class="mtool" title="Down Payment %"><i class="icon-question"></i></sup>Down Payment %</label>
                        <div class="input-group">
                            <input class="form-control" type="number" id="B2" value="100" min="0" max="100" oninput="updateDownPayment()">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="B3"><sup class="mtool" title="Down Payment $"><i class="icon-question"></i></sup>Down Payment $</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input class="form-control" type="number" id="B3" value="5900000" oninput="calculate()">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="Loan-Type"><sup class="mtool" title="Loan Type"><i class="icon-question"></i></sup>Loan Type</label>
                        <select class="form-select form-control" id="Loan-Type">
                            <option value="None (All Cash)">None (All Cash)</option>
                            <option value="Conventional Loan">Conventional Loan</option>
                            <option value="Commercial Loan">Commercial Loan</option>
                            <option value="DSCR Loan">DSCR Loan (Debt-Service Coverage Ratio)</option>
                        </select>
                    </div>
                    <div class="col-md-3 mt-2">
                        <label class="form-label" for="B5">Loan Amount</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input class="form-control" type="number" id="B5" value="0" readonly>
                        </div>
                    </div>
                    <div class="col-md-3 mt-2">
                        <label class="form-label" for="B6">Interest Rate %</label>
                        <div class="input-group">
                            <input class="form-control" type="number" id="B6" value="5.79" step="0.01" oninput="calculate()">
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                    <div class="col-md-3 mt-2">
                        <label class="form-label" for="B7">Term (Years)</label>
                        <div class="input-group">
                            <input class="form-control" type="number" id="B7" value="30" oninput="calculate()">
                            <span class="input-group-text">Yrs</span>
                        </div>
                    </div>
                    <div class="col-md-3 mt-2">
                        <label class="form-label" for="B10">Mo. Payment</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input class="form-control" type="number" id="B10" readonly>
                        </div>
                    </div>
                </div>

                <div class="subsection rent-roll-bg">
                    <h4 class="subsection-heading">Rent Roll</h4>
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover table-rent-roll bg-white">
                            <thead class="table-light">
                                <tr>
                                    <th>Tenant Name</th>
                                    <th>Sq Ft</th>
                                    <th>Monthly Rent</th>
                                    <th>Recovery PSF</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="tenantList">
                                </tbody>
                        </table>
                    </div>
                    <button class="btn btn-primary btn-sm mt-2" onclick="addTenant()">+ Add Tenant</button>
                </div>

                <div class="subsection expense-bg">
                    <h4 class="subsection-heading">Operating Expenses (Annual)</h4>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Real Estate Taxes</label>
                            <div class="input-group"><span class="input-group-text">$</span><input class="form-control" type="number" id="A5" value="380154" oninput="calculate()"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Property Insurance</label>
                            <div class="input-group"><span class="input-group-text">$</span><input class="form-control" type="number" id="propertyInsurance" value="32000" oninput="calculate()"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Off-Site Management</label>
                            <div class="input-group"><span class="input-group-text">$</span><input class="form-control" type="number" id="offSiteManagement" value="84047" oninput="calculate()"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Repairs & Maintenance</label>
                            <div class="input-group"><span class="input-group-text">$</span><input class="form-control" type="number" id="repairsMaint" value="242104" oninput="calculate()"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Utilities</label>
                            <div class="input-group"><span class="input-group-text">$</span><input class="form-control" type="number" id="utilities" value="109140" oninput="calculate()"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Lawn/Snow Care</label>
                            <div class="input-group"><span class="input-group-text">$</span><input class="form-control" type="number" id="lawnSnow" value="81648" oninput="calculate()"></div>
                        </div>
                    </div>
                </div>

                <div class="subsection results-bg">
                    <h4 class="subsection-heading">Financial Summary</h4>
                    <div class="alert alert-primary text-center">
                        <h3 class="mb-0">Net Operating Income (NOI): <strong id="noiDisplay">$0</strong></h3>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered bg-white">
                            <tbody>
                                <tr><td>Scheduled Rental Income</td><td class="text-end text-success" id="scheduledRentalDisplay">$0</td></tr>
                                <tr><td>Total Operating Expenses</td><td class="text-end text-danger" id="totalExpensesDisplay">($0)</td></tr>
                                <tr class="table-primary"><td><strong>Cap Rate</strong></td><td class="text-end" id="capRateDisplay"><strong>0%</strong></td></tr>
                                <tr><td>Annual Debt Service</td><td class="text-end text-danger" id="debtServiceDisplay">($0)</td></tr>
                                <tr><td>Debt Coverage Ratio (DCR)</td><td class="text-end" id="dcrDisplay">0.00</td></tr>
                                <tr class="table-success"><td><strong>Cash Flow Before Taxes</strong></td><td class="text-end" id="cashFlowDisplay"><strong>$0</strong></td></tr>
                                <tr><td>Cash on Cash Return</td><td class="text-end" id="cocDisplay">0%</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <section class="mt-4">
                    <h5 class="font-monospace lh-1 text-center" style="font-size: 0.8rem; color: #666;">Disclaimer.<br>Use this calculator for REVIEW and TESTING purposes only.<br>(It's not a substitute for professional calculations.)</h5>
                </section>
            </div>
        </div>
    </div>
</main>

<footer>
    <div class="wrap text-center">
        <p>Go to <a href="https://www.linkedin.com/in/prospopa/">LinkedIn</a> | <a href="https://github.com/rospopa">GitHub</a></p>
        <p class="mt-2">Copyright © <span id="currentYear"></span> Pavlo Rospopa. All Rights Reserved.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    let tenants = [];

    function updateDownPayment() {
        const price = parseFloat(document.getElementById('B1').value) || 0;
        const pct = parseFloat(document.getElementById('B2').value) || 0;
        const down = (price * pct) / 100;
        document.getElementById('B3').value = down.toFixed(0);
        document.getElementById('B5').value = (price - down).toFixed(0);
        calculate();
    }

    function addTenant() {
        tenants.push({ id: Date.now(), name: '', sqFt: 0, monthlyRent: 0, recoveryPSF: 0 });
        renderTenants();
        calculate();
    }

    function removeTenant(id) {
        tenants = tenants.filter(t => t.id !== id);
        renderTenants();
        calculate();
    }

    function updateTenant(id, field, value) {
        const tenant = tenants.find(t => t.id === id);
        if (tenant) {
            tenant[field] = value;
            calculate();
        }
    }

    function renderTenants() {
        const container = document.getElementById('tenantList');
        container.innerHTML = tenants.map((t, i) => `
            <tr>
                <td><input type="text" value="${t.name}" onchange="updateTenant(${t.id}, 'name', this.value)" placeholder="Tenant ${i+1}"></td>
                <td><input type="number" value="${t.sqFt}" oninput="updateTenant(${t.id}, 'sqFt', parseFloat(this.value)||0)"></td>
                <td><input type="number" value="${t.monthlyRent}" oninput="updateTenant(${t.id}, 'monthlyRent', parseFloat(this.value)||0)"></td>
                <td><input type="number" value="${t.recoveryPSF}" step="0.01" oninput="updateTenant(${t.id}, 'recoveryPSF', parseFloat(this.value)||0)"></td>
                <td class="text-center"><button class="btn btn-outline-danger btn-sm" onclick="removeTenant(${t.id})">×</button></td>
            </tr>
        `).join('');
    }

    function calculateMortgage(p, r, y) {
        if (p <= 0 || r <= 0) return 0;
        const i = r / 100 / 12;
        const n = y * 12;
        return p * (i * Math.pow(1 + i, n)) / (Math.pow(1 + i, n) - 1);
    }

    function calculate() {
        const price = parseFloat(document.getElementById('B1').value) || 0;
        const down = parseFloat(document.getElementById('B3').value) || 0;
        
        let rentalIncome = 0;
        let recoveryIncome = 0;
        tenants.forEach(t => {
            rentalIncome += t.monthlyRent * 12;
            recoveryIncome += (t.sqFt * t.recoveryPSF) * 12;
        });

        const totalExpenses = ['A5', 'propertyInsurance', 'offSiteManagement', 'repairsMaint', 'utilities', 'lawnSnow']
            .reduce((sum, id) => sum + (parseFloat(document.getElementById(id).value) || 0), 0);

        const goi = rentalIncome + recoveryIncome;
        const noi = goi - totalExpenses;
        const capRate = price > 0 ? (noi / price) * 100 : 0;

        const loanAmount = price - down;
        const term = parseFloat(document.getElementById('B7').value) || 0;
        const rate = parseFloat(document.getElementById('B6').value) || 0;
        const monthlyDebt = calculateMortgage(loanAmount, rate, term);
        const annualDebt = monthlyDebt * 12;

        document.getElementById('B10').value = monthlyDebt.toFixed(2);
        document.getElementById('noiDisplay').textContent = formatCurrency(noi);
        document.getElementById('scheduledRentalDisplay').textContent = formatCurrency(rentalIncome);
        document.getElementById('totalExpensesDisplay').textContent = `(${formatCurrency(totalExpenses)})`;
        document.getElementById('capRateDisplay').textContent = capRate.toFixed(2) + '%';
        document.getElementById('debtServiceDisplay').textContent = `(${formatCurrency(annualDebt)})`;
        document.getElementById('dcrDisplay').textContent = annualDebt > 0 ? (noi / annualDebt).toFixed(2) : "0.00";
        document.getElementById('cashFlowDisplay').textContent = formatCurrency(noi - annualDebt);
        document.getElementById('cocDisplay').textContent = down > 0 ? ((noi - annualDebt) / down * 100).toFixed(2) + '%' : '0%';
    }

    function formatCurrency(v) { return '$' + v.toLocaleString('en-US', {maximumFractionDigits:0}); }

    // Init with Sample Data
    tenants = [{id: 1, name: 'Anchor Store', sqFt: 32000, monthlyRent: 14000, recoveryPSF: 3.50}];
    renderTenants();
    calculate();

    document.getElementById('resetAll').addEventListener('click', () => location.reload());
</script>

</body>
</html>
